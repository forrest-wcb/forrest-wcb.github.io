<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Diary</title>
    <url>/2024/01/20/Diary/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="Oh, these decrypted content cannot be verified, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="c55fa540f67eeabcac6a214f376c648349b4f482c536fbceb3fae989060e1fcf">4630436162ade97ba2718b7d0c4b3b633234c9ea37bb2b66774e3dcf26ceae6c635bfd14cb4722a9336235ed5ecef267abc8cb775856f0410524792086db9d0dade633d18941f3d2b8dcb67aa1a1caae398d79580d751f5f366257ef9aea95a45affdf598785593e28fcbc21b2af4d846c458f152d4e0a373a7f045ca30ad6e4e49385b3d35ce2e75226e72548a400f0ba9cd4a5ba1115ed12781897284106d3ceea2e59bfa208f9806d658159f5dab693a197d4f56e3dfaba96462dcfe5aaf4dbc781fb91850c02d5d60db18f41feff3e0b8ec480b4595042270dbea0426106a9c55d5e379db8c8d0d8add745afe52dc693b26b88accece0251dc633c68730eea517170bd456a7c0ab1c1f41075379e28b5826176f8dabb63b80640e7be0ad7c45a158b7f528d1e4d17faaff5bf98d78ee748d560f527e5016c26636afb6021549b9d200b71cf35874b4e6772be68e3377f1025b4588a32ab8b559607a201df95398c43baed3da406027362d20aace7a17d97153499f01b688c9610751854022d789e5ba69fd2447a32904e46c289a0a4c4a3a5c4dba136c1071db99dc22aacf6ed1efd96314021ce114bcac2624810ed5db9c871d96f6a3b95c4ac308586b57c3772ac7d7b60bd6dbdacaf1e975d84536696b93535db5ec4d1831b438729e0deff69ffdddbae245db24fee3ce35e02138e136d4d4501d4bcd2d9c052294610de78280164d019a693796af4de4c84acc21b9c594e2323fbfbefd063f2cc29376963619cee62bb5d75fb6fa5f7a6ab06aa427ebbb7c2e6aa3b5a551cc675aad2504e1a46b77845ff5edfc6d097ab455a762e7f30e8bd8e69723f9dbdfca40b96e6d0f9f638b90dc27d5eea6d33518c21435f233b4183e1ee7ae0ea98565eb9e2a7b41090f27107e75522d08d71b2cdb32d53e48a0af28ac6de7ae4c77eda056130f8548dd30e2ff91d84df0f87e6d5a00602bd141c2505091f9702728f66ccd925cf5d8fbf18d87c9ff19e345c4c4db2e78cddd030f8bb13468295199d67dc903d5188ae5d350bd833e0500a513825e6c7bb8bb5b3971977d76445fc91321cc1fa886f78e0c8822f1a748f4ec92f4c91a21eeb938406424ac2974aebb21ebd7006e4dc951e9093ceb44da5a6b4e85c3c73d5c9270ed3fa28452335cb6718bc1babd340de108b9a1edf1864f8871fa0cdb392e97c8b3c38d1c86aa6354ce819c27b82755a43717a5d6b6d37984506fc8a9f797bb05711f9a8b86c132a5a93776c90c1a239e6dbe077d8011a6dc819c2371553fdc8fedd5eb3e3288fe0015a7d769334c7c8be85f447da3a6dda2a80b2aba4712ac4967c6a6a33fb044f45d1d7fd4b340da9df3d2698378916d5477e6dcf0e115ec6622b1c3d5b522e6bdc9cc064ba2185313b94fcd05eece7a021fa8beb6cf674a06a91bc38e090c388472382c9c4646e18357a66875ea480a1df92d1b76802b616d4544fd482ed4bb81c848c70f556fc1309173655fd38b2f579a96b82c1c6bb971fead37a1e269e2bf0aeb8ea2e0deb8a6afa6842b51fdb96721ba83efc2a42ece6a659f83dc38e0c33912ab0035b2155314b499d51ba94d3fbf737c0e82ed2af539642b2684a797109249a74e21a3e9200a06d979b87020b67972fd42d0533d909c5215ea3d4873be1963e806bf79e70ba06e17a7ab24e5bd8fa094443a70074aecad1a44b868708bd59e640cbd0fabb0db79901018077ca7e1f76b20a24008c02ddd2ba7a92c967c43abc7d4b241b8e5c7e54f5c9e19afaac615795424c509d805d9110111f6ee378e5956f8d801267b5fff91f78c77dd0621a0b20cc909d9805433b03e7e6fef62086011fda21c2d966c6f6c44a6565c24392ba2dee721413fd907c553d25fbf19798a41f2ff658086f9f4056d61ab969eb24020516e5b959b1408447e4900b382aecefc26f211c0059603477ead221d2d85209d2821ec41174f9f29a51f82e295c7cb434dfe7faa6c95de51c6d4af01534a3750560928259826dd083f585dddcd0e1a2b2171aad1cdeb5e5d11637d633505e46995a6078b01e663fdd0864db937307445653c67c3532ca1427062c87859961ae0f425e0fda8cf8656df8fe0afbb4d6657c93ff4cc8b988ef94d98d9799845bfd743d534259d32f4c14daeef52201481d62e8733a79780bf4811d631863b973896f62e7b1e0b9449f99099145a7a1181c5d86d0ba684da17137671e318ba8958efa979abe9536103fc0f94ebe3b6c8c41645ef22c6071f53401070000cf816fac84417a307b01f4b78e1cb192afec81394c6781e8beee8b2d9686b163b6cccf7ef200f066c4f18838519a769f32e9cddd2312a760c9acb21a93c7466517c83df34f6c3cdfe108c43d6dd906e955b59ce40b0a9bb5fd9f2c3e3f16b254cffe5ac2fc284d1e97913afb7a9a7ed961079c0a17183b848161ff0dafbe49ca97749308ad694553d74695c311a067f4640493787765384f168ab0107a390872ef3f1623261e0290ec3354dddbdcae253d1c17949797be2a428b716bb866907de272d3fd58ebb3cf5a9190149513561cec89e48bee8a14fe9c3f09c23ed42c86269f7137081052586ab4e20599d1a2b80be89f4201b395e8d4eaeaf36ed13722b6190b49376e655836ce031564e5d35e6ef65f74ec05149880725cebc74d097514b5ca9ec486960100269ce308a990b7dbb1dd3e24fef90c9eaca3176c7839ce08d072f329cf46ee4716dfdb734278bd335d26068a5413eb0757ffc91a297f5b6eee34dcdec7a8fe700a1ab4bbb507d62426bc1f627fc29849fe08ece9a1d909530a2078b0b39ccdb3b081b676f56d3e066351bac24e8752f5e820a3a51a00d70056f7d67fb73aa41965fcb537687d3eaaf42428b266696c7ac34fd9e094d356808073a35b58f20449d63a5f9acec944ba2c1179f600bf36aca1bb27bf2bf4baa546941e93fbf4636333507aa1aafb1e25362c5eb07f222d20aedde038b1884359b56f8148bad26fc88acc620c2a99a65ec6c748c2e0fcb115ea05b5cdabc157da190cc54d9d91f76dfc1b12c9fe55170a81fe0858d1faf6f5fa7a47f0bd1174b846b21b51754638957144078f5355d457f4d5e9572f7700386f21cbfb6c33de56dc906ad3db794d4da1ae189ed9ce292d3c1df4aacf47436c251a2e51816d22e7f89d1fec1d1abf29f5c944ee2033f3de4eb12d03cc793976ba1986ea6b0c0c37f0c8a282f364820860cb554b775da06827835e42fb983d9df96cd9142b6600d932c9e34e31c53c7889365c470c70d16b62df11e09d90539694a5f95e49fe3f04c4697d236c488a0fd109d788670d03e96c406dd5084766564ae8a04c96cf76bf4c9a3f0c5ad1793b977d04db5c4c8d83fe4d56a0e02f9a33209390bccb692c2f730b760bb47b87aa089e40c9fb0cb6644c1bb5a4b1d7ac66556771f891ce3b02cfad5d085f7d7cd778dec966da1bf8523e9359e4a2bc19be8d1c244cb26f936a08f37c887f8467d8aa518f1ca9e66d20adff3db2c866ac2537de3879aa3b93f9e46949574549009c1324bef18a6a8563367a42f3a50934a6b471180e1ba43ff5b8540958e98fb0f609d96bf4ae8d25045b9f36829b1d4890e37cae153cfee94e79f2a25dc0fc7a96d30ffc35440d41504a9bdd2a2213887211f019002b30709db890c07369d128abbe3a36e7dffd0b2c8cc3f8c2415550dd3d056120b7aa8e58cbe62c4eff3ab81be10084b9af4b83d704959f9461c8f1a7a3b3093a1fadd0c7f616ac1c0f8d1b8a3d879f308ded863c6e0757d736405f47b31f3804695de2e4dbc8b1f6b6e4c7c7ab26f3bc509a5e4a75c133ee6f011d0e3cbb50c92a60f7da8b34851425cd59d591357d9a833cea33ee921f5d68c2827937dcbfe13095632339cda0d5fcd856bddfad3719270ab72bcbd55c77a2c35f9b58a95443808d0ff8392844fc745cbdbc6b5cefb503292f945feb9ee60c5cedf8fed5ece7d540706441f58256a1f49260e51537cfba231ef50ea1d2918f09a0e90890d5f0b5ac914c824b9fb8c06be3d0d5d52781147715098e98c9ba1c4f7400e29eb92181991aee62eae80f2e1b66530e08fbedacf261993b23d899f54a918cbb35677c75019a574965d2863610da5c7140ac6e369bc5d49a082b0363ab3874c028484eada1e03a1136a0bb82c83bec79b2cac3f6a80cbd6e0665863d87a0a246a9af509c8f3f529e18582e9be1d5e8fa79e8e066eb9b4a09fb44a2f064ab5b668a5db18809310e586a0137f267fc9a1a3fe4d6a25af12c68f0814dd5f797a0ad1b8768c01a36604ead81428060f3adf2d97ce7978f0210b1a101b8b26cf8cf4a65fb764ee700cb26c0dbd9b4a29d4352c3786f7487ba00aa130b99e663344a4669fdcb4e903891068d626b410bc782d308b91432e5941b12ab55bd4107c2aebfbf7a4f0708574fe9baf714f26c8273ca1a90d85c1da933e0c4d9c4cb91b8e63cbc3e30a7a34fa753d6a0625c866d5f4e2185f9c1d2a31e748ba128dd704c30f9e9e1a357cf9f7e810c5277f0803458cef0f106f78eda56ea16fe234b95bdb576e79446a7c5fc8d7550ef9d059b0dcae8dec6473488a1230285e95ae00ed169d7d93eeb2646d2aa66b133a548de1278b9fb5849272c1d3a16be720573ea8d8e48cec77ac23cdbdba4744756b06f18d1498890255c42cde6c70fdc5ca0e834c052aa6c12a151f0c26c4bf7b3f6ec8bd5fe9df4900851c6356871a91c145c6f8a644c676cb1baaa110d578486eb95aa6992a860fc41f30e2506db4625da963c31bbc3797e6b358d0d97ac88b7d0dbd4ede1cee5206531ecb1f828fb066050e64ac2201c3711340fc4e864736a69df1a23e92d901f9673734cf0f7eb8c4cdc90b4e62733380f19e094e361349478c7f2bf0b30707c2db4238492ee24b7e539e5c85bdd2163630065e3b18c59e95cd6a1f13b2ae3dd971c723a80b3997592b32acbd931d68e35ed500390153f267a3ea5b8e0ecb76e11f65e2dffefdfd06f564be449b55cf693246359a0052ac45fbf7c283005ae1078bae8b449e97f2050c6580d633e1182ec707cc1b81390464f3409c10b2a269590c4fd0f7390b857a99a5553e47285325f041bfa20bdf6cbdd5be8158c9edac56ccd26308d4429e90d984f5448b417b48d388d8751758de8a61332d6a966fc407103afa74d1dfd46386eec6152a02b493417df2664e22f270e16bd4a3c94a425de0a811677ffcf05550288ffc3de2a3731a4a16f6419a3dd1260332a436275468f699aebc8c6b019e468a07508d75b942e1b7203bb10c8506673ad1dc08135ae0f0b63c259090aacd7d8f5395d17e779aa33438e604e9a031715b874485219b859d57bf9f4b3c2e2d77be64e4f2ea41d5ea9c288313775d81925d69b7334d86ae8c2296e49e10d8cefbeacdd01c0df01255610737e6bf9783c027eeed4bf69fa7f21c179d57424fc9b52efcede3dbfdc8cab41e292e697c79883e3ff6e5dae9b73da8af01486dbcdbe640b506f5ea426ab5da569fbd17742e6aa6fb24253895769753fd1c812a5ddaaa9c71600e57d9805acad49fca9625b69326b44d5aecda4cb7019d240f18693736b570ea965ed5c0ddba9623f95068b41d0931c14b653f4aae1036fd34ff93a0b8858a4b64dba2c9b5028a10ea4e3ee47533a0675ac245c4a092184770206dbd048d669c9f78f77133639da06ad744c5d1c56bd12ec3b2ff0a2cf0e77eb770bb15cb1412e73d971218b5bc1285191c6613937fc41bbd8ca9ae0abf708a37b32aec35858800445b6804b0d9a1e58c76df579384a562d23274f3adfd6e69c90aee9bcf7e3c76d298eece2352de7f0086d0641ae0dfc9f626bb90818d0b4b091a230d4f84b3eabcbb26577c3afb1eb55bd7a1e249b1d915d772c5d8fa49536c9115039be49aa7577aaa4b12d145e86b8faea4aa09d5610473d87b7823edc805d75e76366907d05b5dec256683a4083ce83628ed375fe96955d4d8dcbd7c326efca53e322aee8d92faae4bee1e77b91f8e66ec9dfbdc3becdd7b1c865f22b38974e993b377987b37c833b322388759250f4a8ae9f682492cb5062f98c934e03d9eea0318e618886717b51283af9322df0dc0adf8036964a69c7f6e4d7584fe2c4099f362fb2ff9270ec6ccb7a4915fc0a08610e83d8d7e1b2817ea7ff4cf8d3375d0c41d83e9e56fe29d14093bae35744e5500c8148f6b4b2626bf7baccd73b1f585cb3072d45e0082b4684e775675d6561e86de05f4dd3d600d391c096dc0fb5e1eade43ed603f270a81476b8ea89b1595a45b4f31e960ac2bfb2528560668ba963282bd7fe19c31b1f53d52545f8f44d3566fa46f37f709c8d043a27718a7b68a75bce0b863a87ae8a2a97b6d2cf1be68f4336fa63d5561dcb1fc0e4fab7a16da6c87701f053d380b97de10924be02ca9d090f95d4b40e7c947c7d22dd1d2f890fa10c6b5b4a8f7fdba04dfd5c6251b2b478bf923fe11921ebab0fa30fe51161d051ade3e8c679a80038c7a0344ce40e18cfbdfc798571a3f6d18d71df6aed874d1823935cc867d7803dfc1343480e221bdf84af0b3420f8c46f003f6a5d3488692493e0097bc731c5867b6e98b6fa4136917a85c39d65da1e9587d9b90cce1a594b557af159e7a99d8b9bfc35ac06e6607198cc37ff4a3587068dbfad850a6fb4aea62086e5dd0394eb4f4e7379ef649e7e27538384dd653ca845e2b96bf72e591fab56eb516e39b18fbe72a9069506227147415b32f48e1f5ab6c01df2c0a8ffa66819484924db2c97903608de8e28f34ee59a3414d148a2c27b94da2a84544b9eb5308b8d1790ca42fb85d9122a80787dc01dd18f72e561a48e62e8888f033587d9c3c66f225cd986a8ff18f018abbdbcf7cee950b0eb796e32565d1e9c9fc10b024100d14a4b977d085ad3960a2a43b3995b089f6def01b13174ed8f22cb48694189ef37bab8fca768f1e02adb5a662776409cd015ad5a8c4116ffbef45a05e943890f4ec43e0933b772e8cd3a9317ac007fdbec5d70a06bd525fbc6bc8e3034140463ab08f4d7798d7d0299ed0d95dd2650fb1ae3964893e79e3094acb88bd13166a51ccd727cf2dae4d42028ca56ac8349239723cb989094e1e1b3e1ad078f4bf570f709c427d9338131ee5d83b959792985d01ce4beec58740f7efa952aedf0a1b525b17553f98d1b65dc18a628f3f2636e606d1a22b58d13004a774bc749eb40f8e4cd766f1d5649f6023683e56a8e95961c3a9e32a95b3d041ec034026840071be479ccc22eb11c44f398b04928faa2828076b72757e2c784d0017138d63e7314d200f6cad21243705b185533992a292fe06626bfab1b179a8a8c6d9cf80eff812d1f3775578a0fb1b9745d7961567e0c2d2fc3b7acd37e4f87ac19a4ffbb36a870a2b245a818e5130048ccd87c00c712390a2edc339e8d8e65c2c2445d129e10def947aa0945f9e2d998422e413f29b25ef74111169fe06c191311fe1a1700c7f46df34e78381178ef454ab22a92791ea4a082739b682811e375d4c91d4bc52d68fd5ed1f3724c6597320ec4c38b9c432d4976628a326b359ffae886981d6b60336dc678ff95c7b87678a0e358dee58905646ec0024b4fc475a88bd46b707a35bbc330bdb08a0c1e3ccc65b54f5df6f7096bc34929de35ae731bd4ac02c2bf8a027b054400b395f1e54430586fda66bcc2b73d57060400c66823337824b650643f672ee1eb5c7851ed39e137d6bf58865d0935decbfa66d12bf6cd48ab95c7a040d00cb951b9a68ca4a647ef4848993e7d4eeebcc1bd10d9fb2097a485976be31886a324c2653c7e379c1903a5ddc83d60b3985fe78f24aaba31a5b33ecce9bea2a3537f9d526df02754f68b8fb5edcea6d273b168f15c252e8075cb9d3507dd086fef38063a4a6461933dda255bf235167d319719e0c01506345159cd2b5607ea83976eada1441e717c5ced391ae041d4e25377b7dd3b8e2fefe90233b9e9b470c6ec5ea87a807dda9232d3877fcbf35d4edd1e42c6a5bd875f81095a195f8c726a0ef94e5e54523d38dd1359c5ef887a00b6f775ff3723e5f2772f666eb8e822bf51521d35b51040b30102edaf945a5b6e203a6218fd8d977a9ec20bdd04d5ae1ac8106fb11054689832c1d82769dfaa6dd475137a4966d6e17f4d35d228b1b904567ccc0a9244bce31317212118503f5c21b75f29dcd235e071879bddb464683ad5b6838883781395af68f7cc40a4ec19882fd27d2dd835c93d1f64f7c470e15b8e37baffe8e53e262c56e18a6a774911d6efa47541b4b6ee368448111c28da2075e5e477531f0c87ce50ffae8d32accb368693f0434bb739f2429578cb2fa26f44ff53dc6e6c2d3ffcaed96e310e0e053ed7c7214b3483ea2ddb20523206d4282e69ac3ae0c2069a554814007a867693d22b95c66cdb4f60d897c7fed4557341897dc91415e2cb0130a5ec009f12c0a77239223a75cdc1d863688ef31a813239e73b8d895ebdb62a19dca7bcc3048e40ace5e210fdc1a9a7080ddf98aa27e93b7ed4d68079f20e69059bc232d52f161a8d8b6e90b59d1ec4acb3acb23ab45166545134539b52b124de05ab2a62c092b3786a2f156754ddce0c1777a6441552ea6287bc4acd4a454ee006e8abf83f724032e0a325e637711c1d704aa31589dea8ad36824dbe0a9dcec6d419876c1a6843d0d155bd789ff08a042b00d08ce16e691c2c2e8e1a7244ca4b43480c87e8a9893377d77afb48b3aadbeb4c62ccee3b5a48846438e74da6fe48ac8a706057d3ee873aebe2f0ae118fce7c4f54bf5c904e4649387acded2ecb495ac4ed84ff8731d1571ca961c1b97ab51dfba4527f944bafa32b5ecb0e1b2454e5546cb1cb71b729bf26d534a60e74426c9585b2d2522559f27cc9108dd96f4703296b735e817e6ff1082c34b01ed13c0bd31b07984d48d17a07adb31cd3539e9cd3959ae5198614cff704f263deb8f76bce9776d11151b6ddd745903d50c3235b22e2909736b1b532e7799fd1dcbbbf2fb6c9913d7583676686a5f867693c4103a1f134c9b331d108869d0b45f66afc61038c6985ea51dd3e6f89f85b4221ca0dd12df40896c50bd63b78b2f7b610d2974f87e10ed89a8d114f941f464134613d3c7678d8a240d58a45fd59ca2a0f031478dc5869daa4a01e135a741a0fc491cdf781e64e48b5dab2fb3b61a8adc704295e1b03659a99ff0c9f76a14e6821a9bad825315aaa68efdc4b64b5a52a5159d761520dadd611ab0369b53bca69522fc697947f5dec62415d2e70c539a08aeb07a34c5ed96801f649e8bd502581f97407aa507ca968c3c7413fed2449e8af3b08537f6e84dc4a0796d2bf7f0d4abf0dfc19a92d58447d0182934e7f5de86568a6e1c0af8b38623a2fda4ed5af8f9b4b8fa23edf58ce320b87ad2131a9ce4476167c155aef01470aba200215c29559d9bee0e093947283b6b619cb9b898dbc0e2aebda407a560ede0c1dc0f5a86d8f29a51fc66cfe74020aa4fe6c0eda4295e5bfd34a46084f966083cf6be83155d01e3ee86a95141529eea211c3d0628120999de92feebc33298a00c529b7c6669431461ecfce770bf233135767984f7a2309fbe46a850594b94225c6cebb1c1e16a3fbb6c71809dba51149145b12edcee7b26bffa1bc919d0de9ec86c87210a6cd09058255e3562de83983d1ea8e197f9692f19cf80b58e46f347ed8853528bb68461298f28050f9931856db4ca401e78a67a7cfaa646ee96d4a25bc37b18da16253b</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-up">
      <input class="hbe hbe-input-field hbe-input-field-up" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-up" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-up">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>ç”Ÿæ´»</category>
      </categories>
      <tags>
        <tag>æ—¥è®°&amp;éšæƒ³</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello Worldï¼</title>
    <url>/2023/09/04/hello%20world/</url>
    <content><![CDATA[<h1>å»ºç«™èµ·å› </h1>
<p>çªç„¶å‘ç°è‡ªå·±å·²ç»æ˜¯å¤§ä¸‰è€ä¸œè¥¿äº†ï¼Œå‰ä¸¤å¹´ç”±äºå…´è¶£å¹¿æ³›ï¼Œè¯•äº†ä¸å°‘é”™ï¼Œéå°å¤±è´¥è‹¦æœï¼Œç°åœ¨å·²ç»æ²¡æœ‰è¯•é”™çš„èµ„æœ¬äº†ã€‚ä¹‹å‰å­¦é•¿è¯´æˆ‘æ¶‰çŒå¤šè€Œä¸ç²¾ï¼Œç°åœ¨æƒ³æ¥ä¹Ÿæ˜¯ï¼Œæˆ‘æ€»æ˜¯è§çŒå¿ƒå–œï¼Œæ‰“ç®—å­¦ä¹ æŸæ–¹é¢çŸ¥è¯†ç„¶ååˆæµ…å°è¾„æ­¢ï¼Œä¸”ç”±äºèƒ½åŠ›ç²¾åŠ›æœ‰é™ï¼Œå¯¼è‡´äº†å¦‚ä»Šåçœè‡ªèº«åªèƒ½æƒ¶æåœ°å‘ç°ç«Ÿæ— ä¸€é¡¹æ‰€é•¿ã€‚æœªæ¥æ–¹å‘ä¹‹å¤šä»¥è‡´æƒŠæ…Œè¿·èŒ«å¤±æªï¼Œæˆ‘ä¹Ÿè¯¥æ€è€ƒæœªæ¥è§„åˆ’äº†ï¼ˆè¿™ä¹Ÿè®¸æ˜¯æˆ‘ç¬¬ä¸€æ¬¡é¢ä¸´è¿™æ ·çš„é€‰æ‹©ï¼Œä»å°åˆ°å¤§ï¼Œå‡å­¦ã€åˆ†ç§‘ã€æ‹©æ ¡ã€è½¬ä¸“ä¸šç§ç§é€‰æ‹©ï¼Œæˆ‘ä»¿ä½›éƒ½åœ¨éšæ³¢é€æµï¼Œä»æœªç‹¬ç«‹ä½œå‡ºè‡ªå·±çš„æŠ‰æ‹©ï¼‰</p>
<p>ä¹‹å‰è§è¿‡åŒå­¦çš„åšå®¢ï¼Œæˆ‘ä¹Ÿå¿ƒè¡€æ¥æ½®è·Ÿç€æ•™ç¨‹æŠ˜è…¾äº†å‡ å¤©ï¼Œæ­å»ºäº†ä¸ªè‡ªå·±çš„åšå®¢ï¼ˆhexo+butterfly ç¡®å®ç®€å•æ˜“ç”¨ä¸”ç¾è§‚ï¼‰ï¼Œå¸Œæœ›ä»¥æ­¤è®°å½•æˆ‘çš„å­¦ä¹ è½¨è¿¹ï¼Œå…¼ä½œç£ä¿ƒã€‚</p>
<h1>æœªæ¥è§„åˆ’</h1>
<p>åšå®¢å…ˆå°±è¿™æ ·äº†(è™½ç„¶è¿˜æœ‰ä¸å°‘é—®é¢˜æ²¡æœ‰è§£å†³å’Œå¥½å¤šåŠŸèƒ½æ²¡æœ‰å®ç°)ï¼Œå…¶å®æˆ‘å¯¹ç¾è§‚æ–¹é¢æ˜¯æ¯”è¾ƒåœ¨æ„çš„ï¼Œå…ˆç«‹ä¸ª flagï¼Œä»¥åæœ‰æ—¶é—´çš„è¯ä¸€å®šå›æ¥ç»§ç»­ä¼˜åŒ–ã€‚</p>
<p>æ–°çš„å­¦å¹´ä¸èƒ½å†åƒä¹‹å‰é‚£èˆ¬ä»»æ€§ä¸”é‡éš¾åˆ™é€€ï¼Œå¸Œæœ›èƒ½é€‰å®šä¸€ä¸ªæ–¹å‘è¿›è¡Œæ·±è€•ï¼Œåšåˆ°ç²¾é€šã€‚å­¦ä¹ è½¨è¿¹æˆ‘ä¹Ÿä¼šå°½é‡æ›´æ–°åœ¨æœ¬åšå®¢ ğŸ˜‰</p>
<hr>
<p>ç°åœ¨æ˜¯å¤§ä¸‰ä¸‹å­¦æœŸï¼Œç»¼åˆäº†é£é™©å’Œå¯¹åº”æœŸæœ›ï¼Œè€ä¸œè¥¿æˆ‘è¿˜æ˜¯è¦èµ°ä¸Šè€ƒç ”çš„é“è·¯äº†ã€‚é‰´äºä¹‹å‰èµ°äº†ä¸å°‘é”™è·¯ï¼Œå¸Œæœ›ä»¥åçš„æ¯ä¸€æ­¥éƒ½èƒ½èµ°çš„è°¨æ…ï¼Œèƒ½èµ°åˆ°å±€éƒ¨æœ€ä¼˜ä¸Šã€‚</p>
<p>åšå®¢ä¹Ÿæ²¡æ—¶é—´æ›´æ–°äº†ï¼Œç­‰è€ƒå®Œç ”å§ğŸ˜­</p>
<h2 id="åç»­æŠ•æ”¾å†…å®¹-åšå®¢å¥½åƒä¸æ”¯æŒæ’å…¥ä»£åŠ">åç»­æŠ•æ”¾å†…å®¹(åšå®¢å¥½åƒä¸æ”¯æŒæ’å…¥ä»£åŠ)</h2>
<ul>
<li>[ ] <s>è‡ªå¹³è¡¡æ‘©æ‰˜è½¦è°ƒè¯•è®°å½•</s></li>
<li>[ ] æ—¥è®°&amp;éšæƒ³</li>
<li>[ ] åœ°å¹³çº¿æ™ºæ…§åŒ»ç–—è®°å½•</li>
<li>[ ] å·²åˆ·ç•ªå‰§æ•´ç†</li>
<li>[ ] å·²åˆ·å°è¯´&amp;ä¹¦ç±æ•´ç†</li>
</ul>
]]></content>
      <categories>
        <category>ç”Ÿæ´»</category>
      </categories>
      <tags>
        <tag>æ‚è°ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>CUDAå­¦ä¹ ç¬”è®°</title>
    <url>/2023/12/29/cuda/</url>
    <content><![CDATA[<h1>CUDA C/C++ç¼–ç¨‹çš„å­¦ä¹ </h1>
<p><strong>æœ¬æ–‡åŸºäºè‹±ä¼Ÿè¾¾æä¾›çš„çº¿ä¸Šè‡ªä¸»å­¦ä¹ è¯¾ç¨‹</strong></p>
<p>åŠ é€Ÿè®¡ç®—æ­£åœ¨å–ä»£ CPU è®¡ç®—ï¼Œæˆä¸ºæœ€ä½³è®¡ç®—åšæ³•ã€‚åŠ é€Ÿè®¡ç®—å¸¦æ¥çš„å±‚å‡ºä¸ç©·çš„çªç ´æ€§è¿›å±•ã€å¯¹åŠ é€Ÿåº”ç”¨ç¨‹åºæ—¥ç›Šå¢é•¿çš„éœ€æ±‚ã€è½»æ¾ç¼–å†™åŠ é€Ÿè®¡ç®—çš„ç¼–ç¨‹è§„èŒƒä»¥åŠæ”¯æŒåŠ é€Ÿè®¡ç®—çš„ç¡¬ä»¶çš„ä¸æ–­æ”¹è¿›ï¼Œæ‰€æœ‰è¿™ä¸€åˆ‡éƒ½åœ¨æ¨åŠ¨è®¡ç®—æ–¹å¼å¿…ç„¶ä¼šè¿‡æ¸¡åˆ°åŠ é€Ÿè®¡ç®—ã€‚</p>
<h2 id="ä¸ºGPUç¼–å†™åº”ç”¨ç¨‹åºä»£ç ">ä¸ºGPUç¼–å†™åº”ç”¨ç¨‹åºä»£ç </h2>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ª <code>.cu</code> æ–‡ä»¶ï¼ˆ<code>.cu</code> æ˜¯ CUDA åŠ é€Ÿç¨‹åºçš„æ–‡ä»¶æ‰©å±•åï¼‰ã€‚å…¶ä¸­åŒ…å«ä¸¤ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‡½æ•°å°†åœ¨ CPU ä¸Šè¿è¡Œï¼Œç¬¬äºŒä¸ªå°†åœ¨ GPU ä¸Šè¿è¡Œã€‚è¯·æŠ½ç‚¹æ—¶é—´æ‰¾å‡ºè¿™ä¸¤ä¸ªå‡½æ•°åœ¨å®šä¹‰æ–¹å¼å’Œè°ƒç”¨æ–¹å¼ä¸Šçš„å·®å¼‚ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">CPUFunction</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This function is defined to run on the CPU.\n&quot;</span>);<br>&#125;<br><br>__global__ <span class="hljs-type">void</span> <span class="hljs-title function_">GPUFunction</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This function is defined to run on the GPU.\n&quot;</span>);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>  CPUFunction();<br><br>  GPUFunction&lt;&lt;&lt;<span class="hljs-number">1</span>, <span class="hljs-number">1</span>&gt;&gt;&gt;();<br>  cudaDeviceSynchronize();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›éœ€è¦ç‰¹åˆ«æ³¨æ„çš„é‡è¦ä»£ç è¡Œï¼Œä»¥åŠåŠ é€Ÿè®¡ç®—ä¸­ä½¿ç”¨çš„ä¸€äº›å…¶ä»–å¸¸ç”¨æœ¯è¯­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">__global__ void GPUFunction()<br></code></pre></td></tr></table></figure>
<ul>
<li><code>__global__</code> å…³é”®å­—è¡¨æ˜ä»¥ä¸‹å‡½æ•°å°†åœ¨ GPU ä¸Šè¿è¡Œå¹¶å¯<strong>å…¨å±€</strong>è°ƒç”¨ï¼Œè€Œåœ¨æ­¤ç§æƒ…å†µä¸‹ï¼Œåˆ™æŒ‡ç”± CPU æˆ– GPU è°ƒç”¨ã€‚</li>
<li>é€šå¸¸ï¼Œæˆ‘ä»¬å°†åœ¨ CPU ä¸Šæ‰§è¡Œçš„ä»£ç ç§°ä¸º<strong>ä¸»æœº</strong>ä»£ç ï¼Œè€Œå°†åœ¨ GPU ä¸Šè¿è¡Œçš„ä»£ç ç§°ä¸º<strong>è®¾å¤‡</strong>ä»£ç ã€‚</li>
<li>æ³¨æ„è¿”å›ç±»å‹ä¸º <code>void</code>ã€‚ä½¿ç”¨ <code>__global__</code> å…³é”®å­—å®šä¹‰çš„å‡½æ•°éœ€è¦è¿”å› <code>void</code> ç±»å‹ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">GPUFunction&lt;&lt;&lt;1, 1&gt;&gt;&gt;();<br></code></pre></td></tr></table></figure>
<ul>
<li>é€šå¸¸ï¼Œå½“è°ƒç”¨è¦åœ¨ GPU ä¸Šè¿è¡Œçš„å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å°†æ­¤ç§å‡½æ•°ç§°ä¸º<strong>å·²å¯åŠ¨</strong>çš„<strong>æ ¸å‡½æ•°</strong>ã€‚</li>
<li>å¯åŠ¨æ ¸å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æä¾›<strong>æ‰§è¡Œé…ç½®</strong>ï¼Œå³åœ¨å‘æ ¸å‡½æ•°ä¼ é€’ä»»ä½•é¢„æœŸå‚æ•°ä¹‹å‰ä½¿ç”¨ <code>&lt;&lt;&lt; ... &gt;&gt;&gt;</code> è¯­æ³•å®Œæˆçš„é…ç½®ã€‚</li>
<li>åœ¨å®è§‚å±‚é¢ï¼Œç¨‹åºå‘˜å¯é€šè¿‡æ‰§è¡Œé…ç½®ä¸ºæ ¸å‡½æ•°å¯åŠ¨æŒ‡å®š<strong>çº¿ç¨‹å±‚æ¬¡ç»“æ„</strong>ï¼Œä»è€Œå®šä¹‰çº¿ç¨‹ç»„ï¼ˆç§°ä¸º<strong>çº¿ç¨‹å—</strong>ï¼‰çš„æ•°é‡ï¼Œä»¥åŠè¦åœ¨æ¯ä¸ªçº¿ç¨‹å—ä¸­æ‰§è¡Œçš„<strong>çº¿ç¨‹</strong>æ•°é‡ã€‚ç¨åå°†åœ¨æœ¬å®éªŒæ·±å…¥æ¢è®¨æ‰§è¡Œé…ç½®ï¼Œä½†ç°åœ¨è¯·æ³¨æ„æ­£åœ¨ä½¿ç”¨åŒ…å« <code>1</code> çº¿ç¨‹ï¼ˆç¬¬äºŒä¸ªé…ç½®å‚æ•°ï¼‰çš„ <code>1</code> çº¿ç¨‹å—ï¼ˆç¬¬ä¸€ä¸ªæ‰§è¡Œé…ç½®å‚æ•°ï¼‰å¯åŠ¨æ ¸å‡½æ•°ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">cudaDeviceSynchronize();<br></code></pre></td></tr></table></figure>
<ul>
<li>ä¸è®¸å¤š C/C++ ä»£ç ä¸åŒï¼Œæ ¸å‡½æ•°å¯åŠ¨æ–¹å¼ä¸º<strong>å¼‚æ­¥</strong>ï¼šCPU ä»£ç å°†ç»§ç»­æ‰§è¡Œ<em>è€Œæ— éœ€ç­‰å¾…æ ¸å‡½æ•°å®Œæˆå¯åŠ¨</em>ã€‚</li>
<li>è°ƒç”¨ CUDA è¿è¡Œæ—¶æä¾›çš„å‡½æ•° <code>cudaDeviceSynchronize</code> å°†å¯¼è‡´ä¸»æœº (CPU) ä»£ç æš‚ä½œç­‰å¾…ï¼Œç›´è‡³è®¾å¤‡ (GPU) ä»£ç æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½åœ¨ CPU ä¸Šæ¢å¤æ‰§è¡Œã€‚</li>
</ul>
<h3 id="ç»ƒä¹ ">ç»ƒä¹ </h3>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">helloCPU</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello from the CPU.\n&quot;</span>);<br>&#125;<br><br>__global__ <span class="hljs-type">void</span> <span class="hljs-title function_">helloGPU</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hello from the GPU.\n&quot;</span>);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br><br>  helloCPU();<br>    <br>  helloGPU&lt;&lt;&lt;<span class="hljs-number">1</span>,<span class="hljs-number">1</span>&gt;&gt;&gt;();<br><br>  cudaDeviceSynchronize();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä»¥ä¸Šæ˜¯å¯¹ nvidiaæ‰€ç»™ä¾‹å­<a href="http://dli-604a4aa51b37-99aaad.aws.labs.courses.nvidia.com/lab/edit/01-hello/01-hello-gpu.cu"><code>01-hello-gpu.cu</code></a> çš„é‡æ„ï¼Œè¿è¡Œç»“æœä¸ºå…ˆåæ¬¡åºæ‰“å°Hello from the CPU.å’ŒHello from the GPU.</p>
<ul>
<li>
<p>ä»æ ¸å‡½æ•°å®šä¹‰ä¸­åˆ é™¤å…³é”®å­— <code>__global__</code>ã€‚æ³¨æ„é”™è¯¯ä¸­çš„è¡Œå·ï¼šæ‚¨è®¤ä¸ºé”™è¯¯ä¸­çš„ \â€configured\â€ æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå®Œæˆåï¼Œè¯·æ›¿æ¢ <code>__global__</code>ã€‚</p>
<p>æŠ¥é”™a host function call cannot be configuredã€‚</p>
<p>æœªå£°æ˜å…³é”®å­—_<em>global</em>_ï¼Œå‡½æ•°ä¸å¯è¢«&lt;&lt;&lt;â€¦&gt;&gt;&gt;é…ç½®</p>
</li>
<li>
<p>ç§»é™¤æ‰§è¡Œé…ç½®ï¼šæ‚¨å¯¹ \â€configured\â€ çš„ç†è§£æ˜¯å¦ä»æ—§åˆç†ï¼Ÿå®Œæˆåï¼Œè¯·æ›¿æ¢æ‰§è¡Œé…ç½®ã€‚</p>
<p>æŠ¥é”™a __global__ function call must be configuredã€‚</p>
<p>å¯åŠ¨æ ¸å‡½æ•°å¿…é¡»æä¾›æ‰§è¡Œé…ç½®ã€‚</p>
</li>
<li>
<p>ç§»é™¤å¯¹ <code>cudaDeviceSynchronize</code> çš„è°ƒç”¨ã€‚åœ¨ç¼–è¯‘å’Œè¿è¡Œä»£ç ä¹‹å‰ï¼ŒçŒœçŒœä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Œå¯ä»¥å›é¡¾ä¸€ä¸‹æ ¸å‡½æ•°é‡‡å–çš„æ˜¯å¼‚æ­¥å¯åŠ¨ï¼Œä¸” <code>cudaDeviceSynchronize</code> ä¼šä½¿ä¸»æœºæ‰§è¡Œæš‚ä½œç­‰å¾…ï¼Œç›´è‡³æ ¸å‡½æ•°æ‰§è¡Œå®Œæˆåæ‰ä¼šç»§ç»­ã€‚å®Œæˆåï¼Œè¯·æ›¿æ¢å¯¹ <code>cudaDeviceSynchronize</code> çš„è°ƒç”¨ã€‚</p>
<p>åªæ‰“å°Hello from the CPU.</p>
<p>æ ¸å‡½æ•°å¼‚æ­¥å¯åŠ¨ï¼ŒCPUå°†ç»§ç»­æ‰§è¡Œè€Œä¸ä¼šç­‰å¾…GPUæ‰§è¡Œå®Œæˆ</p>
</li>
<li>
<p>é‡æ„ <code>01-hello-gpu.cu</code>ï¼Œä»¥ä¾¿ <code>Hello from the GPU</code> åœ¨ <code>Hello from the CPU</code> <strong>ä¹‹å‰</strong>æ‰“å°ã€‚</p>
<p>å°†<code>helloGPU&lt;&lt;&lt;1,1&gt;&gt;&gt;();</code>åŠ<code>cudaDeviceSynchronize();</code>ç§»è‡³helloCPU()å‰ï¼Œmain()å¦‚ä¸‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">helloGPU&lt;&lt;&lt;<span class="hljs-number">1</span>,<span class="hljs-number">1</span>&gt;&gt;&gt;();<br>cudaDeviceSynchronize();<br>helloCPU();<br></code></pre></td></tr></table></figure>
<p>cudaDeviceSynchronize();å¿…é¡»è°ƒè‡³helloCPUå‰ï¼Œè‹¥åªæ”¹åŠ¨helloGPUæ‰“å°ç»“æœé¡ºåºä¸ä¼šå˜ã€‚</p>
</li>
<li>
<p>é‡æ„ <code>01-hello-gpu.cu</code>ï¼Œä»¥ä¾¿ <code>Hello from the GPU</code> æ‰“å°<strong>ä¸¤æ¬¡</strong>ï¼Œä¸€æ¬¡æ˜¯åœ¨ <code>Hello from the CPU</code> <strong>ä¹‹å‰</strong>ï¼Œå¦ä¸€æ¬¡æ˜¯åœ¨ <code>Hello from the CPU</code> <strong>ä¹‹å</strong>ã€‚</p>
<p>é‡æ„åmainå‡½æ•°å¦‚ä¸‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">helloGPU&lt;&lt;&lt;<span class="hljs-number">1</span>,<span class="hljs-number">1</span>&gt;&gt;&gt;();<br>cudaDeviceSynchronize();<span class="hljs-comment">//ç­‰å¾…ç¬¬ä¸€ä¸ªHello from the GPU</span><br>helloCPU();<span class="hljs-comment">//æ‰“å°Hello from the CPU</span><br>helloGPU&lt;&lt;&lt;<span class="hljs-number">1</span>,<span class="hljs-number">1</span>&gt;&gt;&gt;();<br>cudaDeviceSynchronize();<span class="hljs-comment">//ç­‰å¾…ç¬¬äºŒä¸ªHello from the GPU</span><br></code></pre></td></tr></table></figure>
<h3 id="ç¼–è¯‘å¹¶è¿è¡ŒåŠ é€Ÿåçš„CUDAä»£ç ">ç¼–è¯‘å¹¶è¿è¡ŒåŠ é€Ÿåçš„CUDAä»£ç </h3>
<p>CUDA å¹³å°é™„å¸¦ <a href="http://docs.nvidia.com/cuda/cuda-compiler-driver-nvcc/index.html"><strong>NVIDIA CUDA ç¼–è¯‘å™¨</strong></a> <code>nvcc</code>ï¼Œå¯ä»¥ç¼–è¯‘ CUDA åŠ é€Ÿåº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…å«ä¸»æœºå’Œè®¾å¤‡ä»£ç ã€‚</p>
<p>æ›¾ä½¿ç”¨è¿‡ <code>gcc</code> çš„ç”¨æˆ·ä¼šå¯¹ <code>nvcc</code> æ„Ÿåˆ°éå¸¸ç†Ÿæ‚‰ã€‚ä¾‹å¦‚ï¼Œç¼–è¯‘ <code>some-CUDA.cu</code> æ–‡ä»¶å°±å¾ˆç®€å•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">nvcc -arch=sm_70 -o out some-CUDA.cu -run<br></code></pre></td></tr></table></figure>
<ul>
<li><code>nvcc</code> æ˜¯ä½¿ç”¨ <code>nvcc</code> ç¼–è¯‘å™¨çš„å‘½ä»¤è¡Œå‘½ä»¤ã€‚</li>
<li>å°† <code>some-CUDA.cu</code> ä½œä¸ºæ–‡ä»¶ä¼ é€’ä»¥è¿›è¡Œç¼–è¯‘ã€‚</li>
<li><code>o</code> æ ‡å¿—ç”¨äºæŒ‡å®šç¼–è¯‘ç¨‹åºçš„è¾“å‡ºæ–‡ä»¶ã€‚</li>
<li><code>arch</code> æ ‡å¿—è¡¨ç¤ºè¯¥æ–‡ä»¶å¿…é¡»ç¼–è¯‘ä¸ºå“ªä¸ª<strong>æ¶æ„</strong>ç±»å‹ã€‚æœ¬ç¤ºä¾‹ä¸­ï¼Œ<code>sm_70</code> å°†ç”¨äºä¸“é—¨é’ˆå¯¹æœ¬å®éªŒè¿è¡Œçš„ Volta GPU è¿›è¡Œç¼–è¯‘ï¼Œä½†æœ‰æ„æ·±ç©¶çš„ç”¨æˆ·å¯ä»¥å‚é˜…æœ‰å…³ <a href="http://docs.nvidia.com/cuda/cuda-compiler-driver-nvcc/index.html#options-for-steering-gpu-code-generation"><code>arch</code> æ ‡å¿—</a>ã€<a href="http://docs.nvidia.com/cuda/cuda-compiler-driver-nvcc/index.html#gpu-feature-list">è™šæ‹Ÿæ¶æ„ç‰¹æ€§</a> å’Œ <a href="http://docs.nvidia.com/cuda/cuda-compiler-driver-nvcc/index.html#gpu-feature-list">GPUç‰¹æ€§</a> çš„æ–‡æ¡£ã€‚</li>
<li>ä¸ºæ–¹ä¾¿èµ·è§ï¼Œæä¾› <code>run</code> æ ‡å¿—å°†æ‰§è¡Œå·²æˆåŠŸç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li>
</ul>
</li>
</ul>
<h2 id="å¯åŠ¨å¹¶è¡Œè¿è¡Œçš„æ ¸å‡½æ•°">å¯åŠ¨å¹¶è¡Œè¿è¡Œçš„æ ¸å‡½æ•°</h2>
<p>ç¨‹åºå‘˜å¯é€šè¿‡æ‰§è¡Œé…ç½®æŒ‡å®šæœ‰å…³å¦‚ä½•å¯åŠ¨æ ¸å‡½æ•°ä»¥åœ¨å¤šä¸ª GPU <strong>çº¿ç¨‹</strong>ä¸­å¹¶è¡Œè¿è¡Œçš„è¯¦ç»†ä¿¡æ¯ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œç¨‹åºå‘˜å¯é€šè¿‡æ‰§è¡Œé…ç½®æŒ‡å®šçº¿ç¨‹ç»„ï¼ˆç§°ä¸º<strong>çº¿ç¨‹å—</strong>æˆ–ç®€ç§°ä¸º<strong>å—</strong>ï¼‰æ•°é‡ä»¥åŠå…¶å¸Œæœ›æ¯ä¸ªçº¿ç¨‹å—æ‰€åŒ…å«çš„çº¿ç¨‹æ•°é‡ã€‚æ‰§è¡Œé…ç½®çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">&lt;&lt;&lt;çº¿ç¨‹å—æ•°, æ¯ä¸ªçº¿ç¨‹å—çš„çº¿ç¨‹æ•°&gt;&gt;&gt;<br></code></pre></td></tr></table></figure>
<p><strong>å¯åŠ¨æ ¸å‡½æ•°æ—¶ï¼Œæ ¸å‡½æ•°ä»£ç ç”±æ¯ä¸ªå·²é…ç½®çš„çº¿ç¨‹å—ä¸­çš„æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œ</strong>ã€‚</p>
<p>å› æ­¤ï¼Œå¦‚æœå‡è®¾å·²å®šä¹‰ä¸€ä¸ªåä¸º <code>someKernel</code> çš„æ ¸å‡½æ•°ï¼Œåˆ™ä¸‹åˆ—æƒ…å†µä¸ºçœŸï¼š</p>
<ul>
<li><code>someKernel&lt;&lt;&lt;1, 1&gt;&gt;()</code> é…ç½®ä¸ºåœ¨å…·æœ‰å•çº¿ç¨‹çš„å•ä¸ªçº¿ç¨‹å—ä¸­è¿è¡Œåï¼Œå°†åªè¿è¡Œä¸€æ¬¡ã€‚</li>
<li><code>someKernel&lt;&lt;&lt;1, 10&gt;&gt;()</code> é…ç½®ä¸ºåœ¨å…·æœ‰ 10 çº¿ç¨‹çš„å•ä¸ªçº¿ç¨‹å—ä¸­è¿è¡Œåï¼Œå°†è¿è¡Œ 10 æ¬¡ã€‚</li>
<li><code>someKernel&lt;&lt;&lt;10, 1&gt;&gt;()</code> é…ç½®ä¸ºåœ¨ 10 ä¸ªçº¿ç¨‹å—ï¼ˆæ¯ä¸ªå‡å…·æœ‰å•çº¿ç¨‹ï¼‰ä¸­è¿è¡Œåï¼Œå°†è¿è¡Œ 10 æ¬¡ã€‚</li>
<li><code>someKernel&lt;&lt;&lt;10, 10&gt;&gt;()</code> é…ç½®ä¸ºåœ¨ 10 ä¸ªçº¿ç¨‹å—ï¼ˆæ¯ä¸ªå‡å…·æœ‰ 10 çº¿ç¨‹ï¼‰ä¸­è¿è¡Œåï¼Œå°†è¿è¡Œ 100 æ¬¡ã€‚</li>
</ul>
<h2 id="çº¿ç¨‹å’Œå—çš„ç´¢å¼•">çº¿ç¨‹å’Œå—çš„ç´¢å¼•</h2>
<p>æ¯ä¸ªçº¿ç¨‹åœ¨å…¶çº¿ç¨‹å—å†…éƒ¨å‡ä¼šè¢«åˆ†é…ä¸€ä¸ªç´¢å¼•ï¼Œä» <code>0</code> å¼€å§‹ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªçº¿ç¨‹å—ä¹Ÿä¼šè¢«åˆ†é…ä¸€ä¸ªç´¢å¼•ï¼Œå¹¶ä» <code>0</code> å¼€å§‹ã€‚æ­£å¦‚çº¿ç¨‹ç»„æˆçº¿ç¨‹å—ï¼Œçº¿ç¨‹å—åˆä¼šç»„æˆ<strong>ç½‘æ ¼</strong>ï¼Œè€Œç½‘æ ¼æ˜¯ CUDA çº¿ç¨‹å±‚æ¬¡ç»“æ„ä¸­çº§åˆ«æœ€é«˜çš„å®ä½“ã€‚ç®€è¨€ä¹‹ï¼ŒCUDA æ ¸å‡½æ•°åœ¨ç”±ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹å—ç»„æˆçš„ç½‘æ ¼ä¸­æ‰§è¡Œï¼Œä¸”æ¯ä¸ªçº¿ç¨‹å—ä¸­å‡åŒ…å«ç›¸åŒæ•°é‡çš„ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚</p>
<ul>
<li>gridDim.xï¼šç½‘æ ¼ä¸­çš„çº¿ç¨‹å—æ•°</li>
<li>blockIdx.xï¼šç½‘æ ¼ä¸­çº¿ç¨‹å—çš„ç´¢å¼•</li>
<li>blockDim.xï¼šçº¿ç¨‹å—ä¸­çš„çº¿ç¨‹æ•°</li>
<li>threadIdx.xï¼šå—ä¸­çº¿ç¨‹çš„ç´¢å¼•</li>
</ul>
<p>CUDA æ ¸å‡½æ•°å¯ä»¥è®¿é—®èƒ½å¤Ÿè¯†åˆ«å¦‚ä¸‹ä¸¤ç§ç´¢å¼•çš„ç‰¹æ®Šå˜é‡ï¼šæ­£åœ¨æ‰§è¡Œæ ¸å‡½æ•°çš„çº¿ç¨‹ï¼ˆä½äºçº¿ç¨‹å—å†…ï¼‰ç´¢å¼•å’Œçº¿ç¨‹æ‰€åœ¨çš„çº¿ç¨‹å—ï¼ˆä½äºç½‘æ ¼å†…ï¼‰ç´¢å¼•ã€‚è¿™ä¸¤ç§å˜é‡åˆ†åˆ«ä¸º <code>threadIdx.x</code> å’Œ <code>blockIdx.x</code>ã€‚</p>
<h2 id="åŠ é€Ÿforå¾ªç¯">åŠ é€Ÿforå¾ªç¯</h2>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> N = <span class="hljs-number">2</span>&lt;&lt;<span class="hljs-number">20</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; N; ++i)<br>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, i);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å¦‚è¦å¹¶è¡Œæ­¤å¾ªç¯ï¼Œå¿…é¡»æ‰§è¡Œä»¥ä¸‹ 2 ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>å¿…é¡»ç¼–å†™å®Œæˆ<strong>å¾ªç¯çš„å•æ¬¡è¿­ä»£</strong>å·¥ä½œçš„æ ¸å‡½æ•°ã€‚</li>
<li>ç”±äºæ ¸å‡½æ•°ä¸å…¶ä»–æ­£åœ¨è¿è¡Œçš„æ ¸å‡½æ•°æ— å…³ï¼Œå› æ­¤æ‰§è¡Œé…ç½®å¿…é¡»ä½¿æ ¸å‡½æ•°æ‰§è¡Œæ­£ç¡®çš„æ¬¡æ•°ï¼Œä¾‹å¦‚å¾ªç¯è¿­ä»£çš„æ¬¡æ•°ã€‚</li>
</ul>
<h3 id="ç»ƒä¹ ï¼šä½¿ç”¨å•ä¸ªçº¿ç¨‹å—åŠ é€Ÿforå¾ªç¯">ç»ƒä¹ ï¼šä½¿ç”¨å•ä¸ªçº¿ç¨‹å—åŠ é€Ÿforå¾ªç¯</h3>
<p><a href="http://dli-604a4aa51b37-24abdb.aws.labs.courses.nvidia.com/lab/edit/04-loops/01-single-block-loop.cu"><code>01-single-block-loop.cu</code></a> å†…çš„ <code>loop</code> å‡½æ•°è¿è¡Œç€ä¸€ä¸ªâ€œfor å¾ªç¯â€å¹¶å°†è¿ç»­æ‰“å° <code>0</code> è‡³ <code>9</code> ä¹‹é—´çš„æ‰€æœ‰æ•°å­—ã€‚å°† <code>loop</code> å‡½æ•°é‡æ„ä¸º CUDA æ ¸å‡½æ•°ï¼Œä½¿å…¶åœ¨å¯åŠ¨åå¹¶è¡Œæ‰§è¡Œ <code>N</code> æ¬¡è¿­ä»£ã€‚é‡æ„æˆåŠŸåï¼Œåº”ä»èƒ½æ‰“å° <code>0</code> è‡³ <code>9</code> ä¹‹é—´çš„æ‰€æœ‰æ•°å­—ã€‚</p>
<p>åŸä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br> <span class="hljs-type">void</span> <span class="hljs-title function_">loop</span><span class="hljs-params">(<span class="hljs-type">int</span> N)</span><br>&#123;<br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span> ; i&lt;N ; i++)<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is iteration number %d\n&quot;</span>,i);<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> N =<span class="hljs-number">10</span>;<br>  loop(N);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>é‡æ„åï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br>__global__ <span class="hljs-type">void</span> <span class="hljs-title function_">loop</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is iteration number %d\n&quot;</span>,threadIdx.x);<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>  loop&lt;&lt;&lt;<span class="hljs-number">1</span>,<span class="hljs-number">10</span>&gt;&gt;&gt;();<br>  cudaDeviceSynchronize();<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>æ³¨ï¼šæ¯ä¸ªçº¿ç¨‹å—å†…ï¼Œthread.xçš„è¾“å‡ºé¡ºåºæ˜¯æœ‰åºçš„ï¼Œè€Œä¸åŒçº¿ç¨‹å—é—´çš„è¾“å‡ºæ˜¯æ— åºçš„ã€‚å¦‚ä¸‹ï¼Œè¾“å‡ºæ˜¯æ— åºçš„ã€‚ä½†æ˜¯è‹¥æ”¹ä¸º loop&lt;&lt;&lt;10,2&gt;&gt;&gt;();å¯ä»¥å‘ç°ä»…çº¿ç¨‹å—è¾“å‡ºç»“æœé—´æ˜¯æ— åºçš„ï¼ŒåŒä¸€çº¿ç¨‹å—å†…çº¿ç¨‹è¾“å‡ºç»“æœæ˜¯æœ‰åºçš„ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br>__global__ <span class="hljs-type">void</span> <span class="hljs-title function_">loop</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is iteration number %d\n&quot;</span>,blockIdx.x);<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>  loop&lt;&lt;&lt;<span class="hljs-number">10</span>,<span class="hljs-number">1</span>&gt;&gt;&gt;();<br>  cudaDeviceSynchronize();<br>&#125;<br> <br></code></pre></td></tr></table></figure>
<p>*æŸ¥é˜…äº†ä¸€äº›èµ„æ–™ï¼Œè¯¢é—®äº†è€å¸ˆä¹‹åï¼Œå¾—çŸ¥ä¸¥æ ¼æ„ä¹‰ä¸Šçº¿ç¨‹å—å’Œçº¿ç¨‹çš„è¾“å‡ºé¡ºåºæ˜¯æ— æ³•æ§åˆ¶çš„ï¼Œâ€œå¹¶è¡Œæœ¬èº«å…¶å®å°±ä¸åº”è¯¥æ§åˆ¶å…ˆåé¡ºåºçš„ï¼Œå¦‚æœéœ€è¦æ§åˆ¶çš„è¯ï¼Œé‚£å°±è¯´æ˜è¿™ä¸ªä»»åŠ¡ä¸é€‚åˆåšçŸ¢é‡åŒ–äº†ï¼Œå› ä¸ºä»–æ˜¯é¡ºåºä¾èµ–çš„â€ï¼Œè¿™é‡Œçš„çº¿ç¨‹è¾“å‡ºæœ‰åºï¼ŒçŒœæµ‹æ˜¯å› ä¸ºæ˜¾ç¤ºç³»ç»Ÿè¿›è¡Œäº†åå¤„ç†ã€‚*æ‰€ä»¥åœ¨å®é™…ä½¿ç”¨ä¸­éœ€è¦è€ƒè™‘ä½¿ç”¨çº¿ç¨‹å—åŠ é€Ÿçš„é€‚ç”¨æ€§ã€‚</p>
<h2 id="è°ƒæ•´çº¿ç¨‹å—çš„å¤§å°ä»¥å®ç°æ›´å¤šçš„å¹¶è¡ŒåŒ–">è°ƒæ•´çº¿ç¨‹å—çš„å¤§å°ä»¥å®ç°æ›´å¤šçš„å¹¶è¡ŒåŒ–</h2>
<p>çº¿ç¨‹å—åŒ…å«çš„çº¿ç¨‹å…·æœ‰æ•°é‡é™åˆ¶ï¼šç¡®åˆ‡åœ°è¯´æ˜¯ 1024 ä¸ªã€‚ä¸ºå¢åŠ åŠ é€Ÿåº”ç”¨ç¨‹åºä¸­çš„å¹¶è¡Œé‡ï¼Œæˆ‘ä»¬å¿…é¡»è¦èƒ½åœ¨å¤šä¸ªçº¿ç¨‹å—ä¹‹é—´è¿›è¡Œåè°ƒã€‚</p>
<p>CUDA æ ¸å‡½æ•°å¯ä»¥è®¿é—®ç»™å‡ºå—ä¸­çº¿ç¨‹æ•°çš„ç‰¹æ®Šå˜é‡ï¼š<code>blockDim.x</code>ã€‚é€šè¿‡å°†æ­¤å˜é‡ä¸ <code>blockIdx.x</code> å’Œ <code>threadIdx.x</code> å˜é‡ç»“åˆä½¿ç”¨ï¼Œå¹¶å€ŸåŠ©æƒ¯ç”¨è¡¨è¾¾å¼ <code>threadIdx.x + blockIdx.x * blockDim.x</code> åœ¨åŒ…å«å¤šä¸ªçº¿ç¨‹çš„å¤šä¸ªçº¿ç¨‹å—ä¹‹é—´ç»„ç»‡å¹¶è¡Œæ‰§è¡Œï¼Œå¹¶è¡Œæ€§å°†å¾—ä»¥æå‡ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†ç¤ºä¾‹ã€‚</p>
<p>æ‰§è¡Œé…ç½® <code>&lt;&lt;&lt;10, 10&gt;&gt;&gt;</code> å°†å¯åŠ¨å…±è®¡æ‹¥æœ‰ 100 ä¸ªçº¿ç¨‹çš„ç½‘æ ¼ï¼Œè¿™äº›çº¿ç¨‹å‡åŒ…å«åœ¨ç”± 10 ä¸ªçº¿ç¨‹ç»„æˆçš„ 10 ä¸ªçº¿ç¨‹å—ä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯ä¸ªçº¿ç¨‹ï¼ˆ<code>0</code> è‡³ <code>99</code> ä¹‹é—´ï¼‰éƒ½èƒ½è®¡ç®—è¯¥çº¿ç¨‹çš„æŸä¸ªå”¯ä¸€ç´¢å¼•ã€‚</p>
<ul>
<li>å¦‚æœçº¿ç¨‹å— <code>blockIdx.x</code> ç­‰äº <code>0</code>ï¼Œåˆ™ <code>blockIdx.x * blockDim.x</code> ä¸º <code>0</code>ã€‚å‘ <code>0</code> æ·»åŠ å¯èƒ½çš„ <code>threadIdx.x</code> å€¼ï¼ˆ<code>0</code> è‡³ <code>9</code>ï¼‰ï¼Œä¹‹åä¾¿å¯åœ¨åŒ…å« 100 ä¸ªçº¿ç¨‹çš„ç½‘æ ¼å†…ç”Ÿæˆç´¢å¼• <code>0</code> è‡³ <code>9</code>ã€‚</li>
<li>å¦‚æœçº¿ç¨‹å— <code>blockIdx.x</code> ç­‰äº <code>1</code>ï¼Œåˆ™ <code>blockIdx.x * blockDim.x</code> ä¸º <code>10</code>ã€‚å‘ <code>10</code> æ·»åŠ å¯èƒ½çš„ <code>threadIdx.x</code> å€¼ï¼ˆ<code>0</code> è‡³ <code>9</code>ï¼‰ï¼Œä¹‹åä¾¿å¯åœ¨åŒ…å« 100 ä¸ªçº¿ç¨‹çš„ç½‘æ ¼å†…ç”Ÿæˆç´¢å¼• <code>10</code> è‡³ <code>19</code>ã€‚</li>
</ul>
<h2 id="åˆ†é…å°†è¦åœ¨GPUå’ŒCPUä¸Šè®¿é—®çš„å†…å­˜">åˆ†é…å°†è¦åœ¨GPUå’ŒCPUä¸Šè®¿é—®çš„å†…å­˜</h2>
<p>CUDA çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆç‰ˆæœ¬ 6 å’Œæ›´é«˜ç‰ˆæœ¬ï¼‰å·²èƒ½è½»æ¾åˆ†é…å¯ç”¨äº CPU ä¸»æœºå’Œä»»æ„æ•°é‡ GPU è®¾å¤‡çš„å†…å­˜ã€‚å°½ç®¡ç°ä»Šæœ‰è®¸å¤šé€‚ç”¨äºå†…å­˜ç®¡ç†å¹¶å¯æ”¯æŒåŠ é€Ÿåº”ç”¨ç¨‹åºä¸­æœ€ä¼˜æ€§èƒ½çš„ <a href="http://docs.nvidia.com/cuda/cuda-c-best-practices-guide/index.html#memory-optimizations">ä¸­é«˜çº§æŠ€æœ¯</a>ï¼Œä½†æˆ‘ä»¬ç°åœ¨è¦ä»‹ç»çš„åŸºç¡€ CUDA å†…å­˜ç®¡ç†æŠ€æœ¯ä¸ä½†èƒ½å¤Ÿæ”¯æŒè¿œè¶… CPU åº”ç”¨ç¨‹åºçš„å“è¶Šæ€§èƒ½ï¼Œè€Œä¸”å‡ ä¹ä¸ä¼šäº§ç”Ÿä»»ä½•å¼€å‘äººå‘˜æˆæœ¬ã€‚</p>
<p>å¦‚è¦åˆ†é…å’Œé‡Šæ”¾å†…å­˜ï¼Œå¹¶è·å–å¯åœ¨ä¸»æœºå’Œè®¾å¤‡ä»£ç ä¸­å¼•ç”¨çš„æŒ‡é’ˆï¼Œè¯·ä½¿ç”¨ <code>cudaMallocManaged</code> å’Œ <code>cudaFree</code> å–ä»£å¯¹ <code>malloc</code> å’Œ <code>free</code> çš„è°ƒç”¨ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// åªæœ‰CPU</span><br><span class="hljs-type">int</span> N = <span class="hljs-number">2</span>&lt;&lt;<span class="hljs-number">20</span>;<br><span class="hljs-type">size_t</span> size = N * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int</span>);<br><span class="hljs-type">int</span> *a;<br><br>a = (<span class="hljs-type">int</span> *)<span class="hljs-built_in">malloc</span>(size);<br><span class="hljs-built_in">free</span>(a);<br><br><span class="hljs-comment">// åŠ é€Ÿå</span><br><span class="hljs-type">int</span> N = <span class="hljs-number">2</span>&lt;&lt;<span class="hljs-number">20</span>;<br><span class="hljs-type">size_t</span> size = N * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int</span>);<br><span class="hljs-type">int</span> *a;<br><span class="hljs-comment">// açš„åœ°å€ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’</span><br><span class="hljs-built_in">cudaMallocManaged</span>(&amp;a, size);<br><span class="hljs-built_in">cudaFree</span>(a);<br></code></pre></td></tr></table></figure>
<h2 id="ç½‘æ ¼å¤§å°ä¸å·¥ä½œé‡ä¸åŒ¹é…">ç½‘æ ¼å¤§å°ä¸å·¥ä½œé‡ä¸åŒ¹é…</h2>
<p>å¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œæ‰§è¡Œé…ç½®æ‰€åˆ›å»ºçš„çº¿ç¨‹æ•°æ— æ³•åŒ¹é…ä¸ºå®ç°å¹¶è¡Œå¾ªç¯æ‰€éœ€çš„çº¿ç¨‹æ•°ã€‚</p>
<p>ä¸€ä¸ªå¸¸è§çš„ä¾‹å­ä¸å¸Œæœ›é€‰æ‹©çš„æœ€ä½³çº¿ç¨‹å—å¤§å°æœ‰å…³ã€‚ä¾‹å¦‚ï¼Œé‰´äº GPU çš„ç¡¬ä»¶ç‰¹æ€§ï¼Œæ‰€å«çº¿ç¨‹çš„æ•°é‡ä¸º 32 çš„å€æ•°çš„çº¿ç¨‹å—æ˜¯æœ€ç†æƒ³çš„é€‰æ‹©ï¼Œå› å…¶å…·å¤‡æ€§èƒ½ä¸Šçš„ä¼˜åŠ¿ã€‚å‡è®¾æˆ‘ä»¬è¦å¯åŠ¨ä¸€äº›çº¿ç¨‹å—ä¸”æ¯ä¸ªçº¿ç¨‹å—ä¸­å‡åŒ…å« 256 ä¸ªçº¿ç¨‹ï¼ˆ32 çš„å€æ•°ï¼‰ï¼Œå¹¶éœ€è¿è¡Œ 1000 ä¸ªå¹¶è¡Œä»»åŠ¡ï¼ˆæ­¤å¤„ä½¿ç”¨æå°çš„æ•°é‡ä»¥ä¾¿äºè¯´æ˜ï¼‰ï¼Œåˆ™ä»»ä½•æ•°é‡çš„çº¿ç¨‹å—å‡æ— æ³•åœ¨ç½‘æ ¼ä¸­ç²¾ç¡®ç”Ÿæˆ 1000 ä¸ªæ€»çº¿ç¨‹ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•æ•´æ•°å€¼åœ¨ä¹˜ä»¥ 32 åå¯ä»¥æ°å¥½ç­‰äº 1000ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è½»æ¾åœ°è§£å†³ï¼š</p>
<ul>
<li>ç¼–å†™æ‰§è¡Œé…ç½®ï¼Œä½¿å…¶åˆ›å»ºçš„çº¿ç¨‹æ•°<strong>è¶…è¿‡</strong>æ‰§è¡Œåˆ†é…å·¥ä½œæ‰€éœ€çš„çº¿ç¨‹æ•°ã€‚</li>
<li>å°†ä¸€ä¸ªå€¼ä½œä¸ºå‚æ•°ä¼ é€’åˆ°æ ¸å‡½æ•° (<code>N</code>) ä¸­ï¼Œè¯¥å€¼è¡¨ç¤ºè¦å¤„ç†çš„æ•°æ®é›†æ€»å¤§å°æˆ–å®Œæˆå·¥ä½œæ‰€éœ€çš„æ€»çº¿ç¨‹æ•°ã€‚</li>
<li>è®¡ç®—ç½‘æ ¼å†…çš„çº¿ç¨‹ç´¢å¼•åï¼ˆä½¿ç”¨ <code>threadIdx + blockIdx*blockDim</code>ï¼‰ï¼Œè¯·æ£€æŸ¥è¯¥ç´¢å¼•æ˜¯å¦è¶…è¿‡ <code>N</code>ï¼Œå¹¶ä¸”åªåœ¨ä¸è¶…è¿‡çš„æƒ…å†µä¸‹æ‰§è¡Œä¸æ ¸å‡½æ•°ç›¸å…³çš„å·¥ä½œã€‚</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ç¼–å†™æ‰§è¡Œé…ç½®çš„æƒ¯ç”¨æ–¹æ³•ç¤ºä¾‹ï¼Œé€‚ç”¨äº <code>N</code> å’Œçº¿ç¨‹å—ä¸­çš„çº¿ç¨‹æ•°å·²çŸ¥ï¼Œä½†æ— æ³•ä¿è¯ç½‘æ ¼ä¸­çš„çº¿ç¨‹æ•°å’Œ <code>N</code> ä¹‹é—´å®Œå…¨åŒ¹é…çš„æƒ…å†µã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä¾¿å¯ç¡®ä¿ç½‘æ ¼ä¸­è‡³å°‘å§‹ç»ˆæ‹¥æœ‰ <code>N</code> æ‰€éœ€çš„çº¿ç¨‹æ•°ï¼Œä¸”è¶…å‡ºçš„çº¿ç¨‹æ•°è‡³å¤šä»…å¯ç›¸å½“äº 1 ä¸ªçº¿ç¨‹å—çš„çº¿ç¨‹æ•°é‡ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Nå·²çŸ¥</span><br><span class="hljs-type">int</span> N = <span class="hljs-number">100000</span>;<br><br><span class="hljs-comment">// æ¯ä¸ªçº¿ç¨‹å—å‡åŒ…å«256ä¸ªçº¿ç¨‹</span><br><span class="hljs-type">size_t</span> threads_per_block = <span class="hljs-number">256</span>;<br><br><span class="hljs-comment">// ç¡®ä¿ç½‘æ ¼ä¸­è‡³å°‘å§‹ç»ˆæ‹¥æœ‰ `N` æ‰€éœ€çš„çº¿ç¨‹æ•°ï¼Œä¸”è¶…å‡ºçš„çº¿ç¨‹æ•°è‡³å¤šä»…å¯ç›¸å½“äº 1 ä¸ªçº¿ç¨‹å—çš„çº¿ç¨‹æ•°é‡</span><br><span class="hljs-type">size_t</span> number_of_blocks = (N + threads_per_block - <span class="hljs-number">1</span>) / threads_per_block;<br><br>some_kernel&lt;&lt;&lt;number_of_blocks, threads_per_block&gt;&gt;&gt;(N);<br></code></pre></td></tr></table></figure>
<p>ç”±äºä¸Šè¿°æ‰§è¡Œé…ç½®è‡´ä½¿ç½‘æ ¼ä¸­çš„çº¿ç¨‹æ•°è¶…è¿‡ <code>N</code>ï¼Œå› æ­¤éœ€è¦æ³¨æ„ <code>some_kernel</code> å®šä¹‰ä¸­çš„å†…å®¹ï¼Œä»¥ç¡®ä¿ <code>some_kernel</code> åœ¨ç”±å…¶ä¸­ä¸€ä¸ª â€é¢å¤–çš„â€ çº¿ç¨‹æ‰§è¡Œæ—¶ä¸ä¼šå°è¯•è®¿é—®è¶…å‡ºèŒƒå›´çš„æ•°æ®å…ƒç´ ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">__global__ <span class="hljs-title">some_kernel</span><span class="hljs-params">(<span class="hljs-type">int</span> N)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> idx = threadIdx.x + blockIdx.x * blockDim.x;<br><br>  <span class="hljs-keyword">if</span> (idx &lt; N) <span class="hljs-comment">// æ£€æŸ¥çº¿ç¨‹ç´¢å¼•æ˜¯å¦è¶…è¿‡N</span><br>  &#123;<br>    <span class="hljs-comment">//æ¡ä»¶æ»¡è¶³æ—¶æ‰§è¡Œ</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="è·¨ç½‘æ ¼çš„å¾ªç¯">è·¨ç½‘æ ¼çš„å¾ªç¯</h2>
<p>æˆ–å‡ºäºé€‰æ‹©ï¼Œä¸ºäº†è¦åˆ›å»ºå…·æœ‰è¶…é«˜æ€§èƒ½çš„æ‰§è¡Œé…ç½®ï¼Œæˆ–å‡ºäºéœ€è¦ï¼Œä¸€ä¸ªç½‘æ ¼ä¸­çš„çº¿ç¨‹æ•°é‡å¯èƒ½ä¼šå°äºæ•°æ®é›†çš„å¤§å°ã€‚è¯·æ€è€ƒä¸€ä¸‹åŒ…å« 1000 ä¸ªå…ƒç´ çš„æ•°ç»„å’ŒåŒ…å« 250 ä¸ªçº¿ç¨‹çš„ç½‘æ ¼ï¼ˆæ­¤å¤„ä½¿ç”¨æå°çš„è§„æ¨¡ä»¥ä¾¿äºè¯´æ˜ï¼‰ã€‚æ­¤ç½‘æ ¼ä¸­çš„æ¯ä¸ªçº¿ç¨‹å°†éœ€ä½¿ç”¨ 4 æ¬¡ã€‚å¦‚è¦å®ç°æ­¤æ“ä½œï¼Œä¸€ç§å¸¸ç”¨æ–¹æ³•ä¾¿æ˜¯åœ¨æ ¸å‡½æ•°ä¸­ä½¿ç”¨<strong>è·¨ç½‘æ ¼å¾ªç¯</strong>ã€‚</p>
<p>åœ¨è·¨ç½‘æ ¼å¾ªç¯ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹å°†åœ¨ç½‘æ ¼å†…ä½¿ç”¨ <code>threadIdx + blockIdx*blockDim</code> è®¡ç®—è‡ªèº«å”¯ä¸€çš„ç´¢å¼•ï¼Œå¹¶å¯¹æ•°ç»„å†…è¯¥ç´¢å¼•çš„å…ƒç´ æ‰§è¡Œç›¸åº”è¿ç®—ï¼Œç„¶åå°†ç½‘æ ¼ä¸­çš„çº¿ç¨‹æ•°æ·»åŠ åˆ°ç´¢å¼•å¹¶é‡å¤æ­¤æ“ä½œï¼Œç›´è‡³è¶…å‡ºæ•°ç»„èŒƒå›´ã€‚ä¾‹å¦‚ï¼Œå¯¹äºåŒ…å« 500 ä¸ªå…ƒç´ çš„æ•°ç»„å’ŒåŒ…å« 250 ä¸ªçº¿ç¨‹çš„ç½‘æ ¼ï¼Œç½‘æ ¼ä¸­ç´¢å¼•ä¸º 20 çš„çº¿ç¨‹å°†æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>
<ul>
<li>å¯¹åŒ…å« 500 ä¸ªå…ƒç´ çš„æ•°ç»„çš„å…ƒç´  20 æ‰§è¡Œç›¸åº”è¿ç®—</li>
<li>å°†å…¶ç´¢å¼•å¢åŠ  250ï¼Œä½¿ç½‘æ ¼çš„å¤§å°è¾¾åˆ° 270</li>
<li>å¯¹åŒ…å« 500 ä¸ªå…ƒç´ çš„æ•°ç»„çš„å…ƒç´  270 æ‰§è¡Œç›¸åº”è¿ç®—</li>
<li>å°†å…¶ç´¢å¼•å¢åŠ  250ï¼Œä½¿ç½‘æ ¼çš„å¤§å°è¾¾åˆ° 520</li>
<li>ç”±äº 520 ç°å·²è¶…å‡ºæ•°ç»„èŒƒå›´ï¼Œå› æ­¤çº¿ç¨‹å°†åœæ­¢å·¥ä½œ</li>
</ul>
<p>CUDA æä¾›ä¸€ä¸ªå¯ç»™å‡ºç½‘æ ¼ä¸­çº¿ç¨‹å—æ•°çš„ç‰¹æ®Šå˜é‡ï¼š<code>gridDim.x</code>ã€‚ç„¶åè®¡ç®—ç½‘æ ¼ä¸­çš„æ€»çº¿ç¨‹æ•°ï¼Œå³ç½‘æ ¼ä¸­çš„çº¿ç¨‹å—æ•°ä¹˜ä»¥æ¯ä¸ªçº¿ç¨‹å—ä¸­çš„çº¿ç¨‹æ•°ï¼š<code>gridDim.x * blockDim.x</code>ã€‚å¸¦ç€è¿™æ ·çš„æƒ³æ³•æ¥çœ‹çœ‹ä»¥ä¸‹æ ¸å‡½æ•°ä¸­ç½‘æ ¼è·¨åº¦å¾ªç¯çš„è¯¦ç»†ç¤ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">__global__ <span class="hljs-type">void</span> <span class="hljs-title">kernel</span><span class="hljs-params">(<span class="hljs-type">int</span> *a, <span class="hljs-type">int</span> N)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> indexWithinTheGrid = threadIdx.x + blockIdx.x * blockDim.x;<br>  <span class="hljs-type">int</span> gridStride = gridDim.x * blockDim.x;<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = indexWithinTheGrid; i &lt; N; i += gridStride)<br>  &#123;<br>    <span class="hljs-comment">// do work on a[i];</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†</h2>
<ol>
<li>ä¸åœ¨ä»»ä½•åº”ç”¨ç¨‹åºä¸­ä¸€æ ·ï¼ŒåŠ é€Ÿ CUDA ä»£ç ä¸­çš„é”™è¯¯å¤„ç†åŒæ ·è‡³å…³é‡è¦ã€‚å³ä¾¿ä¸æ˜¯å¤§å¤šæ•°ï¼Œä¹Ÿæœ‰è®¸å¤š CUDA å‡½æ•°ï¼ˆä¾‹å¦‚ï¼Œ<a href="http://docs.nvidia.com/cuda/cuda-runtime-api/group__CUDART__MEMORY.html#group__CUDART__MEMORY">å†…å­˜ç®¡ç†å‡½æ•°</a>ï¼‰ä¼šè¿”å›ç±»å‹ä¸º <code>cudaError_t</code> çš„å€¼ï¼Œè¯¥å€¼å¯ç”¨äºæ£€æŸ¥è°ƒç”¨å‡½æ•°æ—¶æ˜¯å¦å‘ç”Ÿé”™è¯¯ã€‚ä»¥ä¸‹æ˜¯å¯¹è°ƒç”¨ <code>cudaMallocManaged</code> å‡½æ•°æ‰§è¡Œé”™è¯¯å¤„ç†çš„ç¤ºä¾‹ï¼š</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp">cudaError_t err;<br>err = <span class="hljs-built_in">cudaMallocManaged</span>(&amp;a, N)                    <span class="hljs-comment">// Assume the existence of `a` and `N`.</span><br><br><span class="hljs-keyword">if</span> (err != cudaSuccess)                           <span class="hljs-comment">// `cudaSuccess` is provided by CUDA.</span><br>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error: %s\n&quot;</span>, <span class="hljs-built_in">cudaGetErrorString</span>(err)); <span class="hljs-comment">// `cudaGetErrorString` is provided by CUDA.</span><br>&#125;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>å¯åŠ¨å®šä¹‰ä¸ºè¿”å› <code>void</code> çš„æ ¸å‡½æ•°åï¼Œå°†ä¸ä¼šè¿”å›ç±»å‹ä¸º <code>cudaError_t</code> çš„å€¼ã€‚ä¸ºæ£€æŸ¥å¯åŠ¨æ ¸å‡½æ•°æ—¶æ˜¯å¦å‘ç”Ÿé”™è¯¯ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå¯åŠ¨é…ç½®é”™è¯¯ï¼‰ï¼ŒCUDA æä¾› <code>cudaGetLastError</code> å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¿”å›ç±»å‹ä¸º <code>cudaError_t</code> çš„å€¼ã€‚</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * This launch should cause an error, but the kernel itself</span><br><span class="hljs-comment"> * cannot return it.</span><br><span class="hljs-comment"> */</span><br><br>someKernel&lt;&lt;&lt;<span class="hljs-number">1</span>, <span class="hljs-number">-1</span>&gt;&gt;&gt;();  <span class="hljs-comment">// -1 is not a valid number of threads.</span><br><br>cudaError_t err;<br>err = <span class="hljs-built_in">cudaGetLastError</span>(); <span class="hljs-comment">// `cudaGetLastError` will return the error from above.</span><br><span class="hljs-keyword">if</span> (err != cudaSuccess)<br>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error: %s\n&quot;</span>, <span class="hljs-built_in">cudaGetErrorString</span>(err));<br>&#125;<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>æœ€åï¼Œä¸ºæ•æ‰å¼‚æ­¥é”™è¯¯ï¼ˆä¾‹å¦‚ï¼Œåœ¨å¼‚æ­¥æ ¸å‡½æ•°æ‰§è¡ŒæœŸé—´ï¼‰ï¼Œè¯·åŠ¡å¿…æ£€æŸ¥åç»­åŒæ­¥ CUDA è¿è¡Œæ—¶ API è°ƒç”¨æ‰€è¿”å›çš„çŠ¶æ€ï¼ˆä¾‹å¦‚ <code>cudaDeviceSynchronize</code>ï¼‰ï¼›å¦‚æœä¹‹å‰å¯åŠ¨çš„å…¶ä¸­ä¸€ä¸ªæ ¸å‡½æ•°å¤±è´¥ï¼Œåˆ™å°†è¿”å›é”™è¯¯ã€‚</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c">cudaError_t err;<br>err = cudaDeviceSynchronize();                <span class="hljs-comment">// Assume the existence of `a` and `N`.</span><br><br><span class="hljs-keyword">if</span> (err != cudaSuccess)                           <span class="hljs-comment">// `cudaSuccess` is provided by CUDA.</span><br>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error: %s\n&quot;</span>, cudaGetErrorString(err)); <span class="hljs-comment">// `cudaGetErrorString` is provided by CUDA.</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="CUDAé”™è¯¯å¤„ç†åŠŸèƒ½">CUDAé”™è¯¯å¤„ç†åŠŸèƒ½</h3>
<p>åˆ›å»ºä¸€ä¸ªåŒ…è£… CUDA å‡½æ•°è°ƒç”¨çš„å®å¯¹äºæ£€æŸ¥é”™è¯¯ååˆ†æœ‰ç”¨ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®ç¤ºä¾‹ï¼Œæ‚¨å¯ä»¥åœ¨ä½™ä¸‹ç»ƒä¹ ä¸­éšæ—¶ä½¿ç”¨ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;assert.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> cudaError_t <span class="hljs-title">checkCuda</span><span class="hljs-params">(cudaError_t result)</span><span class="hljs-comment">//inline å…³é”®å­—æç¤ºç¼–è¯‘å™¨å°è¯•å°†è¯¥å‡½æ•°å†…è”ï¼Œè¿™å¯ä»¥æé«˜æ€§èƒ½ã€‚</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span> (result != cudaSuccess) &#123;<span class="hljs-comment">//è¿™ä¸ªæ¡ä»¶æ£€æŸ¥CUDAæ“ä½œçš„ç»“æœæ˜¯å¦ä¸ç­‰äº cudaSuccessã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™æ‰§è¡Œifå—å†…çš„ä»£ç ã€‚</span><br>    <span class="hljs-built_in">fprintf</span>(stderr, <span class="hljs-string">&quot;CUDA Runtime Error: %s\n&quot;</span>, <span class="hljs-built_in">cudaGetErrorString</span>(result));<br>    <span class="hljs-built_in">assert</span>(result == cudaSuccess);<span class="hljs-comment">//ä½¿ç”¨ assert å®æ£€æŸ¥ç»“æœæ˜¯å¦ç­‰äº cudaSuccessã€‚å¦‚æœä¸ç­‰äºï¼Œè¿™ä¼šè§¦å‘ä¸€ä¸ªæ–­è¨€å¤±è´¥ï¼Œå¦‚æœå¯ç”¨äº†æ–­è¨€ï¼Œç¨‹åºå°†ç»ˆæ­¢ã€‚</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-comment">/*...*/</span><br>  <span class="hljs-built_in">checkCuda</span>( <span class="hljs-built_in">cudaDeviceSynchronize</span>() )<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="2ç»´å’Œ3ç»´çš„ç½‘æ ¼å’Œå—">2ç»´å’Œ3ç»´çš„ç½‘æ ¼å’Œå—</h2>
<p>å¯ä»¥å°†ç½‘æ ¼å’Œçº¿ç¨‹å—å®šä¹‰ä¸ºæœ€å¤šå…·æœ‰ 3 ä¸ªç»´åº¦ã€‚ä½¿ç”¨å¤šä¸ªç»´åº¦å®šä¹‰ç½‘æ ¼å’Œçº¿ç¨‹å—ç»ä¸ä¼šå¯¹å…¶æ€§èƒ½é€ æˆä»»ä½•å½±å“ï¼Œä½†è¿™åœ¨å¤„ç†å…·æœ‰å¤šä¸ªç»´åº¦çš„æ•°æ®æ—¶å¯èƒ½éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ 2D çŸ©é˜µã€‚å¦‚è¦å®šä¹‰äºŒç»´æˆ–ä¸‰ç»´ç½‘æ ¼æˆ–çº¿ç¨‹å—ï¼Œå¯ä»¥ä½¿ç”¨ CUDA çš„ <code>dim3</code> ç±»å‹ï¼Œå³å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">dim3 <span class="hljs-title">threads_per_block</span><span class="hljs-params">(<span class="hljs-number">16</span>, <span class="hljs-number">16</span>, <span class="hljs-number">1</span>)</span></span>;<br><span class="hljs-function">dim3 <span class="hljs-title">number_of_blocks</span><span class="hljs-params">(<span class="hljs-number">16</span>, <span class="hljs-number">16</span>, <span class="hljs-number">1</span>)</span></span>;<br>someKernel&lt;&lt;&lt;number_of_blocks, threads_per_block&gt;&gt;&gt;();<br></code></pre></td></tr></table></figure>
<p>é‰´äºä»¥ä¸Šç¤ºä¾‹ï¼Œ<code>someKernel</code> å†…éƒ¨çš„å˜é‡ <code>gridDim.x</code>ã€<code>gridDim.y</code>ã€<code>blockDim.x</code> å’Œ <code>blockDim.y</code> å‡å°†ç­‰äº <code>16</code>ã€‚</p>
<p>æ­¤å¤„ä»‹ç»ä¸€ä¸ªä¸‡èƒ½çš„ç´¢å¼•è®¡ç®—å¼</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> tid = blockIdx.z * (gridDim.x * gridDim.y) * (blockDim.x * blockDim.y * blockDim.z)\ <br>    <span class="hljs-comment">//å—åœ¨zæ–¹å‘ä¸Šçš„ç´¢å¼•</span><br>          + blockIdx.y * gridDim.x * (blockDim.x * blockDim.y * blockDim.z) \			<br>    <span class="hljs-comment">//å—åœ¨yæ–¹å‘ä¸Šçš„ç´¢å¼•</span><br>          + blockIdx.x * (blockDim.x * blockDim.y * blockDim.z) \                      <br>    <span class="hljs-comment">//å—åœ¨xæ–¹å‘ä¸Šçš„ç´¢å¼•</span><br>      	  + threadIdx.z * (blockDim.x * blockDim.y) \                                 <br>    <span class="hljs-comment">//çº¿ç¨‹åœ¨zæ–¹å‘ä¸Šçš„ç´¢å¼•</span><br>          + threadIdx.y * blockDim.x \                                               <br>    <span class="hljs-comment">//çº¿ç¨‹åœ¨yæ–¹å‘ä¸Šçš„ç´¢å¼•</span><br>          + threadIdx.x;                                                            <br>    <span class="hljs-comment">//çº¿ç¨‹åœ¨xæ–¹å‘ä¸Šçš„ç´¢å¼•</span><br></code></pre></td></tr></table></figure>
<h1><strong>ä½¿ç”¨ CUDA C/C++ ç»Ÿä¸€å†…å­˜å’Œ Nsight Systems (nsys) ç®¡ç†åŠ é€Ÿåº”ç”¨ç¨‹åºå†…å­˜</strong></h1>
<h2 id="å­¦ä¹ ç›®æ ‡">å­¦ä¹ ç›®æ ‡</h2>
<p>å½“æ‚¨åœ¨æœ¬å®éªŒå®Œæˆå­¦ä¹ åï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š</p>
<ul>
<li>ä½¿ç”¨ <strong>Nsight Systemså‘½ä»¤è¡Œåˆ†æå™¨</strong> (<strong>nsys</strong>) åˆ†æè¢«åŠ é€Ÿçš„åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</li>
<li>åˆ©ç”¨å¯¹<strong>æµå¤šå¤„ç†å™¨</strong>çš„ç†è§£ä¼˜åŒ–æ‰§è¡Œé…ç½®ã€‚</li>
<li>ç†è§£<strong>ç»Ÿä¸€å†…å­˜</strong>åœ¨é¡µé”™è¯¯å’Œæ•°æ®è¿ç§»æ–¹é¢çš„è¡Œä¸ºã€‚</li>
<li>ä½¿ç”¨<strong>å¼‚æ­¥å†…å­˜é¢„å–</strong>å‡å°‘é¡µé”™è¯¯å’Œæ•°æ®è¿ç§»ä»¥æé«˜æ€§èƒ½ã€‚</li>
<li>é‡‡ç”¨å¾ªç¯å¼çš„è¿­ä»£å¼€å‘åŠ å¿«åº”ç”¨ç¨‹åºçš„ä¼˜åŒ–åŠ é€Ÿå’Œéƒ¨ç½²ã€‚</li>
</ul>
<h2 id="ä½¿ç”¨nsysæ€§èƒ½åˆ†æå™¨å¸®åŠ©åº”ç”¨ç¨‹åºè¿­ä»£åœ°è¿›è¡Œä¼˜åŒ–">ä½¿ç”¨nsysæ€§èƒ½åˆ†æå™¨å¸®åŠ©åº”ç”¨ç¨‹åºè¿­ä»£åœ°è¿›è¡Œä¼˜åŒ–</h2>
<p>å¦‚è¦ç¡®ä¿ä¼˜åŒ–åŠ é€Ÿä»£ç åº“çš„å°è¯•çœŸæ­£å–å¾—æˆåŠŸï¼Œå”¯ä¸€æ–¹æ³•ä¾¿æ˜¯åˆ†æåº”ç”¨ç¨‹åºä»¥è·å–æœ‰å…³å…¶æ€§èƒ½çš„å®šé‡ä¿¡æ¯ã€‚<code>nsys</code> æ˜¯æŒ‡ NVIDIA çš„Nsight Systemå‘½ä»¤è¡Œåˆ†æå™¨ã€‚è¯¥åˆ†æå™¨é™„å¸¦äºCUDAå·¥å…·åŒ…ä¸­ï¼Œæä¾›åˆ†æè¢«åŠ é€Ÿçš„åº”ç”¨ç¨‹åºæ€§èƒ½çš„å¼ºå¤§åŠŸèƒ½ã€‚</p>
<p><code>nsys</code> ä½¿ç”¨èµ·æ¥ååˆ†ç®€å•ï¼Œæœ€åŸºæœ¬ç”¨æ³•æ˜¯å‘å…¶ä¼ é€’ä½¿ç”¨ <code>nvcc</code> ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ã€‚éšå <code>nsys</code> ä¼šç»§ç»­æ‰§è¡Œåº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨æ­¤ä¹‹åæ‰“å°åº”ç”¨ç¨‹åº GPU æ´»åŠ¨çš„æ‘˜è¦è¾“å‡ºã€CUDA API è°ƒç”¨ä»¥åŠ<strong>ç»Ÿä¸€å†…å­˜</strong>æ´»åŠ¨çš„ç›¸å…³ä¿¡æ¯ã€‚æˆ‘ä»¬ç¨åä¼šåœ¨æœ¬å®éªŒä¸­è¯¦ç»†ä»‹ç»è¿™ä¸€ä¸»é¢˜ã€‚</p>
<p>åœ¨åŠ é€Ÿåº”ç”¨ç¨‹åºæˆ–ä¼˜åŒ–å·²ç»åŠ é€Ÿçš„åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬åº”è¯¥é‡‡ç”¨ç§‘å­¦çš„è¿­ä»£æ–¹æ³•ã€‚ä½œå‡ºæ›´æ”¹åéœ€åˆ†æåº”ç”¨ç¨‹åºã€åšå¥½è®°å½•å¹¶è®°å½•ä»»ä½•é‡æ„å¯èƒ½ä¼šå¯¹æ€§èƒ½é€ æˆä½•ç§å½±å“ã€‚å°½æ—©ä¸”ç»å¸¸è¿›è¡Œæ­¤ç±»è§‚å¯Ÿé€šå¸¸ä¼šè®©æ‚¨è½»æ¾è·å¾—è¶³å¤Ÿçš„æ€§èƒ½æå‡ï¼Œä»¥åŠ©æ‚¨å‘å¸ƒåŠ é€Ÿåº”ç”¨ç¨‹åºã€‚æ­¤å¤–ï¼Œç»å¸¸åˆ†æåº”ç”¨ç¨‹åºå°†ä½¿æ‚¨äº†è§£åˆ°å¯¹ CUDA ä»£ç åº“ä½œå‡ºçš„ç‰¹å®šæ›´æ”¹ä¼šå¯¹å…¶å®é™…æ€§èƒ½é€ æˆä½•ç§å½±å“ï¼šè€Œå½“åªåœ¨ä»£ç åº“ä¸­è¿›è¡Œå¤šç§æ›´æ”¹åå†åˆ†æåº”ç”¨ç¨‹åºæ—¶ï¼Œå°†å¾ˆéš¾å¾—çŸ¥è¿™ä¸€ç‚¹ã€‚</p>
<p><code>nsys profile</code>å°†ç”Ÿæˆä¸€ä¸ª<code>qdrep</code>æŠ¥å‘Šæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯ä»¥ä»¥å¤šç§æ–¹å¼ä½¿ç”¨ã€‚ æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨<code>--stats = true</code>æ ‡å¿—è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›æ‰“å°è¾“å‡ºæ‘˜è¦ç»Ÿè®¡ä¿¡æ¯ã€‚ è¾“å‡ºçš„ä¿¡æ¯æœ‰å¾ˆå¤šï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>é…ç½®æ–‡ä»¶é…ç½®è¯¦ç»†ä¿¡æ¯</li>
<li>æŠ¥å‘Šæ–‡ä»¶çš„ç”Ÿæˆè¯¦ç»†ä¿¡æ¯</li>
<li><strong>CUDA APIç»Ÿè®¡ä¿¡æ¯</strong></li>
<li><strong>CUDAæ ¸å‡½æ•°çš„ç»Ÿè®¡ä¿¡æ¯</strong></li>
<li><strong>CUDAå†…å­˜æ“ä½œç»Ÿè®¡ä¿¡æ¯ï¼ˆæ—¶é—´å’Œå¤§å°ï¼‰</strong></li>
<li>æ“ä½œç³»ç»Ÿå†…æ ¸è°ƒç”¨æ¥å£çš„ç»Ÿè®¡ä¿¡æ¯</li>
</ul>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>nsys profile</code>ä¸ä¼šè¦†ç›–ç°æœ‰çš„æŠ¥å‘Šæ–‡ä»¶ã€‚ è¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢åœ¨è¿›è¡Œæ¦‚è¦åˆ†ææ—¶æ„å¤–ä¸¢å¤±å·¥ä½œã€‚ å¦‚æœå‡ºäºæŸç§åŸå› ï¼Œæ‚¨å®æ„¿è¦†ç›–ç°æœ‰çš„æŠ¥å‘Šæ–‡ä»¶ï¼Œä¾‹å¦‚åœ¨å¿«é€Ÿè¿­ä»£æœŸé—´ï¼Œå¯ä»¥å‘<code>nsys profile</code>æä¾›<code>-f</code>æ ‡å¿—ä»¥å…è®¸è¦†ç›–ç°æœ‰çš„æŠ¥å‘Šæ–‡ä»¶ã€‚</p>
<p><strong>ç»ƒä¹ </strong></p>
<p>ä¼˜åŒ–å‰<a href="http://dli-604a4aa51b37-ee1ab7.aws.labs.courses.nvidia.com/lab/edit/01-vector-add/01-vector-add.cu">01-vector-add.cu</a></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">initWith</span><span class="hljs-params">(<span class="hljs-type">float</span> num, <span class="hljs-type">float</span> *a, <span class="hljs-type">int</span> N)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; N; ++i)<br>  &#123;<br>    a[i] = num;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Device kernel stores into `result` the sum of each</span><br><span class="hljs-comment"> * same-indexed value of `a` and `b`.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-function">__global__</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addVectorsInto</span><span class="hljs-params">(<span class="hljs-type">float</span> *result, <span class="hljs-type">float</span> *a, <span class="hljs-type">float</span> *b, <span class="hljs-type">int</span> N)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> index = threadIdx.x + blockIdx.x * blockDim.x;<br>  <span class="hljs-type">int</span> stride = blockDim.x * gridDim.x;<br><br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = index; i &lt; N; i += stride)<br>  &#123;<br>    result[i] = a[i] + b[i];<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Host function to confirm values in `vector`. This function</span><br><span class="hljs-comment"> * assumes all values are the same `target` value.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">checkElementsAre</span><span class="hljs-params">(<span class="hljs-type">float</span> target, <span class="hljs-type">float</span> *vector, <span class="hljs-type">int</span> N)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; N; i++)<br>  &#123;<br>    <span class="hljs-keyword">if</span>(vector[i] != target)<br>    &#123;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;FAIL: vector[%d] - %0.0f does not equal %0.0f\n&quot;</span>, i, vector[i], target);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Success! All values calculated correctly.\n&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">const</span> <span class="hljs-type">int</span> N = <span class="hljs-number">2</span>&lt;&lt;<span class="hljs-number">24</span>;<br>  <span class="hljs-type">size_t</span> size = N * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>);<br><br>  <span class="hljs-type">float</span> *a;<br>  <span class="hljs-type">float</span> *b;<br>  <span class="hljs-type">float</span> *c;<br><br>  <span class="hljs-built_in">cudaMallocManaged</span>(&amp;a, size);<br>  <span class="hljs-built_in">cudaMallocManaged</span>(&amp;b, size);<br>  <span class="hljs-built_in">cudaMallocManaged</span>(&amp;c, size);<br><br>  <span class="hljs-built_in">initWith</span>(<span class="hljs-number">3</span>, a, N);<br>  <span class="hljs-built_in">initWith</span>(<span class="hljs-number">4</span>, b, N);<br>  <span class="hljs-built_in">initWith</span>(<span class="hljs-number">0</span>, c, N);<br><br>  <span class="hljs-type">size_t</span> threadsPerBlock;<br>  <span class="hljs-type">size_t</span> numberOfBlocks;<br><br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">   * nsys should register performance changes when execution configuration</span><br><span class="hljs-comment">   * is updated.</span><br><span class="hljs-comment">   */</span><br><br>  threadsPerBlock = <span class="hljs-number">1</span>;<br>  numberOfBlocks = <span class="hljs-number">1</span>;<br><br>  cudaError_t addVectorsErr;<br>  cudaError_t asyncErr;<br><br>  addVectorsInto&lt;&lt;&lt;numberOfBlocks, threadsPerBlock&gt;&gt;&gt;(c, a, b, N);<br><br>  addVectorsErr = <span class="hljs-built_in">cudaGetLastError</span>();<br>  <span class="hljs-keyword">if</span>(addVectorsErr != cudaSuccess) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error: %s\n&quot;</span>, <span class="hljs-built_in">cudaGetErrorString</span>(addVectorsErr));<br><br>  asyncErr = <span class="hljs-built_in">cudaDeviceSynchronize</span>();<br>  <span class="hljs-keyword">if</span>(asyncErr != cudaSuccess) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error: %s\n&quot;</span>, <span class="hljs-built_in">cudaGetErrorString</span>(asyncErr));<br><br>  <span class="hljs-built_in">checkElementsAre</span>(<span class="hljs-number">7</span>, c, N);<br><br>  <span class="hljs-built_in">cudaFree</span>(a);<br>  <span class="hljs-built_in">cudaFree</span>(b);<br>  <span class="hljs-built_in">cudaFree</span>(c);<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>ä¼˜åŒ–å°†77è¡Œçš„çš„threadsPerblockæ”¹ä¸º1024å³å¯ï¼Œåˆ†æå¯å¾—æ ¸å‡½æ•°è¿è¡Œæ—¶é—´åŠ å¿«äº†ä¸€ä¸ªé‡çº§ï¼Œæ­¤å¤–cudaDeviceSynchronize()è¿è¡Œæ—¶é—´ä¹Ÿå¤§å¹…ç¼©çŸ­ï¼Œæ˜“äºç†è§£ã€‚</p>
<h2 id="æµå¤šå¤„ç†å™¨ï¼ˆStreaming-Multiprocessorsï¼‰åŠæŸ¥è¯¢GPUçš„è®¾å¤‡é…ç½®">æµå¤šå¤„ç†å™¨ï¼ˆStreaming Multiprocessorsï¼‰åŠæŸ¥è¯¢GPUçš„è®¾å¤‡é…ç½®</h2>
<h3 id="æµå¤šå¤„ç†å™¨å’ŒWarps">æµå¤šå¤„ç†å™¨å’ŒWarps</h3>
<p>è¿è¡Œ CUDA åº”ç”¨ç¨‹åºçš„ GPU å…·æœ‰ç§°ä¸º<strong>æµå¤šå¤„ç†å™¨</strong>ï¼ˆæˆ– <strong>SM</strong>ï¼‰çš„å¤„ç†å•å…ƒã€‚åœ¨æ ¸å‡½æ•°æ‰§è¡ŒæœŸé—´ï¼Œå°†çº¿ç¨‹å—æä¾›ç»™ SM ä»¥ä¾›å…¶æ‰§è¡Œã€‚ä¸ºæ”¯æŒ GPU æ‰§è¡Œå°½å¯èƒ½å¤šçš„å¹¶è¡Œæ“ä½œï¼Œæ‚¨é€šå¸¸å¯ä»¥<em>é€‰æ‹©çº¿ç¨‹å—æ•°é‡æ•°å€äºæŒ‡å®š GPU ä¸Š SM æ•°é‡çš„ç½‘æ ¼å¤§å°</em>æ¥æå‡æ€§èƒ½ã€‚ï¼ˆæé«˜SMçš„åˆ©ç”¨ç‡ï¼‰</p>
<p>æ­¤å¤–ï¼ŒSM ä¼šåœ¨ä¸€ä¸ªåä¸º<strong>warp</strong>çš„çº¿ç¨‹å—å†…åˆ›å»ºã€ç®¡ç†ã€è°ƒåº¦å’Œæ‰§è¡ŒåŒ…å« 32 ä¸ªçº¿ç¨‹çš„çº¿ç¨‹ç»„ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯ä»¥<em>åˆ†é…æ•°é‡æ•°å€äº 32 çš„çº¿ç¨‹æ•°é‡</em>æ¥æå‡æ€§èƒ½ã€‚</p>
<h3 id="ä»¥ç¼–ç¨‹æ–¹å¼æŸ¥è¯¢GPUè®¾å¤‡å±æ€§">ä»¥ç¼–ç¨‹æ–¹å¼æŸ¥è¯¢GPUè®¾å¤‡å±æ€§</h3>
<p>ç”±äº GPU ä¸Šçš„ SM æ•°é‡ä¼šå› æ‰€ç”¨çš„ç‰¹å®š GPU è€Œå¼‚ï¼Œå› æ­¤ä¸ºæ”¯æŒå¯ç§»æ¤æ€§ï¼Œæ‚¨ä¸å¾—å°† SM æ•°é‡ç¡¬ç¼–ç åˆ°ä»£ç åº“ä¸­ã€‚ç›¸åï¼Œåº”è¯¥ä»¥ç¼–ç¨‹æ–¹å¼è·å–æ­¤ä¿¡æ¯ã€‚</p>
<p>ä»¥ä¸‹æ‰€ç¤ºä¸ºåœ¨ CUDA C/C++ ä¸­è·å– C ç»“æ„çš„æ–¹æ³•ï¼Œè¯¥ç»“æ„åŒ…å«å½“å‰å¤„äºæ´»åŠ¨çŠ¶æ€çš„ GPU è®¾å¤‡çš„å¤šä¸ªå±æ€§ï¼Œå…¶ä¸­åŒ…æ‹¬è®¾å¤‡çš„ SM æ•°é‡ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> deviceId;<br><span class="hljs-built_in">cudaGetDevice</span>(&amp;deviceId);                  <span class="hljs-comment">// `deviceId`ç°åœ¨æŒ‡å‘æ´»åŠ¨çš„GPU</span><br><br>cudaDeviceProp props;<br><span class="hljs-built_in">cudaGetDeviceProperties</span>(&amp;props, deviceId); <span class="hljs-comment">// `props` ç°åœ¨æœ‰å¾ˆå¤šæœ‰ç”¨çš„å…³äºä¸»ç”¨GPUè®¾å¤‡çš„å±æ€§</span><br><br></code></pre></td></tr></table></figure>
<h3 id="æŸ¥è¯¢è®¾å¤‡ä¿¡æ¯">æŸ¥è¯¢è®¾å¤‡ä¿¡æ¯</h3>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-type">int</span> deviceId;<br>  <span class="hljs-built_in">cudaGetDevice</span>(&amp;deviceId);<br><br>  cudaDeviceProp props;<br>  <span class="hljs-built_in">cudaGetDeviceProperties</span>(&amp;props, deviceId);<br><br>  <span class="hljs-type">int</span> computeCapabilityMajor = props.major;<br>  <span class="hljs-type">int</span> computeCapabilityMinor = props.minor;<br>  <span class="hljs-type">int</span> multiProcessorCount = props.multiProcessorCount;<br>  <span class="hljs-type">int</span> warpSize = props.warpSize;<br><br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Device ID: %d\nNumber of SMs: %d\nCompute Capability Major: %d\nCompute Capability Minor: %d\nWarp Size: %d\n&quot;</span>, deviceId, multiProcessorCount, computeCapabilityMajor, computeCapabilityMinor, warpSize);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœæ ·å¼ä¸‹å›¾</p>
<p><img src="https://cdn.jsdelivr.net/gh/forrest-wcb/markdown_img@main/img/202312292237862.png" alt="image-20231220165103264"></p>
<ul>
<li><strong>Compute Capability Majorï¼ˆè®¡ç®—èƒ½åŠ›ä¸»ç‰ˆæœ¬ï¼‰ï¼š</strong> è¿™æ˜¯ä¸»è¦ç‰ˆæœ¬å·ï¼Œè¡¨ç¤ºGPUæ¶æ„çš„ä¸»è¦ç‰¹æ€§ã€‚è¾ƒæ–°çš„ä¸»è¦ç‰ˆæœ¬é€šå¸¸æ”¯æŒæ›´å¤šçš„åŠŸèƒ½å’Œæ€§èƒ½æå‡ã€‚ä¾‹å¦‚ï¼ŒCompute Capability Major 7 è¡¨ç¤ºè¯¥GPUå±äºè¾ƒæ–°çš„æ¶æ„ã€‚</li>
<li><strong>Compute Capability Minorï¼ˆè®¡ç®—èƒ½åŠ›æ¬¡ç‰ˆæœ¬ï¼‰ï¼š</strong> è¿™æ˜¯æ¬¡è¦ç‰ˆæœ¬å·ï¼Œè¡¨ç¤ºGPUæ¶æ„çš„æ¬¡è¦ç‰¹æ€§ã€‚é€šå¸¸ï¼Œæ¬¡è¦ç‰ˆæœ¬çš„æå‡è¡¨ç¤ºä¸€äº›è¾ƒå°çš„æ”¹è¿›æˆ–ä¼˜åŒ–ã€‚Compute Capability Minor 5 è¡¨ç¤ºè¯¥GPUçš„æ¬¡è¦ç‰ˆæœ¬ã€‚</li>
</ul>
<h3 id="å°†ç½‘æ ¼æ•°è°ƒæ•´ä¸ºSMæ•°ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–çŸ¢é‡åŠ æ³•">å°†ç½‘æ ¼æ•°è°ƒæ•´ä¸ºSMæ•°ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–çŸ¢é‡åŠ æ³•</h3>
<p>å¾—çŸ¥è®¾å¤‡ä¿¡æ¯åï¼Œå¯¹æ‰§è¡Œé…ç½®è¿›è¡Œè°ƒæ•´ï¼Œå¯¹01-vector-add.cuè¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</p>
<p>çº¿ç¨‹å—è°ƒæ•´ä¸º80ï¼Œçº¿ç¨‹æ•°è°ƒæˆä¸º640ï¼Œé‡å¤å¤šæ¬¡è¿è¡Œåˆ†æï¼Œæ ¸å‡½æ•°è¿è¡Œæ—¶é—´çº¦åœ¨0.12så·¦å³ï¼Œç›¸æ¯”ä¼˜åŒ–å‰çš„2.35sï¼Œä»¥åŠä¸Šæ–‡çš„ä¼˜åŒ–ç»“æœ0.145sï¼Œæœ‰äº†ä¸å°çš„è¿›æ­¥ã€‚</p>
<h2 id="è·å¾—ç»Ÿä¸€å†…å­˜çš„ç»†èŠ‚">è·å¾—ç»Ÿä¸€å†…å­˜çš„ç»†èŠ‚</h2>
<h3 id="ç»Ÿä¸€å†…å­˜-UM-çš„è¿ç§»">ç»Ÿä¸€å†…å­˜(UM)çš„è¿ç§»</h3>
<p>åˆ†é… UM æ—¶ï¼Œå†…å­˜å°šæœªé©»ç•™åœ¨ä¸»æœºæˆ–è®¾å¤‡ä¸Šã€‚ä¸»æœºæˆ–è®¾å¤‡å°è¯•è®¿é—®å†…å­˜æ—¶ä¼šå‘ç”Ÿ <a href="https://en.wikipedia.org/wiki/Page_fault">é¡µé”™è¯¯</a>ï¼Œæ­¤æ—¶ä¸»æœºæˆ–è®¾å¤‡ä¼šæ‰¹é‡è¿ç§»æ‰€éœ€çš„æ•°æ®ã€‚åŒç†ï¼Œå½“ CPU æˆ–åŠ é€Ÿç³»ç»Ÿä¸­çš„ä»»ä½• GPU å°è¯•è®¿é—®å°šæœªé©»ç•™åœ¨å…¶ä¸Šçš„å†…å­˜æ—¶ï¼Œä¼šå‘ç”Ÿé¡µé”™è¯¯å¹¶è§¦å‘è¿ç§»ã€‚</p>
<p>èƒ½å¤Ÿæ‰§è¡Œé¡µé”™è¯¯å¹¶æŒ‰éœ€è¿ç§»å†…å­˜å¯¹äºåœ¨åŠ é€Ÿåº”ç”¨ç¨‹åºä¸­ç®€åŒ–å¼€å‘æµç¨‹å¤§æœ‰åŠ©ç›Šã€‚æ­¤å¤–ï¼Œåœ¨å¤„ç†å±•ç¤ºç¨€ç–è®¿é—®æ¨¡å¼çš„æ•°æ®æ—¶ï¼ˆä¾‹å¦‚ï¼Œåœ¨åº”ç”¨ç¨‹åºå®é™…è¿è¡Œä¹‹å‰æ— æ³•å¾—çŸ¥éœ€è¦å¤„ç†çš„æ•°æ®æ—¶ï¼‰ï¼Œä»¥åŠåœ¨å…·æœ‰å¤šä¸ª GPU çš„åŠ é€Ÿç³»ç»Ÿä¸­ï¼Œæ•°æ®å¯èƒ½ç”±å¤šä¸ª GPU è®¾å¤‡è®¿é—®æ—¶ï¼ŒæŒ‰éœ€è¿ç§»å†…å­˜å°†ä¼šå¸¦æ¥æ˜¾è‘—ä¼˜åŠ¿ã€‚</p>
<p>æœ‰äº›æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚ï¼Œåœ¨è¿è¡Œæ—¶ä¹‹å‰éœ€è¦å¾—çŸ¥æ•°æ®ï¼Œä»¥åŠéœ€è¦å¤§é‡è¿ç»­çš„å†…å­˜å—æ—¶ï¼‰ï¼Œæˆ‘ä»¬è¿˜èƒ½æœ‰æ•ˆè§„é¿é¡µé”™è¯¯å’ŒæŒ‰éœ€æ•°æ®è¿ç§»æ‰€äº§ç”Ÿçš„å¼€é”€ã€‚</p>
<p>æœ¬å®éªŒçš„åç»­å†…å®¹å°†ä¾§é‡äºå¯¹æŒ‰éœ€è¿ç§»çš„ç†è§£ï¼Œä»¥åŠå¦‚ä½•åœ¨åˆ†æå™¨è¾“å‡ºä¸­è¯†åˆ«æŒ‰éœ€è¿ç§»ã€‚è¿™äº›çŸ¥è¯†å¯è®©æ‚¨åœ¨äº«å—æŒ‰éœ€è¿ç§»ä¼˜åŠ¿çš„åŒæ—¶ï¼Œå‡å°‘å…¶äº§ç”Ÿçš„å¼€é”€ã€‚</p>
<h3 id="ç»ƒä¹ ï¼šæ¢ç´¢ç»Ÿä¸€å†…å­˜ï¼ˆUMï¼‰çš„é¡µé”™è¯¯">ç»ƒä¹ ï¼šæ¢ç´¢ç»Ÿä¸€å†…å­˜ï¼ˆUMï¼‰çš„é¡µé”™è¯¯</h3>
<p><code>nsys profile</code> ä¼šæä¾›æè¿°æ‰€åˆ†æåº”ç”¨ç¨‹åº UM è¡Œä¸ºçš„è¾“å‡ºã€‚åœ¨æœ¬ç»ƒä¹ ä¸­ï¼Œæ‚¨å°†å¯¹ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºåšå‡ºä¸€äº›ä¿®æ”¹ï¼Œå¹¶ä¼šåœ¨æ¯æ¬¡æ›´æ”¹ååˆ©ç”¨ <code>nsys profile</code> çš„ç»Ÿä¸€å†…å­˜è¾“å‡ºéƒ¨åˆ†ï¼Œæ¢è®¨ UM æ•°æ®è¿ç§»çš„è¡Œä¸ºæ–¹å¼ã€‚</p>
<p><a href="http://dli-604a4aa51b37-46802e.aws.labs.courses.nvidia.com/lab/edit/06-unified-memory-page-faults/01-page-faults.cu"><code>01-page-faults.cu</code></a> åŒ…å« <code>hostFunction</code> å’Œ <code>gpuKernel</code> å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªå‡½æ•°å¹¶ä½¿ç”¨æ•°å­— <code>1</code> åˆå§‹åŒ– <code>2&lt;&lt;24</code> ä¸ªå•å…ƒå‘é‡çš„å…ƒç´ ã€‚ä¸»æœºå‡½æ•°å’Œ GPU æ ¸å‡½æ•°ç›®å‰å‡æœªä½¿ç”¨ã€‚</p>
<p>å¯¹äºä»¥ä¸‹ 4 ä¸ªé—®é¢˜ä¸­çš„æ¯ä¸€é—®é¢˜ï¼Œè¯·æ ¹æ®æ‚¨å¯¹ UM è¡Œä¸ºçš„ç†è§£ï¼Œé¦–å…ˆå‡è®¾åº”ä¼šå‘ç”Ÿä½•ç§é¡µé”™è¯¯ï¼Œç„¶åä½¿ç”¨ä»£ç åº“ä¸­æ‰€æä¾› 2 ä¸ªå‡½æ•°ä¸­çš„å…¶ä¸­ä¸€ä¸ªæˆ–åŒæ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°ç¼–è¾‘ <a href="http://dli-604a4aa51b37-46802e.aws.labs.courses.nvidia.com/lab/edit/06-unified-memory-page-faults/01-page-faults.cu"><code>01-page-faults.cu</code></a>ä»¥åˆ›å»ºåœºæ™¯ï¼Œä»¥ä¾¿æ‚¨æµ‹è¯•å‡è®¾ã€‚</p>
<p>ä¸ºäº†æ£€éªŒæ‚¨çš„å‡è®¾ï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ‰§è¡Œå•å…ƒæ¥ç¼–è¯‘å’Œåˆ†æä»£ç ã€‚ ä¸€å®šè¦è®°å½•ä»<code>nsys profile --stats = true</code>è¾“å‡ºä¸­è·å¾—çš„å‡è®¾ä»¥åŠç»“æœã€‚ åœ¨<code>nsys profile --stats = true</code>çš„è¾“å‡ºä¸­ï¼Œæ‚¨åº”è¯¥æŸ¥æ‰¾ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>è¾“å‡ºä¸­æ˜¯å¦æœ‰ <em>CUDAå†…å­˜æ“ä½œç»Ÿè®¡ä¿¡æ¯</em> éƒ¨åˆ†ï¼Ÿ</li>
<li>å¦‚æœæ˜¯ï¼Œè¿™æ˜¯å¦è¡¨ç¤ºæ•°æ®ä»ä¸»æœºåˆ°è®¾å¤‡ï¼ˆHtoDï¼‰æˆ–ä»è®¾å¤‡åˆ°ä¸»æœºï¼ˆDtoHï¼‰çš„è¿ç§»ï¼Ÿ</li>
<li>è¿›è¡Œè¿ç§»æ—¶ï¼Œè¾“å‡ºå¦‚ä½•è¯´æ˜æœ‰å¤šå°‘ä¸ªâ€œæ“ä½œâ€ï¼Ÿ å¦‚æœçœ‹åˆ°è®¸å¤šå°çš„å†…å­˜è¿ç§»æ“ä½œï¼Œåˆ™è¡¨æ˜æŒ‰éœ€å‡ºç°é¡µé¢é”™è¯¯ï¼Œå¹¶ä¸”æ¯æ¬¡åœ¨è¯·æ±‚çš„ä½ç½®å‡ºç°é¡µé¢é”™è¯¯æ—¶éƒ½ä¼šå‘ç”Ÿå°å†…å­˜è¿ç§»ã€‚</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ä¾›æ‚¨æ¢ç´¢çš„æ–¹æ¡ˆï¼Œä»¥åŠé‡åˆ°å›°éš¾æ—¶çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>å½“ä»…é€šè¿‡CPUè®¿é—®ç»Ÿä¸€å†…å­˜æ—¶ï¼Œæ˜¯å¦å­˜åœ¨å†…å­˜è¿ç§»å’Œ/æˆ–é¡µé¢é”™è¯¯çš„è¯æ®ï¼Ÿ</li>
<li>å½“ä»…é€šè¿‡GPUè®¿é—®ç»Ÿä¸€å†…å­˜æ—¶ï¼Œæ˜¯å¦æœ‰è¯æ®è¡¨æ˜å†…å­˜è¿ç§»å’Œ/æˆ–é¡µé¢é”™è¯¯ï¼Ÿ</li>
<li>å½“å…ˆç”±CPUç„¶åç”±GPUè®¿é—®ç»Ÿä¸€å†…å­˜æ—¶ï¼Œæ˜¯å¦æœ‰è¯æ®è¡¨æ˜å­˜åœ¨å†…å­˜è¿ç§»å’Œ/æˆ–é¡µé¢é”™è¯¯ï¼Ÿ</li>
<li>å½“å…ˆç”±GPUç„¶åç”±CPUè®¿é—®ç»Ÿä¸€å†…å­˜æ—¶ï¼Œæ˜¯å¦å­˜åœ¨å†…å­˜è¿ç§»å’Œ/æˆ–é¡µé¢é”™è¯¯çš„è¯æ®ï¼Ÿ</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/forrest-wcb/markdown_img@main/img/202312292238197.png" alt="image-20231223181124188"></p>
<p>ä¸Šå›¾ä¸º<code>nsys profile --stats = true</code>è¾“å‡ºå†…å®¹ä¸­æ˜¾ç¤ºçš„æ•°æ®ä»è®¾å¤‡åˆ°ä¸»æœºçš„è¿ç§»DtoHï¼Œæ€»æ“ä½œæ•°ä¸º768ï¼Œå¯ä»¥çœ‹åˆ°æœ‰è®¸å¤šå°å†…å­˜çš„è¿ç§»æ“ä½œï¼ŒéªŒè¯äº†æŒ‰éœ€å‡ºç°é¡µé¢é”™è¯¯ï¼Œå¹¶ä¸”æ¯æ¬¡åœ¨è¯·æ±‚çš„ä½ç½®å‡ºç°é¡µé¢é”™è¯¯æ—¶éƒ½ä¼šå‘ç”Ÿå°å†…å­˜è¿ç§»ã€‚</p>
<p>å½“ <code>nsys profile</code> ç»™å‡ºæ ¸å‡½æ•°æ‰€éœ€çš„æ‰§è¡Œæ—¶é—´æ—¶ï¼Œåˆ™åœ¨æ­¤å‡½æ•°æ‰§è¡ŒæœŸé—´å‘ç”Ÿçš„ä¸»æœºåˆ°è®¾å¤‡é¡µé”™è¯¯å’Œæ•°æ®è¿ç§»éƒ½ä¼šåŒ…å«åœ¨æ‰€æ˜¾ç¤ºçš„æ‰§è¡Œæ—¶é—´ä¸­ã€‚æ•…å¯ä»¥é€šè¿‡å‡å°‘UMé¡µé”™è¯¯å’Œæ•°æ®è¿ç§»çš„å‘ç”Ÿç¼©çŸ­æ ¸å‡½æ•°è¿è¡Œæ—¶é—´ã€‚</p>
<h2 id="å¼‚æ­¥å†…å­˜é¢„å–">å¼‚æ­¥å†…å­˜é¢„å–</h2>
<p>åœ¨ä¸»æœºåˆ°è®¾å¤‡å’Œè®¾å¤‡åˆ°ä¸»æœºçš„å†…å­˜ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ç§æŠ€æœ¯æ¥å‡å°‘é¡µé”™è¯¯å’ŒæŒ‰éœ€å†…å­˜è¿ç§»æˆæœ¬ï¼Œæ­¤å¼ºå¤§æŠ€æœ¯ç§°ä¸º<strong>å¼‚æ­¥å†…å­˜é¢„å–</strong>ã€‚é€šè¿‡æ­¤æŠ€æœ¯ï¼Œç¨‹åºå‘˜å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä»£ç ä½¿ç”¨ç»Ÿä¸€å†…å­˜ (UM) ä¹‹å‰ï¼Œåœ¨åå°å°†å…¶å¼‚æ­¥è¿ç§»è‡³ç³»ç»Ÿä¸­çš„ä»»ä½• CPU æˆ– GPU è®¾å¤‡ã€‚æ­¤ä¸¾å¯ä»¥å‡å°‘é¡µé”™è¯¯å’ŒæŒ‰éœ€æ•°æ®è¿ç§»æ‰€å¸¦æ¥çš„æˆæœ¬ï¼Œå¹¶è¿›è€Œæé«˜ GPU æ ¸å‡½æ•°å’Œ CPU å‡½æ•°çš„æ€§èƒ½ã€‚</p>
<p>æ­¤å¤–ï¼Œé¢„å–å¾€å¾€ä¼šä»¥æ›´å¤§çš„æ•°æ®å—æ¥è¿ç§»æ•°æ®ï¼Œå› æ­¤å…¶è¿ç§»æ¬¡æ•°è¦ä½äºæŒ‰éœ€è¿ç§»ã€‚æ­¤æŠ€æœ¯éå¸¸é€‚ç”¨äºä»¥ä¸‹æƒ…å†µï¼šåœ¨è¿è¡Œæ—¶ä¹‹å‰å·²çŸ¥æ•°æ®è®¿é—®éœ€æ±‚ä¸”æ•°æ®è®¿é—®å¹¶æœªé‡‡ç”¨ç¨€ç–æ¨¡å¼ã€‚</p>
<p>CUDA å¯é€šè¿‡ <code>cudaMemPrefetchAsync</code> å‡½æ•°ï¼Œè½»æ¾å°†æ‰˜ç®¡å†…å­˜å¼‚æ­¥é¢„å–åˆ° GPU è®¾å¤‡æˆ– CPUã€‚ä»¥ä¸‹æ‰€ç¤ºä¸ºå¦‚ä½•ä½¿ç”¨è¯¥å‡½æ•°å°†æ•°æ®é¢„å–åˆ°å½“å‰å¤„äºæ´»åŠ¨çŠ¶æ€çš„ GPU è®¾å¤‡ï¼Œç„¶åå†é¢„å–åˆ° CPUï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> deviceId;<br><span class="hljs-built_in">cudaGetDevice</span>(&amp;deviceId);                                  <span class="hljs-comment">// The ID of the currently active GPU device.</span><br><br><span class="hljs-built_in">cudaMemPrefetchAsync</span>(pointerToSomeUMData, size, deviceId);<span class="hljs-comment">// é¢„å–pointerToSomeUMDataå¤„sizeå¤§å°çš„æ•°æ®è‡³æ´»åŠ¨çš„GPUè®¾å¤‡</span><br><span class="hljs-built_in">cudaMemPrefetchAsync</span>(pointerToSomeUMData, size, cudaCpuDeviceId); <span class="hljs-comment">// é¢„å–å›ä¸»æœº.`cudaCpuDeviceId`æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„å˜é‡</span><br></code></pre></td></tr></table></figure>
<h3 id="ç»ƒä¹ ï¼šå¼‚æ­¥å†…å­˜é¢„å–">ç»ƒä¹ ï¼šå¼‚æ­¥å†…å­˜é¢„å–</h3>
<p>åœ¨ 01-vector-add.cuåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ <code>cudaMemPrefetchAsync</code> å‡½æ•°å¼€å±• å®éªŒï¼Œä»¥æ¢ç©¶å…¶ä¼šå¯¹é¡µé”™è¯¯å’Œå†…å­˜è¿ç§»äº§ç”Ÿä½•ç§å½±å“ã€‚</p>
<p>ç»“æœï¼šå¯ä»¥çœ‹åˆ°å†…å­˜ä¼ è¾“æ¬¡æ•°å‡å°‘äº†ï¼Œä½†æ˜¯æ¯æ¬¡ä¼ è¾“çš„é‡å¢åŠ äº†ï¼Œå¹¶ä¸”å†…æ ¸æ‰§è¡Œæ—¶é—´å¤§å¤§å‡å°‘äº†ã€‚</p>
<h1><strong>å¼‚æ­¥æµåŠ CUDA C/C++ åº”ç”¨ç¨‹åºçš„å¯è§†åŒ–æ€§èƒ½åˆ†æ</strong></h1>
<p>CUDAå·¥å…·åŒ…é™„å¸¦äº† <strong>Nsight Systems</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„GUIåº”ç”¨ç¨‹åºï¼Œå¯æ”¯æŒCUDAåº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚ Nsight Systemsä¸ºè¢«åŠ é€Ÿçš„åº”ç”¨ç¨‹åºç”Ÿæˆå›¾å½¢åŒ–çš„æ´»åŠ¨æ—¶é—´è¡¨ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³CUDA APIè°ƒç”¨ã€å†…æ ¸æ‰§è¡Œã€å†…å­˜æ´»åŠ¨ä»¥åŠ<strong>CUDAæµ</strong>çš„ä½¿ç”¨çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<h2 id="å­¦ä¹ ç›®æ ‡-2">å­¦ä¹ ç›®æ ‡</h2>
<p>åœ¨å®Œæˆæœ¬ç»ƒä¹ åï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š</p>
<ul>
<li>ä½¿ç”¨<strong>Nsight Systems</strong>ç›´è§‚åœ°æè¿°ç”±GPUåŠ é€Ÿçš„CUDAåº”ç”¨ç¨‹åºçš„æ—¶é—´è¡¨ã€‚</li>
<li>ä½¿ç”¨<strong>Nsight Systems</strong>è¯†åˆ«å’Œåˆ©ç”¨CUDAåº”ç”¨ç¨‹åºä¸­çš„ä¼˜åŒ–æœºä¼šã€‚</li>
<li>åˆ©ç”¨CUDAæµåœ¨è¢«åŠ é€Ÿçš„åº”ç”¨ç¨‹åºä¸­å¹¶å‘æ‰§è¡Œæ ¸å‡½æ•°ã€‚</li>
<li>ï¼ˆ <strong>å¯é€‰çš„è¿›é˜¶å†…å®¹</strong> ï¼‰ä½¿ç”¨æ‰‹åŠ¨çš„è®¾å¤‡å†…å­˜åˆ†é…ï¼ŒåŒ…æ‹¬åˆ†é…å›ºå®šçš„å†…å­˜ï¼Œä»¥ä¾¿åœ¨å¹¶å‘CUDAæµä¹‹é—´å¼‚æ­¥ä¼ è¾“æ•°æ®ã€‚</li>
</ul>
<h2 id="è¿è¡ŒNsight-Systems">è¿è¡ŒNsight Systems</h2>
<p>æ­¤å¤„ä½¿ç”¨çš„æ˜¯è‹±ä¼Ÿè¾¾é…ç½®å¥½çš„è¿œç¨‹æ¡Œé¢ï¼Œå¯ä»¥ç›´æ¥å¯åŠ¨å’Œä½¿ç”¨Nsight Systemsï¼ˆä½†æ˜¯æ— æ¯”çš„å¡é¡¿ï¼‰ï¼Œå»ºè®®åœ¨æœ¬åœ°é…ç½®ï¼Œè¿›è¡Œå¯è§†åŒ–åˆ†æã€‚</p>
<p>ä¸»è¦å¯¹å‰é¢çš„å„ç§ä¼˜åŒ–è¿›è¡Œå¯è§†åŒ–åˆ†æï¼Œæ•…ä¸åšè®°å½•</p>
<h2 id="å¹¶å‘CUDAæµ">å¹¶å‘CUDAæµ</h2>
<p>åœ¨ CUDA ç¼–ç¨‹ä¸­ï¼Œ<strong>æµ</strong>æ˜¯ç”±æŒ‰é¡ºåºæ‰§è¡Œçš„ä¸€ç³»åˆ—å‘½ä»¤æ„æˆã€‚åœ¨ CUDA åº”ç”¨ç¨‹åºä¸­ï¼Œæ ¸å‡½æ•°çš„æ‰§è¡Œä»¥åŠä¸€äº›å†…å­˜ä¼ è¾“å‡åœ¨ CUDA æµä¸­è¿›è¡Œã€‚ä¸è¿‡ç›´è‡³æ­¤æ—¶ï¼Œæ‚¨ä»æœªç›´æ¥ä¸ CUDA æµæ‰“äº¤é“ï¼›ä½†å®é™…ä¸Šæ‚¨çš„ CUDA ä»£ç å·²åœ¨åä¸º<em>é»˜è®¤æµ</em>çš„æµä¸­æ‰§è¡Œäº†å…¶æ ¸å‡½æ•°ã€‚</p>
<p>é™¤é»˜è®¤æµä»¥å¤–ï¼ŒCUDA ç¨‹åºå‘˜è¿˜å¯åˆ›å»ºå¹¶ä½¿ç”¨éé»˜è®¤ CUDA æµï¼Œæ­¤ä¸¾å¯æ”¯æŒæ‰§è¡Œå¤šä¸ªæ“ä½œï¼Œä¾‹å¦‚åœ¨ä¸åŒçš„æµä¸­å¹¶å‘æ‰§è¡Œå¤šä¸ªæ ¸å‡½æ•°ã€‚å¤šæµçš„ä½¿ç”¨å¯ä»¥ä¸ºæ‚¨çš„åŠ é€Ÿåº”ç”¨ç¨‹åºå¸¦æ¥å¦å¤–ä¸€ä¸ªå±‚æ¬¡çš„å¹¶è¡Œï¼Œå¹¶èƒ½æä¾›æ›´å¤šåº”ç”¨ç¨‹åºçš„ä¼˜åŒ–æœºä¼šã€‚</p>
<p>ä»¥ä¸‹ä¸ºé»˜è®¤æµå’Œéé»˜è®¤æµçš„å…³ç³»</p>
<ul>
<li>ç»™å®šæµä¸­çš„æ‰€æœ‰æ“ä½œä¼šæŒ‰åºæ‰§è¡Œã€‚</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/forrest-wcb/markdown_img@main/img/202312291746109.png" alt="image-20231229174627015" style="zoom:50%;" />
<ul>
<li>å°±ä¸åŒéé»˜è®¤æµä¸­çš„æ“ä½œè€Œè¨€ï¼Œæ— æ³•ä¿è¯å…¶ä¼šæŒ‰å½¼æ­¤ä¹‹é—´çš„ä»»ä½•ç‰¹å®šé¡ºåºæ‰§è¡Œã€‚</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/forrest-wcb/markdown_img@main/img/202312291747578.png" alt="image-20231229174728331" style="zoom:50%;" />
<ul>
<li>é»˜è®¤æµå…·æœ‰é˜»æ–­èƒ½åŠ›ï¼Œå³ï¼Œå®ƒä¼šç­‰å¾…å…¶å®ƒå·²åœ¨è¿è¡Œçš„æ‰€æœ‰æµå®Œæˆå½“å‰æ“ä½œä¹‹åæ‰è¿è¡Œï¼Œä½†åœ¨å…¶è‡ªèº«è¿è¡Œå®Œæ¯•ä¹‹å‰äº¦ä¼šé˜»ç¢å…¶å®ƒæµçš„è¿è¡Œ</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/forrest-wcb/markdown_img@main/img/202312291748572.png" alt="image-20231229174809215" style="zoom:50%;" />
<h3 id="åˆ›å»ºï¼Œä½¿ç”¨å’Œé”€æ¯éé»˜è®¤CUDAæµ">åˆ›å»ºï¼Œä½¿ç”¨å’Œé”€æ¯éé»˜è®¤CUDAæµ</h3>
<p>ä»¥ä¸‹ä»£ç æ®µæ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºï¼Œåˆ©ç”¨å’Œé”€æ¯éé»˜è®¤CUDAæµã€‚æ‚¨ä¼šæ³¨æ„åˆ°ï¼Œè¦åœ¨éé»˜è®¤CUDAæµä¸­å¯åŠ¨CUDAæ ¸å‡½æ•°ï¼Œå¿…é¡»å°†æµä½œä¸ºæ‰§è¡Œé…ç½®çš„ç¬¬4ä¸ªå¯é€‰å‚æ•°ä¼ é€’ç»™è¯¥æ ¸å‡½æ•°ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨ä»…åˆ©ç”¨äº†æ‰§è¡Œé…ç½®çš„å‰ä¸¤ä¸ªå‚æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs C++">cudaStream_t stream;   <span class="hljs-comment">// CUDAæµçš„ç±»å‹ä¸º `cudaStream_t`</span><br><span class="hljs-built_in">cudaStreamCreate</span>(&amp;stream); <span class="hljs-comment">// æ³¨æ„ï¼Œå¿…é¡»å°†ä¸€ä¸ªæŒ‡é’ˆä¼ é€’ç»™ `cudaCreateStream`</span><br><br>someKernel&lt;&lt;&lt;number_of_blocks, threads_per_block, <span class="hljs-number">0</span>, stream&gt;&gt;&gt;();   <span class="hljs-comment">// `stream` ä½œä¸ºç¬¬4ä¸ªECå‚æ•°ä¼ é€’</span><br><br><span class="hljs-built_in">cudaStreamDestroy</span>(stream); <span class="hljs-comment">// æ³¨æ„ï¼Œå°†å€¼ï¼ˆè€Œä¸æ˜¯æŒ‡é’ˆï¼‰ä¼ é€’ç»™ `cudaDestroyStream`</span><br></code></pre></td></tr></table></figure>
<p>ä½†å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ‰§è¡Œé…ç½®çš„ç¬¬3ä¸ªå¯é€‰å‚æ•°è¶…å‡ºäº†æœ¬å®éªŒçš„èŒƒå›´ã€‚æ­¤å‚æ•°å…è®¸ç¨‹åºå‘˜æä¾›<strong>å…±äº«å†…å­˜</strong>ä¸­ä¸ºæ¯ä¸ªå†…æ ¸å¯åŠ¨åŠ¨æ€åˆ†é…çš„å­—èŠ‚æ•°ã€‚æ¯ä¸ªå—åˆ†é…ç»™å…±äº«å†…å­˜çš„é»˜è®¤å­—èŠ‚æ•°ä¸ºâ€œ0â€ï¼Œåœ¨æœ¬ç»ƒä¹ çš„å…¶ä½™éƒ¨åˆ†ä¸­ï¼Œæ‚¨å°†ä¼ é€’â€œ 0â€ä½œä¸ºè¯¥å€¼ï¼Œä»¥ä¾¿å±•ç¤ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„ç¬¬4ä¸ªå‚æ•°ã€‚</p>
<h3 id="ç»ƒä¹ -2">ç»ƒä¹ </h3>
<p>æºç¨‹åº</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function">__global__ <span class="hljs-type">void</span> <span class="hljs-title">printNumber</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, number);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; ++i)<br>  &#123;<br>    printNumber&lt;&lt;&lt;<span class="hljs-number">1</span>, <span class="hljs-number">1</span>&gt;&gt;&gt;(i);<br>  &#125;<br>  <span class="hljs-built_in">cudaDeviceSynchronize</span>();<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>å¯ä»¥é¢„è§æ ¸å‡½æ•°çš„5æ¬¡å¯åŠ¨éƒ½åœ¨é»˜è®¤æµé¡ºæ¬¡æ‰§è¡Œï¼Œå¯ä»¥ç”¨Nsight Systemsè¿›è¡Œå¯è§†åŒ–åˆ†æã€‚ç”±äºæ ¸å‡½æ•°çš„æ‰€æœ‰ 5 æ¬¡å¯åŠ¨å‡åœ¨åŒä¸€ä¸ªæµä¸­å‘ç”Ÿï¼Œå› æ­¤çœ‹åˆ° 5 ä¸ªæ ¸å‡½æ•°é¡ºæ¬¡æ‰§è¡Œä¹Ÿå°±ä¸è¶³ä¸ºå¥‡ã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥è¿™ä¹ˆè¯´ï¼Œç”±äºé»˜è®¤æµå…·æœ‰é˜»æ–­ä½œç”¨ï¼Œæ‰€ä»¥æ ¸å‡½æ•°éƒ½ä¼šåœ¨å®Œæˆæœ¬æ¬¡å¯åŠ¨ä¹‹åæ‰å¯åŠ¨ä¸‹ä¸€æ¬¡ï¼Œè€Œäº‹å®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
<p>é‡æ„</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-function">__global__ <span class="hljs-type">void</span> <span class="hljs-title">printNumber</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, number);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; ++i)<br>  &#123;<br>    cudaStream_t stream;<br>    <span class="hljs-built_in">cudaStreamCreate</span>(&amp;stream);<br>    printNumber&lt;&lt;&lt;<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, stream&gt;&gt;&gt;(i);<br>    <span class="hljs-built_in">cudaStreamDestroy</span>(stream);<br>  &#125;<br>  <span class="hljs-built_in">cudaDeviceSynchronize</span>();<br>&#125;<br><br><br></code></pre></td></tr></table></figure>
<p>åŸç¨‹åº</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function">__global__</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">initWith</span><span class="hljs-params">(<span class="hljs-type">float</span> num, <span class="hljs-type">float</span> *a, <span class="hljs-type">int</span> N)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-type">int</span> index = threadIdx.x + blockIdx.x * blockDim.x;<br>  <span class="hljs-type">int</span> stride = blockDim.x * gridDim.x;<br><br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = index; i &lt; N; i += stride)<br>  &#123;<br>    a[i] = num;<br>  &#125;<br>&#125;<br><br><span class="hljs-function">__global__</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addVectorsInto</span><span class="hljs-params">(<span class="hljs-type">float</span> *result, <span class="hljs-type">float</span> *a, <span class="hljs-type">float</span> *b, <span class="hljs-type">int</span> N)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> index = threadIdx.x + blockIdx.x * blockDim.x;<br>  <span class="hljs-type">int</span> stride = blockDim.x * gridDim.x;<br><br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = index; i &lt; N; i += stride)<br>  &#123;<br>    result[i] = a[i] + b[i];<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">checkElementsAre</span><span class="hljs-params">(<span class="hljs-type">float</span> target, <span class="hljs-type">float</span> *vector, <span class="hljs-type">int</span> N)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; N; i++)<br>  &#123;<br>    <span class="hljs-keyword">if</span>(vector[i] != target)<br>    &#123;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;FAIL: vector[%d] - %0.0f does not equal %0.0f\n&quot;</span>, i, vector[i], target);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Success! All values calculated correctly.\n&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> deviceId;<br>  <span class="hljs-type">int</span> numberOfSMs;<br><br>  <span class="hljs-built_in">cudaGetDevice</span>(&amp;deviceId);<br>  <span class="hljs-built_in">cudaDeviceGetAttribute</span>(&amp;numberOfSMs, cudaDevAttrMultiProcessorCount, deviceId);<br><br>  <span class="hljs-type">const</span> <span class="hljs-type">int</span> N = <span class="hljs-number">2</span>&lt;&lt;<span class="hljs-number">24</span>;<br>  <span class="hljs-type">size_t</span> size = N * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>);<br><br>  <span class="hljs-type">float</span> *a;<br>  <span class="hljs-type">float</span> *b;<br>  <span class="hljs-type">float</span> *c;<br><br>  <span class="hljs-built_in">cudaMallocManaged</span>(&amp;a, size);<br>  <span class="hljs-built_in">cudaMallocManaged</span>(&amp;b, size);<br>  <span class="hljs-built_in">cudaMallocManaged</span>(&amp;c, size);<br><br>  <span class="hljs-built_in">cudaMemPrefetchAsync</span>(a, size, deviceId);<br>  <span class="hljs-built_in">cudaMemPrefetchAsync</span>(b, size, deviceId);<br>  <span class="hljs-built_in">cudaMemPrefetchAsync</span>(c, size, deviceId);<br><br>  <span class="hljs-type">size_t</span> threadsPerBlock;<br>  <span class="hljs-type">size_t</span> numberOfBlocks;<br><br>  threadsPerBlock = <span class="hljs-number">256</span>;<br>  numberOfBlocks = <span class="hljs-number">32</span> * numberOfSMs;<br><br>  cudaError_t addVectorsErr;<br>  cudaError_t asyncErr;<br><br>  initWith&lt;&lt;&lt;numberOfBlocks, threadsPerBlock&gt;&gt;&gt;(<span class="hljs-number">3</span>, a, N);<br>  initWith&lt;&lt;&lt;numberOfBlocks, threadsPerBlock&gt;&gt;&gt;(<span class="hljs-number">4</span>, b, N);<br>  initWith&lt;&lt;&lt;numberOfBlocks, threadsPerBlock&gt;&gt;&gt;(<span class="hljs-number">0</span>, c, N);<br><br>  addVectorsInto&lt;&lt;&lt;numberOfBlocks, threadsPerBlock&gt;&gt;&gt;(c, a, b, N);<br><br>  addVectorsErr = <span class="hljs-built_in">cudaGetLastError</span>();<br>  <span class="hljs-keyword">if</span>(addVectorsErr != cudaSuccess) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error: %s\n&quot;</span>, <span class="hljs-built_in">cudaGetErrorString</span>(addVectorsErr));<br><br>  asyncErr = <span class="hljs-built_in">cudaDeviceSynchronize</span>();<br>  <span class="hljs-keyword">if</span>(asyncErr != cudaSuccess) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error: %s\n&quot;</span>, <span class="hljs-built_in">cudaGetErrorString</span>(asyncErr));<br><br>  <span class="hljs-built_in">cudaMemPrefetchAsync</span>(c, size, cudaCpuDeviceId);<br><br>  <span class="hljs-built_in">checkElementsAre</span>(<span class="hljs-number">7</span>, c, N);<br><br>  <span class="hljs-built_in">cudaFree</span>(a);<br>  <span class="hljs-built_in">cudaFree</span>(b);<br>  <span class="hljs-built_in">cudaFree</span>(c);<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>é‡æ„</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function">__global__</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">initWith</span><span class="hljs-params">(<span class="hljs-type">float</span> num, <span class="hljs-type">float</span> *a, <span class="hljs-type">int</span> N)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-type">int</span> index = threadIdx.x + blockIdx.x * blockDim.x;<br>  <span class="hljs-type">int</span> stride = blockDim.x * gridDim.x;<br><br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = index; i &lt; N; i += stride)<br>  &#123;<br>    a[i] = num;<br>  &#125;<br>&#125;<br><br><span class="hljs-function">__global__</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addVectorsInto</span><span class="hljs-params">(<span class="hljs-type">float</span> *result, <span class="hljs-type">float</span> *a, <span class="hljs-type">float</span> *b, <span class="hljs-type">int</span> N)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> index = threadIdx.x + blockIdx.x * blockDim.x;<br>  <span class="hljs-type">int</span> stride = blockDim.x * gridDim.x;<br><br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = index; i &lt; N; i += stride)<br>  &#123;<br>    result[i] = a[i] + b[i];<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">checkElementsAre</span><span class="hljs-params">(<span class="hljs-type">float</span> target, <span class="hljs-type">float</span> *vector, <span class="hljs-type">int</span> N)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; N; i++)<br>  &#123;<br>    <span class="hljs-keyword">if</span>(vector[i] != target)<br>    &#123;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;FAIL: vector[%d] - %0.0f does not equal %0.0f\n&quot;</span>, i, vector[i], target);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Success! All values calculated correctly.\n&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> deviceId;<br>  <span class="hljs-type">int</span> numberOfSMs;<br><br>  <span class="hljs-built_in">cudaGetDevice</span>(&amp;deviceId);<br>  <span class="hljs-built_in">cudaDeviceGetAttribute</span>(&amp;numberOfSMs, cudaDevAttrMultiProcessorCount, deviceId);<br><br>  <span class="hljs-type">const</span> <span class="hljs-type">int</span> N = <span class="hljs-number">2</span>&lt;&lt;<span class="hljs-number">24</span>;<br>  <span class="hljs-type">size_t</span> size = N * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>);<br><br>  <span class="hljs-type">float</span> *a;<br>  <span class="hljs-type">float</span> *b;<br>  <span class="hljs-type">float</span> *c;<br><br>  <span class="hljs-built_in">cudaMallocManaged</span>(&amp;a, size);<br>  <span class="hljs-built_in">cudaMallocManaged</span>(&amp;b, size);<br>  <span class="hljs-built_in">cudaMallocManaged</span>(&amp;c, size);<br><br>  <span class="hljs-built_in">cudaMemPrefetchAsync</span>(a, size, deviceId);<br>  <span class="hljs-built_in">cudaMemPrefetchAsync</span>(b, size, deviceId);<br>  <span class="hljs-built_in">cudaMemPrefetchAsync</span>(c, size, deviceId);<br><br>  <span class="hljs-type">size_t</span> threadsPerBlock;<br>  <span class="hljs-type">size_t</span> numberOfBlocks;<br><br>  threadsPerBlock = <span class="hljs-number">256</span>;<br>  numberOfBlocks = <span class="hljs-number">32</span> * numberOfSMs;<br><br>  cudaError_t addVectorsErr;<br>  cudaError_t asyncErr;<br><br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">   * Create 3 streams to run initialize the 3 data vectors in parallel.</span><br><span class="hljs-comment">   */</span><br><br>  cudaStream_t stream1, stream2, stream3;<br>  <span class="hljs-built_in">cudaStreamCreate</span>(&amp;stream1);<br>  <span class="hljs-built_in">cudaStreamCreate</span>(&amp;stream2);<br>  <span class="hljs-built_in">cudaStreamCreate</span>(&amp;stream3);<br><br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">   * Give each `initWith` launch its own non-standard stream.</span><br><span class="hljs-comment">   */</span><br><br>  initWith&lt;&lt;&lt;numberOfBlocks, threadsPerBlock, <span class="hljs-number">0</span>, stream1&gt;&gt;&gt;(<span class="hljs-number">3</span>, a, N);<br>  initWith&lt;&lt;&lt;numberOfBlocks, threadsPerBlock, <span class="hljs-number">0</span>, stream2&gt;&gt;&gt;(<span class="hljs-number">4</span>, b, N);<br>  initWith&lt;&lt;&lt;numberOfBlocks, threadsPerBlock, <span class="hljs-number">0</span>, stream3&gt;&gt;&gt;(<span class="hljs-number">0</span>, c, N);<br><br>  addVectorsInto&lt;&lt;&lt;numberOfBlocks, threadsPerBlock&gt;&gt;&gt;(c, a, b, N);<br><br>  addVectorsErr = <span class="hljs-built_in">cudaGetLastError</span>();<br>  <span class="hljs-keyword">if</span>(addVectorsErr != cudaSuccess) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error: %s\n&quot;</span>, <span class="hljs-built_in">cudaGetErrorString</span>(addVectorsErr));<br><br>  asyncErr = <span class="hljs-built_in">cudaDeviceSynchronize</span>();<br>  <span class="hljs-keyword">if</span>(asyncErr != cudaSuccess) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error: %s\n&quot;</span>, <span class="hljs-built_in">cudaGetErrorString</span>(asyncErr));<br><br>  <span class="hljs-built_in">cudaMemPrefetchAsync</span>(c, size, cudaCpuDeviceId);<br><br>  <span class="hljs-built_in">checkElementsAre</span>(<span class="hljs-number">7</span>, c, N);<br><br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">   * Destroy streams when they are no longer needed.</span><br><span class="hljs-comment">   */</span><br><br>  <span class="hljs-built_in">cudaStreamDestroy</span>(stream1);<br>  <span class="hljs-built_in">cudaStreamDestroy</span>(stream2);<br>  <span class="hljs-built_in">cudaStreamDestroy</span>(stream3);<br><br>  <span class="hljs-built_in">cudaFree</span>(a);<br>  <span class="hljs-built_in">cudaFree</span>(b);<br>  <span class="hljs-built_in">cudaFree</span>(c);<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h2 id="æœ€ç»ˆä»»åŠ¡ï¼šåŠ é€Ÿå’Œä¼˜åŒ–Nä½“æ¨¡æ‹Ÿå™¨">æœ€ç»ˆä»»åŠ¡ï¼šåŠ é€Ÿå’Œä¼˜åŒ–Nä½“æ¨¡æ‹Ÿå™¨</h2>
<p><a href="https://en.wikipedia.org/wiki/N-body_problem">n-body</a> æ¨¡æ‹Ÿå™¨å¯ä»¥é¢„æµ‹é€šè¿‡å¼•åŠ›ç›¸äº’ä½œç”¨çš„ä¸€ç»„ç‰©ä½“çš„ä¸ªä½“è¿åŠ¨ã€‚<a href="http://dli-604a4aa51b37-c4c714.aws.labs.courses.nvidia.com/lab/edit/09-nbody/01-nbody.cu">01-nbody.cu</a> åŒ…å«ä¸€ä¸ªç®€å•è€Œæœ‰æ•ˆçš„ n-body æ¨¡æ‹Ÿå™¨ï¼Œé€‚åˆç”¨äºåœ¨ä¸‰ç»´ç©ºé—´ç§»åŠ¨çš„ç‰©ä½“ã€‚æˆ‘ä»¬å¯é€šè¿‡å‘è¯¥åº”ç”¨ç¨‹åºä¼ é€’ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ä»¥å½±å“ç³»ç»Ÿä¸­çš„ç‰©ä½“æ•°é‡ã€‚</p>
<p>ä»¥ç›®å‰çš„ä»…ç”¨CPUçš„æƒ…å†µä¸‹ï¼Œæ­¤åº”ç”¨ç¨‹åºå¤§çº¦éœ€è¦5ç§’é’Ÿæ‰èƒ½è¿è¡Œ4096ä¸ªç‰©ä½“ï¼Œéœ€è¦<strong>20åˆ†é’Ÿ</strong>æ‰èƒ½è¿è¡Œ65536ä¸ªç‰©ä½“ã€‚æ‚¨çš„ä»»åŠ¡æ˜¯ç”¨GPUåŠ é€Ÿç¨‹åºï¼ŒåŒæ—¶ä¿æŒä»¿çœŸçš„æ­£ç¡®æ€§ã€‚</p>
<p>æºç¨‹åºå¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;timer.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;files.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SOFTENING 1e-9f</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Each body contains x, y, and z coordinate positions,</span><br><span class="hljs-comment"> * as well as velocities in the x, y, and z directions.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> &#123; <span class="hljs-type">float</span> x, y, z, vx, vy, vz; &#125; Body;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Calculate the gravitational impact of all bodies in the system</span><br><span class="hljs-comment"> * on all others.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">bodyForce</span><span class="hljs-params">(Body *p, <span class="hljs-type">float</span> dt, <span class="hljs-type">int</span> n)</span> </span>&#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) &#123;<br>    <span class="hljs-type">float</span> Fx = <span class="hljs-number">0.0f</span>; <span class="hljs-type">float</span> Fy = <span class="hljs-number">0.0f</span>; <span class="hljs-type">float</span> Fz = <span class="hljs-number">0.0f</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; n; j++) &#123;<br>      <span class="hljs-type">float</span> dx = p[j].x - p[i].x;<br>      <span class="hljs-type">float</span> dy = p[j].y - p[i].y;<br>      <span class="hljs-type">float</span> dz = p[j].z - p[i].z;<br>      <span class="hljs-type">float</span> distSqr = dx*dx + dy*dy + dz*dz + SOFTENING;<br>      <span class="hljs-type">float</span> invDist = <span class="hljs-built_in">rsqrtf</span>(distSqr);<br>      <span class="hljs-type">float</span> invDist3 = invDist * invDist * invDist;<br><br>      Fx += dx * invDist3; Fy += dy * invDist3; Fz += dz * invDist3;<br>    &#125;<br><br>    p[i].vx += dt*Fx; p[i].vy += dt*Fy; p[i].vz += dt*Fz;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span>** argv)</span> </span>&#123;<br><br>  <span class="hljs-comment">// The assessment will test against both 2&lt;11 and 2&lt;15.</span><br>  <span class="hljs-comment">// Feel free to pass the command line argument 15 when you gernate ./nbody report files</span><br>  <span class="hljs-type">int</span> nBodies = <span class="hljs-number">2</span>&lt;&lt;<span class="hljs-number">11</span>;<br>  <span class="hljs-keyword">if</span> (argc &gt; <span class="hljs-number">1</span>) nBodies = <span class="hljs-number">2</span>&lt;&lt;<span class="hljs-built_in">atoi</span>(argv[<span class="hljs-number">1</span>]);<br><br>  <span class="hljs-comment">// The assessment will pass hidden initialized values to check for correctness.</span><br>  <span class="hljs-comment">// You should not make changes to these files, or else the assessment will not work.</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> * initialized_values;<br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> * solution_values;<br><br>  <span class="hljs-keyword">if</span> (nBodies == <span class="hljs-number">2</span>&lt;&lt;<span class="hljs-number">11</span>) &#123;<br>    initialized_values = <span class="hljs-string">&quot;files/initialized_4096&quot;</span>;<br>    solution_values = <span class="hljs-string">&quot;files/solution_4096&quot;</span>;<br>  &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// nBodies == 2&lt;&lt;15</span><br>    initialized_values = <span class="hljs-string">&quot;files/initialized_65536&quot;</span>;<br>    solution_values = <span class="hljs-string">&quot;files/solution_65536&quot;</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (argc &gt; <span class="hljs-number">2</span>) initialized_values = argv[<span class="hljs-number">2</span>];<br>  <span class="hljs-keyword">if</span> (argc &gt; <span class="hljs-number">3</span>) solution_values = argv[<span class="hljs-number">3</span>];<br><br>  <span class="hljs-type">const</span> <span class="hljs-type">float</span> dt = <span class="hljs-number">0.01f</span>; <span class="hljs-comment">// Time step</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">int</span> nIters = <span class="hljs-number">10</span>;  <span class="hljs-comment">// Simulation iterations</span><br><br>  <span class="hljs-type">int</span> bytes = nBodies * <span class="hljs-built_in">sizeof</span>(Body);<br>  <span class="hljs-type">float</span> *buf;<br><br>  buf = (<span class="hljs-type">float</span> *)<span class="hljs-built_in">malloc</span>(bytes);<br><br>  Body *p = (Body*)buf;<br><br>  <span class="hljs-built_in">read_values_from_file</span>(initialized_values, buf, bytes);<br><br>  <span class="hljs-type">double</span> totalTime = <span class="hljs-number">0.0</span>;<br><br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">   * This simulation will run for 10 cycles of time, calculating gravitational</span><br><span class="hljs-comment">   * interaction amongst bodies, and adjusting their positions to reflect.</span><br><span class="hljs-comment">   */</span><br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> iter = <span class="hljs-number">0</span>; iter &lt; nIters; iter++) &#123;<br>    <span class="hljs-built_in">StartTimer</span>();<br><br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">   * You will likely wish to refactor the work being done in `bodyForce`,</span><br><span class="hljs-comment">   * and potentially the work to integrate the positions.</span><br><span class="hljs-comment">   */</span><br><br>    <span class="hljs-built_in">bodyForce</span>(p, dt, nBodies); <span class="hljs-comment">// compute interbody forces</span><br><br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">   * This position integration cannot occur until this round of `bodyForce` has completed.</span><br><span class="hljs-comment">   * Also, the next round of `bodyForce` cannot begin until the integration is complete.</span><br><span class="hljs-comment">   */</span><br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span> ; i &lt; nBodies; i++) &#123; <span class="hljs-comment">// integrate position</span><br>      p[i].x += p[i].vx*dt;<br>      p[i].y += p[i].vy*dt;<br>      p[i].z += p[i].vz*dt;<br>    &#125;<br><br>    <span class="hljs-type">const</span> <span class="hljs-type">double</span> tElapsed = <span class="hljs-built_in">GetTimer</span>() / <span class="hljs-number">1000.0</span>;<br>    totalTime += tElapsed;<br>  &#125;<br><br>  <span class="hljs-type">double</span> avgTime = totalTime / (<span class="hljs-type">double</span>)(nIters);<br>  <span class="hljs-type">float</span> billionsOfOpsPerSecond = <span class="hljs-number">1e-9</span> * nBodies * nBodies / avgTime;<br>  <span class="hljs-built_in">write_values_to_file</span>(solution_values, buf, bytes);<br><br>  <span class="hljs-comment">// You will likely enjoy watching this value grow as you accelerate the application,</span><br>  <span class="hljs-comment">// but beware that a failure to correctly synchronize the device might result in</span><br>  <span class="hljs-comment">// unrealistically high values.</span><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%0.3f Billion Interactions / second&quot;</span>, billionsOfOpsPerSecond);<br><br>  <span class="hljs-built_in">free</span>(buf);<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>ä¼˜åŒ–çƒ­ç‚¹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å°†bodyforceå‡½æ•°æ”¹ä¸ºæ ¸å‡½æ•°ï¼Œå¤–å±‚å¾ªç¯å¯ä»¥ä¼˜åŒ–ï¼Œå†…å±‚å¾ªç¯å…·æœ‰é¡ºåºä¾èµ–æ•…ä¸åšæ”¹åŠ¨</li>
<li>å°†bodyforceå‡½æ•°æ‰§è¡Œåçš„å°†å¼•åŠ›é›†æˆåˆ°å„ç‰©ä½“ä½ç½®çš„forå¾ªç¯æ”¹ä¸ºæ ¸å‡½æ•°ã€‚â€œè¯¥é›†æˆä¸ä»…éœ€åœ¨ <code>bodyForce</code> å‡½æ•°è¿è¡Œåè¿›è¡Œï¼Œå¹¶ä¸”éœ€åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨ <code>bodyForce</code> å‡½æ•°ä¹‹å‰å®Œæˆã€‚â€æ‰€ä»¥ï¼Œåœ¨æ‰§è¡Œå‰æ·»åŠ cudaDeviceSynchronize()è¯­å¥</li>
<li>æ‰§è¡Œé…ç½®æ ¹æ®SMså’Œwrapsæ•°é‡è¿›è¡Œé…ç½®ï¼ˆæ­¤å¤„çº¿ç¨‹æ•°è¶Šå¤§ï¼Œæ ¸å‡½æ•°è¿è¡Œæ—¶é—´åè€Œå˜é•¿ï¼Œå–32å’Œ64çš„è¿è¡Œæ—¶é—´ç›¸å¯¹è¾ƒä¼˜ï¼‰</li>
</ol>
<p>é‡æ„ç»“æœ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;timer.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;files.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SOFTENING 1e-9f</span><br><br><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> &#123; <span class="hljs-type">float</span> x, y, z, vx, vy, vz; &#125; Body;<br><br><br><br><span class="hljs-function">__global__ <span class="hljs-type">void</span> <span class="hljs-title">bodyForce</span><span class="hljs-params">(Body *p, <span class="hljs-type">float</span> dt, <span class="hljs-type">int</span> n)</span> </span>&#123;<br>  <span class="hljs-type">int</span> index = threadIdx.x + blockIdx.x * blockDim.x;<br>  <span class="hljs-type">int</span> stride = blockDim.x * gridDim.x;<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = index; i &lt; n; i += stride)&#123;<br>    <span class="hljs-type">float</span> Fx = <span class="hljs-number">0.0f</span>; <span class="hljs-type">float</span> Fy = <span class="hljs-number">0.0f</span>; <span class="hljs-type">float</span> Fz = <span class="hljs-number">0.0f</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; n; j++) &#123;<br>      <span class="hljs-type">float</span> dx = p[j].x - p[i].x;<br>      <span class="hljs-type">float</span> dy = p[j].y - p[i].y;<br>      <span class="hljs-type">float</span> dz = p[j].z - p[i].z;<br>      <span class="hljs-type">float</span> distSqr = dx*dx + dy*dy + dz*dz + SOFTENING;<br>      <span class="hljs-type">float</span> invDist = <span class="hljs-built_in">rsqrtf</span>(distSqr);<br>      <span class="hljs-type">float</span> invDist3 = invDist * invDist * invDist;<br><br>      Fx += dx * invDist3; Fy += dy * invDist3; Fz += dz * invDist3;<br>    &#125;<br><br>    p[i].vx += dt*Fx; p[i].vy += dt*Fy; p[i].vz += dt*Fz;<br>  &#125;<br>&#125;<br><br><span class="hljs-function">__global__ <span class="hljs-type">void</span> <span class="hljs-title">integrate_position</span><span class="hljs-params">(Body *p,<span class="hljs-type">float</span> dt,<span class="hljs-type">int</span> n)</span></span>&#123;<br>        <span class="hljs-type">int</span> index = threadIdx.x + blockIdx.x * blockDim.x;<br>       <span class="hljs-type">int</span> stride = blockDim.x * gridDim.x;<br><br>       <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = index; i &lt; n; i += stride) &#123;<br>                <span class="hljs-comment">// integrate position</span><br>                p[i].x += p[i].vx*dt;<br>                p[i].y += p[i].vy*dt;<br>                p[i].z += p[i].vz*dt;<br>        &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span>** argv)</span> </span>&#123;<br>  <span class="hljs-type">int</span> deviceId;<br>  <span class="hljs-type">int</span> numberOfSMs;<br><br>  <span class="hljs-built_in">cudaGetDevice</span>(&amp;deviceId);<br>  <span class="hljs-built_in">cudaDeviceGetAttribute</span>(&amp;numberOfSMs, cudaDevAttrMultiProcessorCount, deviceId);<br><br><br>  <span class="hljs-type">int</span> nBodies = <span class="hljs-number">2</span>&lt;&lt;<span class="hljs-number">11</span>;<br>  <span class="hljs-keyword">if</span> (argc &gt; <span class="hljs-number">1</span>) nBodies = <span class="hljs-number">2</span>&lt;&lt;<span class="hljs-built_in">atoi</span>(argv[<span class="hljs-number">1</span>]);<br><br><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> * initialized_values;<br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> * solution_values;<br><br>  <span class="hljs-keyword">if</span> (nBodies == <span class="hljs-number">2</span>&lt;&lt;<span class="hljs-number">11</span>) &#123;<br>    initialized_values = <span class="hljs-string">&quot;files/initialized_4096&quot;</span>;<br>    solution_values = <span class="hljs-string">&quot;files/solution_4096&quot;</span>;<br>  &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// nBodies == 2&lt;&lt;15</span><br>    initialized_values = <span class="hljs-string">&quot;files/initialized_65536&quot;</span>;<br>    solution_values = <span class="hljs-string">&quot;files/solution_65536&quot;</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (argc &gt; <span class="hljs-number">2</span>) initialized_values = argv[<span class="hljs-number">2</span>];<br>  <span class="hljs-keyword">if</span> (argc &gt; <span class="hljs-number">3</span>) solution_values = argv[<span class="hljs-number">3</span>];<br><br>  <span class="hljs-type">const</span> <span class="hljs-type">float</span> dt = <span class="hljs-number">0.01f</span>; <span class="hljs-comment">// Time step</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">int</span> nIters = <span class="hljs-number">10</span>;  <span class="hljs-comment">// Simulation iterations</span><br><br>  <span class="hljs-type">int</span> bytes = nBodies * <span class="hljs-built_in">sizeof</span>(Body);<br>  <span class="hljs-type">float</span> *buf;<br><br>  <span class="hljs-comment">//buf = (float *)malloc(bytes);</span><br>  <span class="hljs-built_in">cudaMallocManaged</span>(&amp;buf, bytes);<br>  <br>  Body *p = (Body*)buf;<br>  <span class="hljs-comment">//cudaMemPrefetchAsync(p, bytes, deviceId);</span><br>  <span class="hljs-type">size_t</span> threadsPerBlock = <span class="hljs-number">64</span>;<br>  <span class="hljs-type">size_t</span> numberOfBlocks = <span class="hljs-number">32</span> * numberOfSMs;<br>  <br>  <span class="hljs-built_in">read_values_from_file</span>(initialized_values, buf, bytes);<br><br>  <span class="hljs-type">double</span> totalTime = <span class="hljs-number">0.0</span>;<br><br> <br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> iter = <span class="hljs-number">0</span>; iter &lt; nIters; iter++) &#123;<br>    <span class="hljs-built_in">StartTimer</span>();<br>    <span class="hljs-comment">//cudaStream_t stream;   // CUDAæµçš„ç±»å‹ä¸º `cudaStream_t`</span><br>    <span class="hljs-comment">//cudaStreamCreate(&amp;stream); </span><br><br><br>    bodyForce&lt;&lt;&lt; numberOfBlocks, threadsPerBlock&gt;&gt;&gt;(p, dt, nBodies); <span class="hljs-comment">// compute interbody forces</span><br><br>    <span class="hljs-built_in">cudaDeviceSynchronize</span>();<br>    integrate_position&lt;&lt;&lt; numberOfBlocks, threadsPerBlock&gt;&gt;&gt;(p, dt, nBodies);<br>    <span class="hljs-comment">//cudaDeviceSynchronize();</span><br>    <span class="hljs-comment">//cudaStreamDestroy(stream); </span><br>    <br>    <span class="hljs-type">const</span> <span class="hljs-type">double</span> tElapsed = <span class="hljs-built_in">GetTimer</span>() / <span class="hljs-number">1000.0</span>;<br>    totalTime += tElapsed;<br>  &#125;<br>  <span class="hljs-comment">//cudaDeviceSynchronize();</span><br>  <span class="hljs-type">double</span> avgTime = totalTime / (<span class="hljs-type">double</span>)(nIters);<br>  <span class="hljs-type">float</span> billionsOfOpsPerSecond = <span class="hljs-number">1e-9</span> * nBodies * nBodies / avgTime;<br>  <span class="hljs-built_in">write_values_to_file</span>(solution_values, buf, bytes);<br><br> <br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%0.3f Billion Interactions / second&quot;</span>, billionsOfOpsPerSecond);<br><br>  <span class="hljs-built_in">cudaFree</span>(buf);<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>æœ€åä¼˜åŒ–ç»“æœï¼Œè®¡ç®—4096ä¸ªç‰©ä½“</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">æ‚¨çš„åº”ç”¨ç¨‹åºè¿è¡Œäº†: 0.1543ç§’<br>æ‚¨çš„åº”ç”¨ç¨‹åºè¿è¡Œé€Ÿåº¦æ˜¯  22.358 Billion Interactions / second<br></code></pre></td></tr></table></figure>
<p>è®¡ç®—65536ä¸ªç‰©ä½“</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">æ‚¨çš„åº”ç”¨ç¨‹åºè¿è¡Œäº†: 0.4912ç§’<br>æ‚¨çš„åº”ç”¨ç¨‹åºè¿è¡Œé€Ÿåº¦æ˜¯  121.163 Billion Interactions / second<br></code></pre></td></tr></table></figure>
<p>å»ºè®®ç»“åˆå¯è§†åŒ–åˆ†æï¼Œä¹Ÿè®¸å¯ä»¥å¾—åˆ°æ›´ä¼˜çš„ç»“æœã€‚ï¼ˆæœ¬äººç”±äºæ‡’å¾—éƒ¨ç½²æœ¬åœ°Nsight Systemsï¼Œä¸”è‹±ä¼Ÿè¾¾æä¾›çš„è¿œç¨‹æ¡Œé¢è¿‡äºå¡é¡¿ï¼Œæ•…æ²¡æœ‰ç»“åˆå¯è§†åŒ–åˆ†æã€‚è™½ç„¶å°è¯•äº†å¼‚æ­¥å†…å­˜é¢„å–å’Œä½¿ç”¨éé»˜è®¤æµï¼Œä½†æ˜¯æ•ˆæœå¹¶ä¸æ˜¾è‘—ï¼Œå› ä¸ºæ²¡æ³•è¿›è¡Œå¯è§†åŒ–åˆ†æï¼Œæˆ‘ä¹Ÿä¸æ¸…æ¥šå†…å­˜è½¬ç§»æ—¶é—´æ˜¯å¦ç¼©çŸ­å’Œä¸åŒéé»˜è®¤æµæ˜¯å¦å¹¶è¡Œï¼Œæ‰€ä»¥ä½¿ç”¨å¯è§†åŒ–åˆ†æï¼Œå¯èƒ½å¯ä»¥è¿›è¡Œè¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼‰</p>
<h2 id="å°ç»“">å°ç»“</h2>
<p>å§‘ä¸”ç®—æ˜¯æ¥è§¦äº†cuda cç¼–ç¨‹çš„çš®æ¯›ã€‚ç¼˜ç”±æ˜¯ä¸Šå­¦æœŸå¿ƒå¤´ä¸€çƒ­é€‰çš„å…¬é€‰è¯¾ï¼Œä½†ç”±äºè¦è·¨æ ¡åŒºä¸Šè¯¾ï¼Œæ‰€ä»¥ä¹Ÿæ²¡å»è¿‡å‡ èŠ‚è¯¾ï¼ˆåˆ«é—®ï¼Œå°±æ˜¯æ‡’ï¼‰ã€‚æ²¡é€€è¯¾çš„åŸå› ä¸»è¦æ˜¯æƒ³åœ¨cudaä¸ŠåŠ åŠä¸ªæŠ€èƒ½ç‚¹ï¼Œè€Œä¸”è¿™æ˜¯å­¦æ ¡å¸®å¿™å…‘æ¢çš„Nvidiaçº¿ä¸Šè‡ªä¸»åŸ¹è®­è¯¾ç¨‹ï¼Œä»·å€¼89åˆ€ï¼Œè–…ä¸€æ‰‹ã€‚</p>
<p>å¹³æ—¶æ²¡å­¦ï¼Œä¸ºäº†å®Œæˆå¤§ä½œä¸šï¼Œå°±åœ¨è¿™å‡ å‘¨é€Ÿé€šäº†ï¼Œå­¦ä¹ è®°å½•åœ¨è¿™ç¯‡blogã€‚æ­¤å¤–ç”±äºè¯¾ä¸Šè¿è¡Œéƒ½æ˜¯åœ¨è‹±ä¼Ÿè¾¾æä¾›çš„è¿œç¨‹äº‘ç¯å¢ƒä¸­ï¼Œæ²¡æœ‰è€ƒè™‘åˆ°é…ç½®cudaç¯å¢ƒçš„è¯¸å¤šéº»çƒ¦ã€‚ä¸Šå‘¨é€Ÿæˆå¤§ä½œä¸šçš„æ—¶å€™ï¼Œè·Œè·Œæ’æ’åœ°é…äº†å¿«ä¸€å¤©çš„ç¯å¢ƒğŸ˜…ï¼Œå¦‚æœåé¢æœ‰æƒ³æ³•ï¼Œæ‰“ç®—å†å†™ç¯‡åšå®¢è®°å½•ä¸‹ç¯å¢ƒé…ç½®ã€‚</p>
<hr>
<p>â€”â€”2023å¹´å€’æ•°ç¬¬ä¸‰å¤©çš„æ™šä¸Šã€‚</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>cudaåŠ é€Ÿè®¡ç®—</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‹¾ç ï¼ˆä¸€ï¼‰</title>
    <url>/2023/09/14/poems/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="Oh, these decrypted content cannot be verified, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="bb8d966c63681c80cd7fab6573aa5d463d9255cfb00919a2e2d22a6914cb8717">4630436162ade97ba2718b7d0c4b3b630b52af6d94b04d5a759f30a428e7f8aa76479edffcd322fb311ca7d6a1163a3863e0470dffa53a19c9081ffc84c842d6c7f3b8a1f45a0738bc6a3ef03177590d66a708ec714aded6f08785561a895af11709f28e3d03f190b07b55ddf609289d4f43322d0ff03255bcefc9752fc066c9c0187cf6151950a6f0d74d5e13e4babd72d6c86cdf83039667266fc95ae469a9bb3144a384fedc4ee1aa7bfc29b111d79407a4deb515d173066dbe350bc624516d06eedd10e9aca514bcfe48bdec397ced62b5450883b75e8a465c1861139aa52904a79856703ddff6df858e6a929a893866bf3fa661a5dd3c9c2945b9ea7da7ed2915db3439117eddb40775687051b6747fb9c2e52fc9693047097f79687fc0bbf0cd77f12f49e4189e21af41b9f2fa81823c0d1dbc6005c1bb07a399882f3a95a28f4ea856fd10409cb7eebef65c6f5364dcb45886fc93abd1708a033b0fddf273dc04c521441987016ab8cfe8a79963e9fdd3c41c7d86b944a3bf20718db28cab6f17db9dec33db3f6e6ff7cd3c598808623056d09e33275fdfcfd083f00099630640d15b1fd5051ad24d03940b1424acfa852b9a07062f539818d7b3c6f66c6fe62ff54811e29fefbf0ab18a32f40a45566d5a14652c6cdfcf61d00c6b84ae9ff8b23925c3bf6df17ef5b79015e4550c23a7806a574b8ea5021f0dad0faba04cfb9da24f176ed7b7e622f1691eac37465439d062ff843404b105afede1028726fb0f57f1858e1375c96fa8ae80832ec3b0eaa8e782b2fd01cf9d8af88b317daae2c7eb95dc6a4d3b768a2656c5d3f29c68e15607d9adaf7b50ce497867d9ac24d6fa94ddfee31b4ac3cdf9907a9b644220f32b89a1cf37572ed90a1796d3263708dd0d6982e3a21cb4fd6c8f562aecf5049a6b68006d6fb4cc05a8e229a1451d2c4200422ff6c5e44d795e143d9826050b0f6a49efced8b9a9db6daf9cb9d8a61ba67f721c19e9ca0fa0f10d249c580fc3b046e306e734ef49586e2da53cd57fdc5c36934d77eb662252c95930536578d0de55e6dd6c71a1e0737dfe73e96e0f6a4874cca3e5318e80850fa50e6f703c7d2288604e8350d119a419dc7a5d99341716c5249986f5a908f015a778e545e44390a5f4290c522bcef241a0949e880147e2f3cfed08a540f44d53b63ca204c1ffbdea76da4e8c6b4bdbd90d7da6f79394304c68f2039646e5c610939bb1584a43b3e03a1efebf81d375cbc07c347ef5886c3904a45603db187e8fbb84ec8e096f91c448d01e563cfbc674ac77e830a4982e69ea7e07e1a5af512539f0ae6f0b5bee6f601804aa7cff45a224786b02614aa2932da17bc411448e414d0ce0d16c571e64fe67287c3223bef73d075fe9ba1170e81bf6fa9dba65e56222e82145e2069348f678d6c5df933c3ac92b4b6be7385c2b54f1f1d73fd83877ccad692ffa8ac019cbe66180d562a70b39ba3772acd847f1e509e66b6d39a11cfb0999ebc06cea72306fc52180214f3211a4b1c74a2bf95fe6faf2db41e3529cbe43632b6e6ed423541c7953bc2c1e03168839802839269996bfc3f1d2e3faac8418826a27a88c614eaeb0c238fa6c784fe77b16abd199d530feb1f3c98f66a4042b5acb2e20dedfbc16a10a17ca51b79ac1cfe5a14d2d0f788db6d3e340b8700ac1946b106fce99fc560aaae6918247d866af108bc08b9c15f391091f3e7094ef4b546e8df095ca3e5eddc2ef3fbaa85f69dad19505e7cdfba90e83ff7d4ebd6af433d11ef0b1d08d25d624a3eaf60a46a0f6a06f74257e3d52496c7b6a93a3b7530c14ffce868a4c615f38d7219e4ecee0554f6cb94e96858661b4857ebe77046d2b1e22c134dae80dca53d2c6ca438859ca28b2ac88e1434cb7ba52184ab588ba825c3976911e52b3a1017f92e6b8bdd2750945a9fa5d25059eceeaee904b493d32bce0aa01594b72af80f273a00daf2c7791df9327d2cff11946ce6613e044e94d82cfd3aaa42d402be02174fbde84c8546766c9fa96cffe4ed40ea55e39a8c4b314e82cacf777fecb922e0abe01b861988a970136c5b9a8f98d4a20da1387d82a1347a43b1ed585066211fc01c99a707c24f5a2e21085043de896569afbc99716acc04ca04fb0326a249caa8fe1c3b345f01c3f5fc39f19135fab95fc02726bdd92dc73009bc15fb987aaa28720db9e2eadb8abee166ccf85a0b924ded31f55858f0fe15c0fdad138ecec7bbadb577f335f02460bc8e745f50f300e16102690c19da5b21bd20964409f8a916d25b2301d37ddda28afd018ded53a07f836c3dfed068fab7b3177cbb0bd66c903411c6789185cb5afffc07c816ed46c503ffd25bec02397ee7adba8269bbbdd2e0879233ef66f496985996bc67751912e7f9f08c205137aa43dbe24f8bd1f9cae9df91350959b8df7812ddaa219ea119ea1300194d2783ce042469cb2da574e2734b7f9d333364733c6abe78ff651dcfceccb934e37a671980fbcadf0501642a2ce8ea4f51d3bbdefe6c5e5ea77532c96c34f05e134ad4344052e98fed404764aa072bdffc5de1ae1dfa5bc7da968d138ce34ffee1cc19926cc0eb582a526ba878caec6c253a67ccb8628254e0a933f0368a8b3da214b27eb0781a58afb8a6b24b5abffec5d96d9cb1a256cf33697afed279bed9f8b1cd2eac17b0b02c03bde73d47e0eeadbd41d6b9b64bbc1f3eff123a8acfb1add13cb7c69ebe5bb6be34ec036592bfab325a0cd773972d5341ec0456ecc35d3f359376859fcbf9b354770a6735feb71e5cf7fc62bbcd3abfb0b7353d32d60a0a7c8ecaeaca5c6bf6159b1d4456a9c49a2f7f90adce2f214cb0db820d7128311b31991274a9ed9a7f8f7e0fcd6a829fe887176eab8e3a25112f0ea3618ed937258c682a71cde1e3b30a4ecb3a71265a0737de5565b31b6a569a5b4c00083e39546f0c7ff758fe2dbbeec30481fc61d0ece88ed372757bc11cefc7c45fe418a07bf9e527153136109b63e5b8ead4d9c4e45c455c98e9f5e4cdd39b05e4079f5d59df0cbd222e861e4db7ecf4c001e234a1e7ec890849f5624f0e892ec6a0f5ea9e1c47121637661eda02cb4de7232ea098e923eac9053d756780a6b44cd4c2833e9f1f50eca489fdc6f085b1e1a541540ad436ae277512146b6a347bd912e025082f787717063afc2196c50b97b7e75e9fe396013fbb856dd2a07451bbf0a154184104f4bd94f4d27dc8265298eb9f37b83379824d35dca530399a71433195695353da54d1037c93dfa23f466f0b3305d8ab2d7ff1dadd26bc337753c7da2ea9ed102e19e54a6f818763a1f5afa9a762215a0f7293a2e9f2bd64d6696c08641507d403f8d55b4aa5b49c0ad22b49c4f4ecd17478743faccb77b8b17bbacf110a31a1f4e88dd3efe5357e56732ab01d4d6236429b3a3bc9ba81ee28c34f568cdcc5ddb6a051d9c0c301a8a4dc39c7cf3d5ae227c8734bfc3ebede9b308dad555c52bc21ebc8d9651876f6fe8eb158f0a683b52e9612e6ae50edd0576615cb7da004105cda880880de7cb79b56cfa4248922ac8fd650c24c5dab82f20d9b2375bc8102ca91ec959bda56dbd874374261071f14ff9a70f93ab09523c381fec8051cb6fdd9f79bea4f008f3ac30387cca5ec6cb5000cf10faab5df8c5c1105509cb88f9a1f4393972de527224b68a8231f96719d01ef0963686bd7a84c688274b7fe3ef736f2121b369d8bc1227844980b8e0c89d1ca134acbbcac3d2706d34df9ffcd5de2124c94beefb99e2db77bf6d5ef6a827cb7032ee024a223d2b066dab7210e2d844b4f92b084e548f943a365647197c714b32b34f17e7c37519cd8c2f8f7e904677d9bb057970825802412c5aa195492f9bd74e2a57cce8eb39748105ce050fbf8fb77bcf818e9e3d40ce2fb4d75c3d5aab04430f7d9fe46e1b483c4143be7766c369366d56eefb5c919ec8b16a2cc3534666624eb91b6368556f926c05de14af06b42c6b9d42fc83043645d72e0bf584c9ae59edcce00980df3e66c8d9f67bef52ef07c54f565e70e93a1c2839112f7f22f7394129080be6892c2520e3581774c5d0732e3b86348da5234d1ca797734a8b028f68e62e46125cc5f83347c0891d467ad6eda90798850063c10adb1d348a2cfe76e7b4851beedf2339dc2c5076bc8651bdcb1256a80e9f582b1be0702cbf62ac1ec8a1c5f09f6174ddcb0a59df1e1e0341fb68cd54e772c76d3cdc4fc884b997620379a641c0e4eb7d20e773bcf81270979ebd649c8fe6f6299e972d08b3eda24523ddfecb45c5292ce1e2cda4df8515e972809528e93ae96e876b932f63f6ba74726a632967ff0b2a8bd282dd3dd86c04954d7ba335a8ce693f22b8e0c64d73f07fd996f885bc0b8c0cf7e5065543d4a27b5512d9bbf010f14a24699f42364a51428b3b9e5500e73824fbdf36cd26a54967a82b4eb28495faa0df10900e509d9f924aaba82ece132d20a6e17cb70367fbf8663ae8424fbf06e849c674a28a84a9f482e1417d99d0ffa2bc7d2bfba25f376cd5eeffa3a109899b8ddc0826241bf3f7590c8963719301c444b3fbeaf727b4252fb67c6891803682b2e4d9f650716a13700467ac8bb49bbb1ef6c31bf3612b6a5e4728f3e528a8798af45f02bde5036d37fec35fa59e89954e309973aaf54a4cdfb8bd15ca9df929bfa05c0eb3734f8e8dc224baa88812e890497715321c06d6f567fbe1c7b2fc304aff2d1f60084f0e80c4c58788c4584fc92eba0f523934925bf8d839867231c474f75b39b037bb8d72281e946678ea412e26323b4053e8ad873ff4ff7e00b3c30fb5f2747a9e908a5a6ceda884655b2ff945fc305f88a6031e1af28215f3a47831d7a8d299be836cd40346d77fe4a9c113336aee22895916b008e8e97d2b50a30cda06cd5d65e1bf861fafefe491133217f3af3eccfa93d98d4a6ca9e3a63b414af45f1154288cfbde76f684209bb4300a672c6cf9d517164f0bfd3c0d73a2829ad3c6982dbf9ecb5eb2051efc389d51316a16454d232fe334b51ca938ccaebd3a81c3d2fbe53999964ac9cc34fa4e853626af0256ac0f4b41698ca317ddf2cb857ed7c46034894c06e3df62ea80c6c7f4641839cdd80f914ec2625453b3954dd39cce600d19a84cf4fc2edfe33b28ef03a898e2599a09375202a7dbd7b218f72d9c46688aba7b917bf3f60dd45012d1471b4e2eea15b1a13e94308149cd16095cb0b795110fd0a2fd3a2f505deeb36548d3b88f75664ca0dc9b8a247be1435d30585860ee30abcaf6b357de13dd620bf266f01d1f942f9a5c3e19ca68156c455325b69b7e48b5ea152101e2acf739927d1c066231208f6735e9a02e1006f618a70d449de4e8b96ad8bae620026b26fd6246487d8a464336a724c0ab9b76832afb4afd225391e811a7f844d53a2110c75c4187bc30eb9809a91d78d315cc70e0c6d4fc98591756f20cbfb060c1ce22c17395e55d6c616afeeec34566999cee61c7f3726a097cb7389c95d23289be7ee76a107a40ef701ac6888ef9e3bc6d292900ce4625bd345a8caddf9ea5370fa55bc61b2ef1d95066f5f6ec75d07e08261090d13c18a76809c825c6ca41ebfc795116eb1bac6f716dc5394c06216b2f7f61a2b29006e279b9c416dad8a76c6aea717508c054bdacd0475aec84f0d0504fad53d2f321a304cec57088e435b99a735132980b3abc13c4abd3f3642969db7a3b58e710eba0d6509fcd3f9f7dc77bc05866d674604ffa504ed7718e71b987d90c0b6e1409a09a7c5771caf2ba5d1a05bea56525915f88a7576e3e6e20a9a0ee1138298f1559a99640454d503ec822fbed6a83c78ecf28ef0ff844a7c3dea6c272b4f34562e71a567e4643a3566fab81c2a690a3c23c5243da89574837fd4ac9358a11da132a2bc25bcec385218b38ba6aea573fd62b0cd7a4f373c43585c6d1bc0ae9575246c605f36044886bd0cdaf46f4ad0628e6d4774637c95f264c9b00d0f2353d7b8c047eeb64f5b5085790e6b7a12ad5b3edfc058fb2bd9f6ff0e76c1a29a22f440ed6991e07e298ef509873d360e8f8a777c3582461981c71a91bc69e92ddf2283cf5333f6adc239eab2457cc054ec14310a41f903cf2a06591ccdce40c2c3dbfd7d2d759ee276c72c1b976a492452e002920ce31b50ae5833aeeb06f1477282f79dfdaeff1b527531dba62bda9c994c6e066c5a19690eff09e0351d63a36485419798686057c8e4b1c2e5e3e8f26bf2c3f37245332e8375fa06ef1a4ecde134b12dc2194ac84765992de6a1f2fac9eddc97bd54a810be417584ffae8fe41a71aaeefc88997605ca9fe62be0060061618f6a02e078a3cb3f372db24b88d87e03987062613a11b46a71e5934c858f758b7d0d7c5ff3c6b1c21b7815d46b26bc8b3ed973068bf73852953bbde464ca630fbf2fc24abcc37dd144a7b06a2b5aa6c623c31e72b0c752ac9e7979b51062e50e7578f6d590e9ef80519566f808f652f14ef0fb8ee8de314349e2db23922626d6d81690f50aca0a19c27af2b4297462bc44639b3a1a6d9cad833ac6ece964548c718939993dc4971e66623dae31969c8f8954236f117c1de61ada1e087fbe547aee7c85923d512f0310daffccfec8f6d48ee0b8d8eab59e3cd9b9f3d2d819d36914004e85def73654bdb37810cd8d66301e0d5b90d043de2287a21de9e5900a6f247d2f938b433980f7798ea925a726d533fcea69ee599993a0697576e61655b00d2f7779653e5aa7be0f99ccdd82e7673654e459cbd2bcee1492fe0dcd804ee7bb81e2112a24c0938b7dcfb3533ae544f3ac04c65e82256f8d3fb1a37dad40aa610559299c81fa0c5f2ab309d410755dc52c12e1da7e6d58f11ac9856e7c28fe8cc2b452323e72313c97f4fcf96148fe0494007a8abe83263bf6116bc628dee1d580246f7446a30daf0a40d271c4c7069d642874c2894432a3229f8497e5a2783d1588effe97cd528e6374b65731f171ab27d47f95bec0c62aed5569c05507e96d2be37e6ffe2eddd3c25c33f05332e34d46dffe20e55d6d575bb9c866182613746adf053afc1be34a1122220eda157d805ba8826fb7109c4eefd6352eed5ae927e8c520af09ae38f15eb5a73f795f18db42fd54c0457ab4c2ae3253c10b49cc8eb73f18f7ce9a14bad309c597ea1965c8cff4d0fae689d24c7b6666f6af89498bb66cb6db5694e2c54bbd649f0fdb98f47e5cf2f7260d14c9c58c183041db92fad66fafd41fb8ab40c103896f4f5644fdc83a231fe0ab15942167832514e412076128704d6690b0944a91cfa96144594580b7b0b7fef98a64ee29e7ae8a74c7b6df94af3cd2802a87c3edaf3deef1ce3cdb2f44f6fc856f4c99d8a4cbae4341ad1ce7cda8b4d00a1418b17be3d27f04518d6acbd0cf040266a341db38510ef3cebb6d3970e156f02312854ea6c7646445ea16a4089ec589fa4ac986e97db814917511fd5064f60f3a2cd493bdfea26a9ce8da148bb3057743b238bc5030541f36133b46d32a5ddb09cd4c0da3a98ad75964c29178b3fadf7d98dba760a3b96b9210f3ba99c673499e65a2cd2ca9bb7c3cb2ffad92b9524a4d2302b7048e593d6bc64305b07fae8e466d3102c15c0b2f86b841b8c4175e54a7c3125ca9b6add0182cc43a0e7cd481fe1ea289708dcc8298560873e50e2040462482fa082771b959a3b26fdd52fb3b1b90f3f24f57c217de660b39b95f92571be16d3aebd347597809427824eccff7e98fe38dd02914bd242536ab6e0c6f973e3bbfb7e8e0a1735b1c3a987943c053c2fc4d28a71bc6028dedbc2dd59d5e3bc7481454ff6ebdf7fffe4f6176f68303c7ce00f2f9eb18eec87aed11a9b05540492102ee889bada0d07da7e0d53a469589028718f58122e601daddcd7f5f746ba8c0078e2c71eb2c508b10c93c0c7f065cee47d8cb65f8474bb03fcca46ee84b0c65321e9fd6896ab75719ba369fd878031406f05c00f5aa1bff797e442ded3a5458a2084c9ba774733b4a8ed1a82416dc95e5fc15eed7d4507cf9b1df77e937f2bf1485edcc63dd16936fc5799e3512c5925a20ef1a41722e3e88c87579beff0aa1cbcbc3eac6a7222c02ac9431691b3fa0dcf9fa2fbaee2b373834e4fdb8d76703b0f2855a68e95d1bf099d911ab850548578021f8876ed521500e84ec2fd893a762c419391ca0c76cf616045bc1cd5bda91e01bb48f32bb1a0365cb6dea14e366da7c152e9eb1c30f05b3604711dc4ca22e49f343373ed8a9ee5c744af829b6a0a6913545cc0951851cd2dd5160f4d57c2a32175e7580ec2ae0c94eae52bba8f5880a4f0b4e6b22d3a03b9f2d1dcd8f743930065f69762a835d54bab3315fe4ed8250ffbb1571b35327da52099aa544ecf4dfc2980f12082258af5c4098bd47653b3daa7be9299d0ea600b2a0c6bfeca79e49bd285a26d1c60b107d0a5e121c504b94fbe3c80d1b1580819f35fac669d121e18e0f55909296b4103d6ac1bdd7a21a5b6cb16a6ee635403cd88c6efdc0edf3b788bc6735e7debfa552d0db59f3b5a80a79a634b655215d8f58dc1f2de6aec2b077bccfff0fc7b626c478613779c203542773ecd3b98b94e2715a47f322d5f1de7287dd8a47227950f4d46eb1b6f0a57622bb130a9d20021e6193db3f9237cafa3a944360e343d4a787a473926ea42f5ab2ec6dd9666061dd65bde34e97fee6edf43acdf7131f0f0065401162164589de19f73decb2b4dcca9ab0bf7916153b1ea0c111b268172a918509409561080c541c753</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-up">
      <input class="hbe hbe-input-field hbe-input-field-up" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-up" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-up">æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>æ‘˜æŠ„</category>
      </categories>
      <tags>
        <tag>è¯—è¯æ­Œèµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>å·²åˆ·å°è¯´çš„æ•´ç†å›é¡¾</title>
    <url>/2024/02/01/%E5%B7%B2%E5%88%B7%E5%B0%8F%E8%AF%B4%E6%95%B4%E7%90%86/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="Oh, these decrypted content cannot be verified, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="fd162f463b2318bac6aa3b55109dab573accc4987106bb1fd155e126f40048c0">4630436162ade97ba2718b7d0c4b3b63a5fc818b2cfd7b089ce989a5d42cab98faaee81d592492c79e01d4450850166cd4e2afcab8a245abdd43dff54a502606d055f0d83beddb087abfc95ee366cf9aa57c98db0f1c8de622c0aa98af16b2373d90df390cf959a6541f7e7513e96e6d5769fd6e1fe4b40e249e98a5f26842ace3fc14468fa12d8b2ba5032bf87520a99777b590fd50311ac5058f1444a3e1b1e6333907b07d2a88e6fee0fdb51a73c4e2b2cf04fbe4bb6a6a7f4e062c11eb5e612414c82058e055c83fc00f65e31f3b9493c10ebc50d84a517021d499f0014c25e9026b760f47f05a8b03d91984c415fa5e15f6a9f78603c2a11dc8f9dfd7dd9f06f932044bbc2355eb1949dd4744132119b73f64dbc82a6b6e1e38f82f378d35170971b1d5950a00fe542063057021d1b61dd08462ce591e8fb0503f6068abfbe7f92e622a0bb8b03152e72d82da417924f51bed707725a31832774ba092e37733e1f9de137ad3da40049842fd958fd7c8b4abb67ae4b32c95e9d8bbf4914d533fab5089c9b1aabebbb74494b3512c9a85b9094ff0c77a2dfa43adbdde2c40086da93429fb91cd688924252f0aef30fd2bfb5d12e8114ae3d843469e4ab76bd8aa1b73acf7c4fd0aa89855c882d426e6d26724bcfbf871e88b0b758895168c8e0e1df9653a8f8e129f951ed08577c2872c1e4d70d977a04f3ad7f0d768c5df357a3e0e56aa5d27009a97da96d3945f32a4d89d5565f6cc366b8fbbe043da9d64eaf6fff206eec5d376b7a9ad6bd4a3b729d22ae547fb9552abe53bb97d772bb14e4d6e9cc9b3c86e8c2352c944b13f39c96177498c38f2b691d4ba6284f8cba327accd81dddf87ed1327a616c3d126cf6c0553dd3d3e7550ae01a4dc702d4e3269bf974e62cc21f6b356f6b1aaa83887d9aca023e63e6e6a1b86da7b108d18261b7dae04147da9b8a5e6137fedc2ab8f4257008c52a625baee0dccbc4767d16e6c31760f7ae20121a996b55e35ecd9cf39b410cd4a4f2bd00cd41ac352a8ae7643c77f6a5a6e369856d3e10d0819958d250088431f0b1f125f5f23fa547eea72a77bcf6aef2fb32ca11d788d5a3f997dcf7a24ae1f82c3528f091721b5003aa2d7f7d19ceb929a88f1c81d362839010903ddb6939bf3b9d8cb08e6858660fd93fa59559fbc492e73277ba8e21befeb355e789ec857b7e5c34195ff105dc7ba7da7d903211d462f210179cb8a188b132282ce975317fb3e6cb278b70d2bda760f5e76cf2b50e0e38022632f404490667159ea2a2c0d73bb76d1270c23f02dba45ad6790af01b4fca533b33a0a4e583e3cf942342c1e35fd8ba0bded08809058bc7ec34e3f75eedc19098817b90896352b7c772b43ff10227d6e201cdaca24c59bf887fa4131b4152d97feaea23dba1c188f70a96f7b87bd6c6db5d41d23f3fc551d2319eb6c17ea52382dddf9d28c0c2da176368341ff4e1575dd621d0aa1f27c6538f65a1306f07a9add2b6830f7ab85b4bf889160bfcb54ced7f0a6defddff9770847eb40b5b2c5c6539586c9715a6497130131baa8150f1b91ee2cf1129bbdd47fb646792c2fd000f78d7e6062a0c9f89ccb016788574984926d5fa5671f9d88d80f422c2072fed4cb312d8a13b8a1d2d52897013c51873c0753e268d01535684c2a55002a4eea13f5d23f07ad38cf83c451d0b948e5ee4afae3a4ea98f7f1a9ed58a2a8416cb957eaac7844c9b3c3dde9210f5a389fb63885332f747f7dba020cfd5c663d57d6dd76dc61be7552b3591e7dfa8e6bfffe7e115f96a687d75d24fa213da78d1b0167ef116ad32784f79b276dafbac8d3b3d7235f0dc2f72a2a6e735e6b4c0023522db383d046e66679b864f7ebe2f8e8b848d668b5cf6889a87f4d5ba47c33c78935f416845477991a287cabcd42ee6752b5ab5609cfa1adf6a70d0e7e8ff26abda8d3ed37f8a36fb8d45453b26d77485e290bb07782aaf9a42630a58a44b0865d1c0a66a0126f09fa0ea835c4666d1fe5105b8a7559e9240a5d2830da1488e01a4c40f495bf2b1fd4a8816edbfc4c7d93c40c4aaaa315618f424998c6719de5808fccfab537dfd27602b10648c5fa8b28b7edbb3dd86be08ac0b5e2b8cf901609c3e937d3fe017bb6fa9594544cff5ed119e5169d657527b7fe6aa1d1b416465221d446e7657bfffdfabb52abf4be9b36f943eb1c2e64215f0a370846cf46b8c547329b08a3831a105975e8c2639dbd4ed07e0426c5772dbb483eb07e13a8b6641a7151bdd85cffd424e1d2812d140d44bc02e0a114fd33cb57c9e708a499e37c00d7f5023c0264b5c301a1edd3ac2176d173022828b79d02d20b1f2bd27e879d1616acdce587fac92c37983485ca81a3faa6cd713be65a78cbe80436b8fafdbcd76911cc71be92912fc212a3b5c1ed16d670d36b8b7612233d38a74bcf9d8c7f537be288f5e0b9ec709632873cace3e992fdcbd3f47788ef2c077ad42c8eba48f59a948fc6f2f3ee77e5d80b7ec8413bbbce45efdc6b747827245b28797e5cab294dcda5ecd942700880b30a11f2154f6df5b1220fe8349cba9f211a24f117a47bdbf5fc3a47816c342800996a31855b853bdef59749d5f2270bad68ab0add44ec6a619693230d5224f6c97468d5e16d4c27b18a26b73069ac05445ad65ddf43b4e597c27e328f059b6c0cb85a35b797a2473f5aa07b4b480c438ab38fc5f53c8a4ec0c20ecbcccbc7673d98ec4a411a9cc378714cae1f6fe865fbbe06707ec72bacb4170e7b830605aafc49186ab2b924206207e8fc78a0991ed9f6f528bda6933e076dfc6e8ddfc476de716578299cdb59d84cd15111f8556e52884601d078b338eb2618446bae741b4f291dd9f592bbfcfb740fb748012143e63dd6c7dc701f8916f2c0b521235963da0302055e0b6cb5eaa7cf4d9aa2d579edb1b4cc1ae356afc2dab911eaf146a2a76e074e6a9f3ea44f4fc07048a2fdab4d05d1b42e3f93c983cfbf00b706c85d02fa5549338d0b4c1a48f83a7dcd1f19bc012c6d8d0c902d8047c41f13d7291db1c8b2103dd8f1f8316cd37785c4c6a304deaa2e222895af4c5796e851af4b4bb451e24eafaec471b274826b9b7ab13f306fb8e9a2e64f1afa196cb4677afd29557d6125029a6958f5d95bac6f90544ef268f49c0e05e4dcb47f22bb76dbd4b66d7b62b2748aea6e39229e1f596b38fb57a8f3979c3c5c3089bef279dd8d4655c62f628353c42ff1b4124a2db446890905dcc8e177610075663aa666a17f82e702964eebddd7613dafe31bf8625c844781897714ef5236aeeed684b672464ac45c4cec5622364e2c89671bbabc26cc3e74d85283a834b016b7c92779bdbd8c7e5e4221ce49468f4a6fc55cc02d2193f2203a10506209549b402702bfc5987f68ee4dbf13cc940a8b7182e16b042bfce40ea365715016f0bf21dbcf038b7508acbddf7878b838f7bde68f7e506fb8683adb243b2ee83ca8d0a34a36e8b582ec61d8c4e3c3d8bbb8f840f772fa7298087fa7f21b00286aa19c0878949ee7b052f1fc7269d0bb160a4241e0ab32a2e308ad5271cc11a481b2d5eaa3fac32d4f9145e0ea916b62401af0fabe2c689218a330967cf85286a4d01f752c28c5c98cb6005a016b3a128c9158c3ebd4f7c2b169b043bb81630d2559e626f66a682c3ebb1c80911cd35c629a8314fcb70be00e003a02b6643287cf4d8f3afc494e45d7b41e1b97814166796e313aea264582848b192d288f6c2ef569c56ef7963ed0623c0ab2f9d4e6e110924e344c4cabf769d4deb416bd418265edfeaa2a10aa60a9e751bbbe86e244ff9745c522ff05fce35887bce8a7911396e7bb82e372fe82dfc5d5e23dce40247ac2c698a05ad2cc08eb92bded108185294220d7c2b745fd339fb31ade4c74e8acff7fe9412ea37266f64340a9b2088e12d66bed72af2007b6e19b18803959aa9c85e8979b6887ac9bf72e9129b080417da568252793916d8c8c8b8f7e373ee150e93a316b29ca1b5ff616ba108789a151e17bab012ddaafa79e050b8e7f25698ba33af93a6ea47a477d92e7ca799a0133b08ff824760601de4590c61eb22116edd285e782828ad7c80cc2858b5df9cb61258ab273a1bd2a03116f9654c5e756d95659b5ba5b54a4569d2a2f6c5db5aff90d4fe139b64686477f78ab80d40a63d402590308e5a3541cd891225d3c0da014d5ef8098e4ccf199125744ef85a2c41dd9630605ee86b53c8a5bdfb5f5796ad17d80edc53a81d6fa86fb5ddbd8969174e26847a9d190d1132424e533a0b19ba5049b195e5dbce9eb8d59bf524c1c37ea33a2746bb884b5ea0ef74d1fd598f64fff064cd805ea440ce315449f1f2514570f7f591b1ab249bff7286f0e10081a3dd30ac06601095ceb711061f4466b8e81eaffdb8dae064f5761e6c66532447e21ecdbdf82b40e3ea4de14accb6607b43eb7d596bcd6c0a6ac34f065908b9e6e301d4ed778ad373c2f093546a6ba0d30b65adac28d6fa1489a0172c8c7a9b08cbd8f34380b538bd84d14337598bf7378081b2f013321af8cf70fc3b8ecb3ee1597143d77d71589b1b7735363154245d82ac8125581d771bc2dfd89ca0816fb14912ba4c4ace04ee1c5e37468c048cc7eea5f341b65e5361a2e292e9d70446e461a1d462797c9db4e5d0eef2d59196c752108bcd4193e4cea51eb29ffe87ba046b42221671468445d2580f6db85a65e69b4207f354f78ee3945e89f85ea4b333d145b2fd9b6c90771fcccbc5abbbcc34f5522d97d79358a50ea5151a56316ad95e5e02e70d7ca8feb24cf64447430b9d5354c5f6b07d93505abfd6dd0d9bbc330e0657e095db1a58e3b9c90b3215515e5593b8a8c0516b105887b3390de133cdbcfc0e13113c52af5354643ea4f0aa5e070736f2f233f22f9791acf008aabf0e9ca89597de7a7a9f30d6a3a74ce6e4466e8c11690924512b4ec4c25b9bec499445a6b245587f74a158a180e038dff2bfa512b803729cba505f99a7b1923ce3377d2ccb0bb071fcd0511e6775d78ba3dcbb2c2daa2eed71b846dd1df41527a49d3e684c21ab062a57e29351b592e0a9065588ab7c4e8f8c89cda32d9834e762a6027c2202a2137e758b5b90eada92cb698e2e3b219209f31e9bb6426a4c3a960d5200241adc53d94fe95cd59ccbb764f4c3bf7ecf06f182de400eed48aa0f3b134f70555681665208eb385f27fc8c113e7cf35f1a8d2ecead0b2bd1151e2af6ef8d64d9fbced148d869398708a0d01a2ce5507957aba60cf59225652b99f02c0a5f6999849b4deb279f972cbfb29f3d87937840980d93e04c785791ca36d7e8966eb35f568f2bc876952e7ad6b2a432f2c229a42dba44a25fd730cb884fe5d9e88d266a4a90c84c298233562a465cc4a7ea4ad3b1603ccaf43be69174cb52ad5b7209ea3ea985abf12d88bee48cceaa240626ffa87da348cad82faa6558b7f0080418cd4eb00fac346e424a6a8076160bbb048092374d14c2c725c2479b78704eec29a398b33786b3a208c3fbf5232765c088d626765b56081afc24e7775ead1aa0708edb74d0cf2009150bfcc4203ee298677eabe5ed7f179dd970766ddec265b6fe21c39907fccbddbea8e5615c0615288c5d70c3990a2e9c837058f6fac36f4d6471efd8a9c2100bd02d6eadc147e1fa1aa592b6ffad85317b05b179347fe5269a7aaf4b424bb9193f839dfcaf4161a03369d90352edf5ef3f6f46610942869ac58209cd0bcde922b22e0525b1501f10c943169735205a2bf1b09ed0ce952e45c9fb102a8b859e565bd34be4922284cc350e70094dbdfc96de041a0fe898e8d888a1a5c5df53d06a0011740a57263eb040caf4402743c791370d79b1acc07fece199b9240ddbd7ead48e3ddf4e37ffcdb4dadda9baa087ad2f1ff9cbc9a16045e3308b5f8bb2419b9a93386190b97d80feb04b1955bc1c5515f07593c586c1bebe7ced84589045f24f8c7d9075eeefedb1dae965aa9fda073ad9b62323bc2711312b538be267dac479070477265f23118cad4efda0cb3e31196518e4848b70236994a1f6aba77769e1c76ad7ed60ded0fdcca419a3b9bf2a54e7c431e180be2b8edd8c766c8b395fec3ab0ff30373c912a9adfa9c234975eb2fb9443c86cf43185f69549a70734a061cd496f28e3291e3817ddd706512d0f6251812a58d62f196339d9e06c406ef0a2f7d6f9b246cccf221f92f746c067c26a6053d77f566e4d979e23ba7693d312b525b11d21de20505bce427aaeb44f2686ad228b568b5e7de449b96cb2e26d067973cf4a2ac260b83da3f9281a29f108374e83cf9147262849b06793c35efd8c3bab15407fec2e2a7893f4b19ce77a4e529d9a4a03dc2ba6215b11c308e5ab76ef0615d3be75306f6db697af09bbd2d0e58a193a002736abde2e7e8ab8b94941771575460d6f22932aeb89d84c888dbfe7820b2b62b5bd30f92796e7b4ff8340b6bf43a61c0597bf4c876f9af6920509044608d0bd8dd47617ac829dddf06d2885344def481200094c053e24fc59e00a001b44baafcb4c116447588ca247747ce6fe48f07cecaa91ea88b4940e87ae043b71b6b0aa9a72e2037a4bbaab6abfe8c62b790de9f4f93c95cbcd903fa483e8ff5ddfc54a2abe7445c82039abc63ad3a3b78a4b354b05c5ade8d8d72bc6129db1c97eacf79e8390df4418e3effd5e357c647077b2660279d25ca715ec375015d501dae57f16f65958c923c53e45aa651eeae270d24f7f29d0159e9254ae20e36807a912975c5e26a8c5925134d298207d7238c367c378e2aa0933b0c2f47d9621de93bd561ff428c7fd2df73b0f879259d1f207dd1b60085ce8bf6e3f44cc9eae0ce481d1cb89d97ce177578d06913a894dec395000222846ce7f70adae077b62191dd4a4de5d72171e9c0e357adef35480018551aeeb900bf0b4e15fcaff27dc8161eb11a0964dd3925155ad1713b0136895c9da4a8dab47460635a144bd3f5a22d81fc16b2986c0ab3c4a1088c02835a4a7a1030f116fa6f5278771d3a70aed7a31a08d4bd69edb91cf29257037cf36f03ddfe5c87753e13658fd03fb92df03076a02c590df5fc89adf2f41600ecc8c117c2ca3fa3d00d9a5045b0704eb03041169eb510783ac56a4da1aeaf680b3a4b3aedbcc434fad7d3a78264b0db97f1deaaf09411d10c04a98dc6a601eb3f268cb7dbccd2762b9ec1f3b6b006604d55b1c0f574f61cf13b3def721b0cd80b44e4ae1810176cb9050ef2eb657ae919507b4184d62b2820b41b8dbbfa575f03e23756f5d675bac6ff4d7e7b9bfc121df2fc3f094bb703923ff410ce43b496a920669ce2be7c24ff8af548597fd4fe6ee3440c4ea530731328867c1389533d15e94f88fb4d1e40db4f9530ef6a10f099f27872368231d67f3eb959c59763a33d26625c99cddc07b1a617f6b86a7098f7059319a4686bdf388a704aaab0dac24e907c11d12850373d801ddace1ab7fc07742d7df2d4a55a6066ff4e15dd68fbecfc22531658f255c7050bbf0672346d1739df33a1790f9da327b4eec592064bf8cd6e5cf2e22fcffbcd978112654a0ca08e5ae922ec051e417fd4784fac444c93bb49ef3e3bdb3e0639f510b59010285067804935802c33cc01fe8050f244b82d374c828f679798a9bf00cf33ebb02dc0aeb6ffc2f72e0ed46f62279c60137c3e5b6524e79adcaf49e431f14d81e6a4be309213fb48fe0bc71a1d19619cd9bef204a1465f570a8d2fdfacb1b3649db5b79f8bf8d8bb88a38502840536dd8e3707efadbb070c6c2425b4696fd8e98e257e5d638487902c8e2ebe81a11f850bb799c3d866d384a8844589148cd3a1093716da7cf2efcf9e921268e03ff06e21077d1edaf52fa9ead32e83249e1cbf2f2e447c32111b3e9c1752f566a0a97cf927a5bc7459aad15cae53491e512e0328fb69f6d62d7ce70f30767637740d71d41b204532d25e86a00f0e2cf70b49c8f1d9772858127aacf7fd7e4736925c21b4642b804fee1e741c8b5a9d59a2439358c2179fa947bfef46860b3aa6d0f0db02f387bb7132f80198edf30ea4901d48f60a2ae4f850f689c8373229cbe5b7bc33f347d55513b3ad72d11366c0a2b82ca6e8312fd8f5c895b7e0018057541a780a3ea2d0ec42a18a7aa376554fbab8a02ac6e0e8942d584da0ea7f2f40b4941550aba8cd8a485d8e9031910584909b81eafb95</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-up">
      <input class="hbe hbe-input-field hbe-input-field-up" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-up" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-up">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>ç”Ÿæ´»</category>
      </categories>
      <tags>
        <tag>è®°å½•</tag>
      </tags>
  </entry>
  <entry>
    <title>é€è§†å˜æ¢</title>
    <url>/2025/01/04/%E9%80%8F%E8%A7%86%E5%8F%98%E6%8D%A2/</url>
    <content><![CDATA[<p>æ™ºèƒ½è½¦ä¼ ç»Ÿç»„å¸¸ä½¿ç”¨â€œé€†é€è§†â€çš„æ‰‹æ®µè·å–èµ›é“ä¿¯è§†å›¾ï¼Œç¾¤å‹å°†è¿™ä¸€æ€è·¯ç§»æ¤åˆ°åœ°å¹³çº¿ç»„ï¼Œåœ¨å€Ÿé‰´å­¦ä¹ ä¹‹åï¼Œè®°å½•äºæ­¤ã€‚</p>
<h1>ç®€ä»‹</h1>
<p><strong>é€è§†å˜æ¢ï¼ˆPerspective Transformationï¼‰</strong> æ˜¯ä¸€ç§å¸¸è§çš„å‡ ä½•å˜æ¢ï¼Œç”¨äºå¤„ç†å›¾åƒä¸­å› è§†è§’å˜åŒ–äº§ç”Ÿçš„é€è§†æ•ˆæœã€‚åŸºäºå°„å½±å‡ ä½•ï¼Œåˆ©ç”¨<strong>å•åº”æ€§çŸ©é˜µï¼ˆHomography Matrixï¼Œä¸¤ä¸ªå¹³é¢é—´çš„æ˜ å°„å…³ç³»ï¼‰</strong>ï¼Œé€šè¿‡åæ ‡çš„çº¿æ€§å˜æ¢å®ç°ä»ä¸€ç§é€è§†è§†è§’åˆ°å¦ä¸€ç§è§†è§’çš„è½¬æ¢ã€‚</p>
<h1>æ•°å­¦åŸç†</h1>
<p>é€è§†å˜æ¢ä½¿ç”¨ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>Ã—</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">3\times3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span> çš„å•åº”æ€§çŸ©é˜µ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>H</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mn>13</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mn>23</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mn>31</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mn>32</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mn>33</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">H=
\begin{bmatrix}
h_{11} &amp; h_{12} &amp; h_{13} \\
h_{21} &amp; h_{22} &amp; h_{23} \\
h_{31} &amp; h_{32} &amp; h_{33}
\end{bmatrix}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">33</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>w</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mi>H</mi><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>x</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix}
x^{\prime} \\
y^{\prime} \\
w^{\prime}
\end{bmatrix}=H
\begin{bmatrix}
x \\
y \\
1
\end{bmatrix}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>å˜æ¢åéœ€è¦é€šè¿‡å½’ä¸€åŒ–æ“ä½œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo>=</mo><mfrac><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><msup><mi>w</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mfrac><mo separator="true">,</mo><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo>=</mo><mfrac><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><msup><mi>w</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mfrac></mrow><annotation encoding="application/x-tex">x&#x27; = \frac{x&#x27;}{w&#x27;}, y^{\prime} = \frac{y^{\prime}}{w^{\prime}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3185em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9735em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3706em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0256em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>å¾—åˆ°å®é™…åæ ‡ã€‚</p>
<h2 id="é½æ¬¡åæ ‡è¡¨ç¤ºäºŒç»´ç‚¹">é½æ¬¡åæ ‡è¡¨ç¤ºäºŒç»´ç‚¹</h2>
<p>äºŒç»´æ¬§å‡ é‡Œå¾—ç©ºé—´ä¸­ï¼Œä¸€ä¸ªç‚¹è¡¨ç¤ºä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>X</mi><mo separator="true">,</mo><mi>Y</mi><msup><mo stretchy="false">]</mo><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">[X,Y]^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span>ï¼Œåœ¨é½æ¬¡åæ ‡ä¸­è¡¨ç¤ºä¸º<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>w</mi><msup><mo stretchy="false">]</mo><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">[x,y,w]^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span>ä¸ºæ¯”ä¾‹å› å­ï¼Œå®é™…åæ ‡ä¸º</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>X</mi><mo>=</mo><mfrac><mi>x</mi><mi>w</mi></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Y</mi><mo>=</mo><mfrac><mi>y</mi><mi>w</mi></mfrac></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}
X=\frac{x}{w}\\
Y=\frac{y}{w}
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6954em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7475em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">w=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>æ—¶å³ä¸ºå¸¸è§„çš„äºŒç»´åæ ‡ï¼Œé€è§†å˜æ¢å‰ä¸€èˆ¬é»˜è®¤<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">w=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>ï¼Œå˜æ¢åéœ€å½’ä¸€åŒ–ä¿æŒä¸€è‡´æ€§ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆè¦å¼•å…¥é½æ¬¡åæ ‡ï¼Ÿ</strong></p>
<p>é½æ¬¡åæ ‡å°±æ˜¯ç”¨ N+1 ç»´å‘é‡è¡¨ç¤º N ç»´åæ ‡ï¼Œå³ç”¨é½æ¬¡åæ ‡ç³»è¡¨ç¤ºç¬›å¡å°”åæ ‡ç³»ã€‚å¼•å…¥é½æ¬¡åæ ‡æ—¨åœ¨å°†å„ç§å‡ ä½•å˜æ¢éƒ½ç»Ÿä¸€æˆçŸ©é˜µç›¸ä¹˜çš„å½¢å¼ï¼Œæ¯”å¦‚åœ¨äºŒç»´åæ ‡ç³»ä¸­ï¼Œå¹³ç§»å˜æ¢åªèƒ½ç”¨çŸ©é˜µç›¸åŠ çš„å½¢å¼è¡¨ç¤ºï¼Œè€Œåœ¨é½æ¬¡åæ ‡ç³»ä¸­å¯ç”¨çŸ©é˜µç›¸ä¹˜çš„å½¢å¼è¡¨ç¤ºã€‚</p>
<h2 id="å•åº”æ€§çŸ©é˜µæ±‚è§£">å•åº”æ€§çŸ©é˜µæ±‚è§£</h2>
<p>ç”±äºé½æ¬¡åæ ‡çš„æ¯”ä¾‹ä¸å˜æ€§ï¼Œå³<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">kH</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span>~<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo mathvariant="normal">â‰ </mo><mn>0</mn></mrow><annotation encoding="application/x-tex">k\ne0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel">î€ </span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>ï¼Œæ•…çŸ©é˜µåªæœ‰ 8 ä¸ªè‡ªç”±åº¦ï¼Œä»…éœ€å››å¯¹å˜æ¢å‰åçš„åæ ‡å³å¯æ±‚è§£å•åº”æ€§çŸ©é˜µã€‚å¾€å¾€ä»¤<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mn>33</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">h_{33}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">33</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>ï¼Œæ±‚å¾—å”¯ä¸€è§£ã€‚</p>
<h1>ä»£ç å®ç°</h1>
<h2 id="é€‰ç‚¹">é€‰ç‚¹</h2>
<p>éœ€è¦å¾—åˆ°å››å¯¹æˆ–ä»¥ä¸Šç‚¹çš„å˜æ¢å‰ååæ ‡</p>
<h2 id="æ±‚è§£å•åº”æ€§çŸ©é˜µ">æ±‚è§£å•åº”æ€§çŸ©é˜µ</h2>
<p>é€šè¿‡ OpenCV æä¾›çš„å‡½æ•°è¿›è¡Œæ±‚è§£ï¼Œcv2.getPerspectiveTransform ç”±<strong>ç²¾ç¡®</strong>çš„å››å¯¹ç‚¹è¿”å›å•åº”æ€§çŸ©é˜µï¼Œcv2.findHomography ä»å››å¯¹ä»¥ä¸Šçš„ç‚¹ä¸­å¤šæ¬¡å–æ ·ï¼Œé€šè¿‡ä¼˜åŒ–ç®—æ³•ç­›å¾—æœ€ä¼˜è§£ï¼Œæœ‰ä¸€å®šçš„è¯¯å·®å®¹å¿ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-comment"># æºç‚¹åæ ‡ (å››è¾¹å½¢)</span><br>src_points = np.array([[<span class="hljs-number">100</span>, <span class="hljs-number">100</span>], [<span class="hljs-number">200</span>, <span class="hljs-number">100</span>], [<span class="hljs-number">200</span>, <span class="hljs-number">200</span>], [<span class="hljs-number">100</span>, <span class="hljs-number">200</span>]], dtype=np.float32)<br><br><span class="hljs-comment"># ç›®æ ‡ç‚¹åæ ‡ (çŸ©å½¢)</span><br>dst_points = np.array([[<span class="hljs-number">50</span>, <span class="hljs-number">50</span>], [<span class="hljs-number">300</span>, <span class="hljs-number">50</span>], [<span class="hljs-number">300</span>, <span class="hljs-number">300</span>], [<span class="hljs-number">50</span>, <span class="hljs-number">300</span>]], dtype=np.float32)<br><br><span class="hljs-comment"># è®¡ç®—å•åº”æ€§çŸ©é˜µ</span><br>H, status = cv2.findHomography(src_points, dst_points)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å•åº”æ€§çŸ©é˜µ H:&quot;</span>)<br><span class="hljs-built_in">print</span>(H)<br><br></code></pre></td></tr></table></figure>
<h2 id="è¿›è¡Œé€è§†å˜æ¢">è¿›è¡Œé€è§†å˜æ¢</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç›®æ ‡å›¾åƒçš„å°ºå¯¸ (å®½, é«˜)</span><br>output_size = (<span class="hljs-number">300</span>, <span class="hljs-number">200</span>)<br><br><span class="hljs-comment"># é€è§†å˜æ¢</span><br>warped_image = cv2.warpPerspective(image, M, output_size)<br><br><span class="hljs-comment"># æ˜¾ç¤ºç»“æœ</span><br>cv2.imshow(<span class="hljs-string">&#x27;Warped Image&#x27;</span>, warped_image)<br>cv2.waitKey(<span class="hljs-number">0</span>)<br>cv2.destroyAllWindows()<br></code></pre></td></tr></table></figure>
<h2 id="é€†é€è§†å˜æ¢">é€†é€è§†å˜æ¢</h2>
<p>å¦‚æœæƒ³é€šè¿‡ä¿¯è§†å›¾çš„åæ ‡å¾—åˆ°åŸå›¾åƒå¯¹åº”åæ ‡ï¼Œå¯¹å•åº”æ€§çŸ©é˜µæ±‚é€†ï¼Œè¿›è¡Œå˜æ¢å³å¯ã€‚</p>
<hr>
<p>é€è§†å˜æ¢ä¸­çš„å…·ä½“åº”ç”¨æ€è·¯å¯å€Ÿé‰´(<a href="https://hibanaw.com/archives/171/">https://hibanaw.com/archives/171/</a>)</p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>å›¾åƒå¤„ç†</tag>
      </tags>
  </entry>
</search>
